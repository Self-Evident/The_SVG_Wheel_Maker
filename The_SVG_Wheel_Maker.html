<!DOCTYPE html>
<meta charset="utf-8"/>



<!--=========================================================================..>
The SVG Wheel Maker
v.beta.20


Copyright © 2017 https://github.com/Self-Evident

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
<!--=========================================================================-->



<title>The Wheel Maker &amp; Spoke Length Calculator</title>


<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

/*** The prefix "WH_" simple means "WHeel" ***/

input.WH:focus, select.WH:focus, button.WH:focus { box-shadow: 0 0 3pt 1pt #006060 }
input[readonly].WH { color: #555 }
select.WH { padding-left: .3rem; width: 3.1rem; font-size: .9rem}
select.WH option { padding-left: .5rem }


/* Removes that annoying dotted onfocus outline of FF selects */
select.WH:-moz-focusring {
	color: transparent;
	text-shadow: 0 0 0 #000;
}

#WH_CONTAINER {
	border: solid 0px red;	 /*//#####*/
	text-align: center;
	padding: 1rem; 0 0 0;
	visibility: hidden;		/* opacity & visibility changed at end of onload. */
	opacity: 0;
	transition: opacity .5s;
}

#WH_The_SVG   { display: inline-block; border: solid 0px red; } /*//#####*/
#WH_left_side { display: inline-block; vertical-align: top; position: relative; border: solid 0px red; } /*//#####*/

.WH_settings 		{
	border: solid 0px #333;
	border-collapse: separate;
	font-family: arial;
	width: 11rem;
	text-align: center;
}

table.WH_settings { display: inline-table; border-radius: 8px; background-color: #ccc }

.WH_settings td { padding: 2px 0 2px 0; border: solid 0px red; } /*//#####*/
.WH_settings th { height: 2.2rem; font-size: 1.1rem; border-bottom: solid 2px #333}

.WH_settings .WH_thv { text-align: left; padding: 0 0 0 3px; width: 3.2rem; font-weight: bold; }
.WH_settings input   { width: 3.2rem; text-align: center; font: 1rem courier; }
.WH_settings hr 	 { margin: .1rem 3px .5rem 3px }
.WH_separator		 { padding: 0; height: .5rem; }



#WH_WHEEL_TYPE	 { margin: .3rem 0 .5rem 1rem; width: 6rem }


#WH_show_hide_display_options.WH {
	display: block;
	width: 100%;
	height: 2rem;
	margin: 0 0 .3rem 0;
	padding: 3px 1rem; ;
	text-align: center;
	font: normal 1.2rem arial;
	border: solid 1px #999;
	border-radius: 8px;
	background-color: #ccc;
	background: linear-gradient(to bottom, #CCC, #EEE, #CCC);
}

#WH_show_hide_display_options.WH:focus {
	border-color: #555;
	background: linear-gradient(to bottom, #CCC, #FFF, #FFF, #CCC);
}

#WH_show_hide_display_options.WH:hover {
	border-color: #555;
	background: linear-gradient(to bottom, #bbb, #FFF, #bbb);
}

#WH_show_hide_display_options.WH:active {
	padding: 3px 2px 1px 2px;
	background: linear-gradient(to bottom, #EEE, #CCC, #EEE);
}

#WH_show_hide_display_options.WH::-moz-focus-inner { border: 0 }

#WH_display_options_container { display: inline-block; }
#WH_display_options  { display: none; vertical-align: top; border: solid 0px red; } /*//#####*/
#WH_settings span.WH_th1 { text-decoration: underline; }

#WH_rim	 { fill: none; stroke: #999; }
.WH_svg	 { border: solid 0px gray; display: inline-block; margin: auto; }
.WH_axis { stroke: #999; stroke-width: 1; stroke-dasharray: 3,3; }
.WH_rsh	 { fill: none; stroke: #777; } /*rim spoke holes*/
.WH_hsh	 { fill: none; stroke: #777; } /*hub spoke holes*/
.WH_hsh2 { fill: none; stroke: #ccc; } /*hub spoke holes 2*/
.WH_spoke{ fill: none; stroke: #000; stroke-width: 2; }
.WH_pcd	 { fill: none; stroke: #000; stroke-width: 1; }

.WH_notes { font-siZe: .8rem }
.WH_th1	  { height: 1.8rem; text-decoration: underline; font-weight: bold; }
.WH_th2	  { height: 1.8rem; text-decoration: underline; }

.WH_SL input { width: 4rem; text-align: center; font-size: 1rem; font-weight: bold; }


#WH_MSG_BOX {
	width	: 13rem;
	position: absolute;
	top		: 2rem;
	left	: 11rem;
	border	: solid 2px red;
	border-radius	: 5px;
	padding-top		: 1.8rem; 
	background-color: white;
	font-family		: arial;
	text-align		: center;
	visibility		: hidden;
}


#WH_CLOSE_MSG {
	width	: 2.75rem;
	position: absolute;
	top		: 0rem;
	left	: 10.0rem;
}


#WH_legend  {
	border: solid 1px black;
	border-collapse: collapse;
	font-family: arial;
	text-align: left;
	border-radius: 10px; 
}

#WH_legend td { padding: .2rem .2rem .2rem .5rem; border: solid 1px #555 }
#WH_legend th { padding: .2rem .5rem .2rem .2rem; border: solid 1px #555; }
#WH_legend th.WH_th1 { font-size: 1.2rem; text-decoration: none; }


#CONSOLE { 
	vertical-align:top;
	display: none; 
	font-family: Courier New; 
	font-size: .8em; 
	border: solid 1px red;
	max-height: 40rem ;
	overflow-y: scroll; 
	word-break: break-all;
	padding: 0 .5em;
}
</style>





<div id=WH_CONTAINER><!--====================================================-->

<div id=WH_left_side><!--=========================================--->
<div id=WH_MSG_BOX><button id=WH_CLOSE_MSG>Close</button><div id=WH_MESSAGE></div><br></div>

<table class=WH_settings>
<tr><th colspan=2>Wheel Settings</th></tr>

<tr><td colspan=2><button type=button id=WH_load_samples class=WH>Load Sample Values</button></td></tr>

<tr>
	<td class=WH_thv colspan=2>Type:
		<select id=WH_WHEEL_TYPE class=WH>
			<option value=0>Standard</option>
			<option value=1>Triplet</option>
			<option value=2>Custom</option>
		</select>
		<br>
	</td>
</tr>

<tr><td class=WH_thv>ERD:</td><td><input id=WH_ERD class=WH type=text maxlength=6></td></tr>
<tr><td class=WH_thv>N<sub>R</sub>:</td><td><input id=WH_NR class=WH type=text maxlength=2></td></tr>

<tr><td></td><td>Side 1 &nbsp;Side 2</td></tr>

<tr>
	<td class=WH_thv>N<sub>F</sub>:</td>
	<td>
		<input id=WH_NF1 class=WH type=text maxlength=2 readonly tabindex=-1>
		<input id=WH_NF2 class=WH type=text maxlength=2 readonly tabindex=-1>
	</td>
</tr>
<tr>
	<td class=WH_thv>PCD:</td>
	<td>
		<input id=WH_PCD1 class=WH type=text maxlength=5>
		<input id=WH_PCD2 class=WH type=text maxlength=5>
	</td>
</tr>
<tr>
	<td class=WH_thv>FtC:</td>
	<td>
		<input id=WH_FTC1 class=WH type=text maxlength=5>
		<input id=WH_FTC2 class=WH type=text maxlength=5>
	</td>
</tr>
<tr>
	<td class=WH_thv>OSB:</td>
	<td>
		<input id=WH_OSB1 class=WH type=text maxlength=4>
		<input id=WH_OSB2 class=WH type=text maxlength=4>
	</td>
</tr>
<tr>
	<td class=WH_thv>X:</td>
	<td>
		<select id=WH_SX1 class=WH>
			<option value=0>0</option>
			<option value=1>1</option>
			<option value=2>2</option>
			<option value=3>3</option>
			<option value=4>4</option>
			<option value=5>5</option>
		</select>
		<select id=WH_SX2 class=WH>
			<option value=0>0</option>
			<option value=1>1</option>
			<option value=2>2</option>
			<option value=3>3</option>
			<option value=4>4</option>
			<option value=5>5</option>
		</select>
	</td>
</tr>
<tr>
	<td class=WH_thv>SHD:</td>
	<td><input id=WH_SHD class=WH type=text maxlength=4></td>
</tr>
<tr><td colspan=2 class=WH_notes>(SHD affects spoke length calculations only.)<br><br></td></tr>
<tr>
	<td class=WH_thv colspan=2>Lace Option:
		<select id=WH_LACE_OPT class=WH>
			<option value= 1>1&nbsp;</option>
			<option value=-1>2&nbsp;</option>
		</select>
	</td>
</tr>
</table><!--//end Wheel Settings -->
<br>
<br>


<table class=WH_settings>
<tr><th>Spoke Lengths</th></tr>
<tr><td class=WH_SL>Side 1: <input id=WH_LENGTH1 type=text readonly tabindex="-1"></td></tr>
<!-- tr><td class=WH_SL>Side 1: <input id=WH_LENGTH2 type=text readonly tabindex="-1"></td></tr -->

<tr><td class=WH_SL>Side 2: <input id=WH_LENGTH3 type=text readonly tabindex="-1"></td></tr>
<!-- tr><td class=WH_SL>Side 2: <input id=WH_LENGTH4 type=text readonly tabindex="-1"></td></tr -->
</table>
<br>

</div><!--//end WH_left_side ======================================-->








<div id=WH_The_SVG>

<!--==========
	Consider all raw size & x/y values to coorespond directly 
	to rim, hub, & spoke measurements (mm).
==========-->
<svg id="WH_box" class="WH_svg">
	<title>Wheel</title>
	<g id="WH_axes">
		<line id="WH_x-axis" class="WH_axis"/>
		<line id="WH_y-axis" class="WH_axis"/>
	</g>

	<g id="WH_wheel">
		<circle id="WH_rim"	r=""/>
		<circle id="WH_flange1" class="WH_pcd" r=""/>
		<circle id="WH_flange2" class="WH_pcd" r=""/>
		
		
		<g id=WH_Holes_and_Spokes>
			<g id="WH_rim_holes"></g>
			<g id="WH_holes_f1"></g>
			<g id="WH_holes_f2"></g>
			<g id="WH_spokes"></g>
		</g>
	</g><!-- end id=WH_wheel -->
</svg>


<br>



<div id=WH_display_options_container>
<button type=button id=WH_show_hide_display_options class=WH value=none>Display Options</button>


<div id=WH_display_options>
<table class=WH_settings>
<tr><th colspan=3>Spokes</th></tr>

<tr class=WH_th1><td>Group</td><td>Color</td><td>Show?</td></tr>

<tr class=WH_th2><td colspan=3>Side 1</td></tr>

<tr>
	<td>1</td>
	<td><input id=WH_COLOR1 class=WH type=text></td>
	<td><input id=WH_SHOW1  class=WH type=checkbox></td>
</tr>

<tr>
	<td>2</td>
	<td><input id=WH_COLOR2 class=WH type=text></td>
	<td><input id=WH_SHOW2  class=WH type=checkbox></td>
</tr>

<tr class=WH_separator><td colspan=3></td></tr>
<tr class=WH_th2><td colspan=3>Side 2</td></tr>

<tr>
	<td>3</td>
	<td><input id=WH_COLOR3 class=WH type=text></td>
	<td><input id=WH_SHOW3  class=WH type=checkbox></td>
</tr>

<tr>
	<td>4</td>
	<td><input id=WH_COLOR4 class=WH type=text></td>
	<td><input id=WH_SHOW4  class=WH type=checkbox></td>
</tr>

<tr class=WH_separator><td colspan=3></td></tr>
<tr><td colspan=3>Line Size: <input id=WH_SD class=WH type=text></td></tr>
</table>



<table id=WH_rfa_options class=WH_settings>
<tr><th colspan=4>Rim &amp; Flange &amp; Axes</th></tr>
<tr class=WH_th1><td></td><td>Color</td><td>Depth</td><td>Show?</td></tr>
<tr>
	<td>Rim</td>
	<td><input id=WH_COLOR_R class=WH type=text></td>
	<td><input id=WH_LINE_R  class=WH type=text></td>
	<td><input id=WH_SHOW_R  class=WH type=checkbox></td>
</tr>
<tr>
	<td>F1</td>
	<td><input id=WH_COLOR_F1 class=WH type=text></td>
	<td><input id=WH_LINE_F1  class=WH type=text></td>
	<td><input id=WH_SHOW_F1  class=WH type=checkbox></td>
</tr>
<tr>
	<td>F2</td>
	<td><input id=WH_COLOR_F2 class=WH type=text></td>
	<td><input id=WH_LINE_F2  class=WH type=text></td>
	<td><input id=WH_SHOW_F2  class=WH type=checkbox></td>
</tr>

<tr class=WH_separator><td colspan=4></td></tr>
<tr><td colspan=4>Spoke Hole Size: <input id=WH_HOLESIZE class=WH type=text></td></tr>
<tr><td colspan=4 class=WH_notes>(Affects displayed size only.)</td></tr>
<tr><td colspan=4>&nbsp;</td></tr>
<tr>
	<td>Axes</td>
	<td><input id=WH_COLOR_AXES class=WH type=text></td>
	<td><input id=WH_LINE_AXES  class=WH type=text></td>
	<td><input id=WH_SHOW_AXES  class=WH type=checkbox></td>
</tr>
</table>

</div><!--end Display Options-->
</div><!--end Display Options container-->
</div><!--end WH_The_SVG  (Originally this only contained the <svg>.)-->



<div id=CONSOLE></div><br><!-- //##### #####-->



<br><br>
<table id=WH_legend>
<tr><th colspan=2 class=WH_th1>Notes</th></tr>
<tr><th>N<sub>R</sub></td><td>Number of spoke holes in the Rim. Most of the time, this will be the same as the number of spokes.</td></tr>
<tr><th>N<sub>F</sub></td><td>Number of effective spoke holes in the Flange.  That is, if you are skipping every other hole, and only using 8 out of 16, only enter 8 here.<br>
Normally, the number of holes in each hub flange, N<sub>F</sub>, is 1/2 of the holes in the rim/spoke count. One notable exception is the triplet.  For example, for an 8:16 triplet, enter 8 for side 1, and 16 for side 2.</td></tr>
<tr><th>PCD</td><td>"Pitch Circle Diameter" - diameter of circle running thru the spoke holes in the flange.</td></tr>
<tr><th>FtC</td><td>"Flange to Center" distance.  Used in final spoke length calculation only - does't effect display.</td></tr>
<tr><th>OSB</td><td>"Offset Spoke "Bed". This value may also be referred to as "OC", or "off-center", or "asymetrical", and similar terms.  If unknown, leave blank, or enter 0. It generally has little effect on the final spoke length.
<p>Useage: The spoke holes in a rim with an OSB will be "offset" to one side, usualy by only 2 to 5 mm.   Enter a negative number for the side that the holes are closer to (spokes will be a tiny bit shorter); and enter a positive number for the side that the holes are further from (spoke will be a tiny bit longer). As with FtC, it does not affect displayed wheel.</td></tr>
<tr><th>X</td><td>"Spoke Cross" value.  Number of spokes each spoke crosses on the same side of wheel.</td></tr>
<tr><th>SHD</td><td>"Spoke Hole Diameter". Like FtC &amp; OSB, this value only affects final spoke length, but not the wheel as displayed.</td></tr>
<tr><th>Lace Option</td><td>This is mostly for triplet wheels, but can affect any non-standard lace pattern.  Just try it & see.</td>
</table>

</div><!--//end WH_CONTAINER ================================================-->







<script>(function(){
/******************************************************************************/
var D = document;
function E(id) { return document.getElementById(id); }

var MAX = {'WH_NR':66, 'WH_NF1':66, 'WH_NF2':66 } //At these values, it starts to takes to long to run.
var PRIOR_FOCUS = "ERD"; //Used to return focus to input that had error. Set in onfocus() events.
var PRIOR_VALUE = ""; //Used to revert to prior good value on error.


//Assign all element references here.
var CONTAINER = E('WH_CONTAINER');

var LOAD_SAMPLES = E('WH_load_samples');

var WHEEL_TYPE = E('WH_WHEEL_TYPE');

var ERD  = E('WH_ERD');	// Effective Rim Diameter
var NR   = E('WH_NR');		// Number of holes in the Rim
var NF	 = [];
	NF[1]= E('WH_NF1');	// Number of holes in Flange 1
	NF[2]= E('WH_NF2');	//    "		   "		"	 2
var PCD  = [];
	PCD[1] = E('WH_PCD1');	// Pitch Circle Diameter 1
	PCD[2] = E('WH_PCD2');	// 	 "	   "		"	 2
var FTC  = [];
	FTC[1] = E('WH_FTC1');	// Flange-to-Center 1 distance
	FTC[2] = E('WH_FTC2');	// 	  "			"	2	 "
var OSB  = [];
	OSB[1] = E('WH_OSB1');	// Offset Spoke Bed 1 (off center rim)
	OSB[2] = E('WH_OSB2');	// 	  "			"	2	 "		"
var SX   = [];
	SX[1]= E('WH_SX1');	// Spoke Crossing 1
	SX[2]= E('WH_SX2');	// Spoke Crossing 2
var SHD  = E('WH_SHD');	// Spoke Hole Diameter. Affects spoke length calcs only.
var LACE_OPT   = E('WH_LACE_OPT');// Wheel Type/Lacing Option
	LACE_OPT.options[0].value =  1; //The option values (1 or -1) are used in the 
	LACE_OPT.options[1].value = -1; // spoke length calculations. DO NOT CHANGE 

var SL	 = [];				//Spoke Lengths
	SL[1]= E('WH_LENGTH1');	//Flange 1 Group 1 (ie: leading/trailing...)
	SL[2]= E('WH_LENGTH2');	//	  	 2		 2
	SL[3]= E('WH_LENGTH3');	//		 3		 3
	SL[4]= E('WH_LENGTH4');	//		 4		 4

var DISPLAY_OPTIONS = E('WH_display_options'); //<div> around display options to enable show/hide
var SHOW_HIDE_DO = E('WH_show_hide_display_options');//Button to show/hide display options.

var SG1 = E('WH_SHOW1');// Show spoke group 1  These are mostly for trouble shooting.
var SG2 = E('WH_SHOW2');// Show spoke group 2			  "				"
var SG3 = E('WH_SHOW3');// Show spoke group 3			  "				"
var SG4 = E('WH_SHOW4');// Show spoke group 4			  "				"
var SD      = E('WH_SD');	// Spoke Line Size / Spoke Diameter. Affects displayed spokes only.
var COLOR1 = E('WH_COLOR1');//Spoke group 1 color
var COLOR2 = E('WH_COLOR2');//Spoke group 2 color
var COLOR3 = E('WH_COLOR3');//Spoke group 3 color
var COLOR4 = E('WH_COLOR4');//Spoke group 4 color

var SHOW_R  = E('WH_SHOW_R');	// Show Rim circle.
var SHOW_F1 = E('WH_SHOW_F1');	// Show Flange 1 circle.
var SHOW_F2 = E('WH_SHOW_F2');	// Show Flange 2 circle.
var COLOR_R  = E('WH_COLOR_R'); //
var COLOR_F1 = E('WH_COLOR_F1');//
var COLOR_F2 = E('WH_COLOR_F2');//

var LINE_SIZE_R  = E('WH_LINE_R');//Line widths of the rim & flange circles.
var LINE_SIZE_F1 = E('WH_LINE_F1');
var LINE_SIZE_F2 = E('WH_LINE_F2');

var HOLESIZE   = E('WH_HOLESIZE');  //

var COLOR_AXES = E('WH_COLOR_AXES');//
var LINE_SIZE_AXES = E('WH_LINE_AXES');
var SHOW_AXES  = E('WH_SHOW_AXES'); //


var RIM		= E('WH_rim'); //<circle>
var FLANGE1	= E('WH_flange1'); //<circle>
var FLANGE2	= E('WH_flange2'); //<circle>

var SPOKES		  = E('WH_spokes');   //<g> containing all spokes.
var RIM_HOLES	  = E("WH_rim_holes");//<g> containing rim holes.
var FLANGE1_HOLES = E("WH_holes_f1"); //<g> containing flange 1 holes.
var FLANGE2_HOLES = E("WH_holes_f2"); //<g> containing flange 2 holes.

var MESSAGE_BOX = E('WH_MSG_BOX');	 //Container div for msg div & [Close] btn.
var CLOSE_MSG	= E('WH_CLOSE_MSG'); //[Close] button for error message box.
var MESSAGE_DIV = E('WH_MESSAGE');	 //div for actual error message.

var SVG_WHEEL	= E('WH_box'); //Main <svg> element containing wheel & axes..
var G_WHEEL		= E('WH_wheel'); //<g> containing just the wheel elements: spokes, holes, rim, & flanges.

var SVG_CONTAINER_DIV = E('WH_The_SVG'); //Used just to read the generated html into the 'CONSOLE'.

var X_axis = E('WH_x-axis');
var Y_axis = E('WH_y-axis');
//end assignment of element reference.




//id & class prefixes, etc...
var SPOKE_ID_PREFIX 	= "WH_spoke_";
var HUB_HOLE_ID_PREFIX	= "WH_f";	//Hub/flange hole id ex: WH_f1_sh1
var HUB_HOLE_MESOFIX	= "_sh";	//HUB_HOLE_ID_PREFIX + 1 + HUB_HOLE_MESOFIX + 1
var RIM_HOLE_ID_PREFIX	= "WH_rsh"; //WH_rsh1, WHrsh2, etc...
var RIM_HOLE_CLASS		= "WH_rsh";
var SPOKE_GROUP_PREFIX	= "WH_group"; //WH_group1, ..., WH_group4
var SPOKE_BASE_CLASS	= "WH_spoke";
var HUB_HOLE_CLASS		= "WH_hsh";
var HUB_HOLE_CLASS2		= "WH_hsh";
var AXIS_CLASS			= "WH_axis";




/*************************************************./
//Consider all raw size & x/y values to be mm,
//to coorespond directly to rim, hub, & spoke measurements.
var DEFAULTS_WHEEL = {
	'WHEEL_TYPE':1,
	'ERD' :577,
	'NR'  :24,
	'NF1' :8, 
	'NF2' :16,
	'PCD1':38.5,
	'PCD2':50.6,
	'FTC1':37.7, //FtC & OSB affect spoke length calcs only (not display).
	'FTC2':17.1, //
	'OSB1':'',   //
	'OSB2':'',   //
	'SX1' :0,    
	'SX2' :3,
	'SHD' :2.6,  //Affects spoke length calcs only (not displayed size).
	'LACE_OPT':0 }


var DEFAULTS_DISPLAY = {
	'SG1':1,
	'SG2':1,
	'SG3':1,
	'SG4':1,
	'SD' :2,
	'SHOW_R' :1, // true/false or 1/0
	'SHOW_F1':1, // 
	'SHOW_F2':1, // 
	'LINE_SIZE_R':1,
	'LINE_SIZE_F1':1,
	'LINE_SIZE_F2':1,
	'LINE_SIZE_AXES':1,
	'COLOR1': '#44F',
	'COLOR2': '#77D',
	'COLOR3': '#2B2',
	'COLOR4': '#6D6',
	'COLOR_R' : '#AAA',
	'COLOR_F1': '#AAA',
	'COLOR_F2': '#777',
	'COLOR_AXES': '#999',
	'SHOW_AXES': 1, // true/false or 1/0
	'HOLESIZE' : 4, //Displayed size of spoke holes.
	'VIEWBOX_SIZE': 680 }; //Most wheels are < 600 ERD.
/*************************************************/



/*************************************************./
var DEFAULTS_WHEEL = {
	'WHEEL_TYPE':0,
	'ERD' :577,
	'NR'  :24,
	'NF1' :12, 
	'NF2' :12,
	'PCD1':38.5,
	'PCD2':50.6,
	'FTC1':37.7, //FtC & OSB affect spoke length calcs only (not display).
	'FTC2':17.1, //
	'OSB1':'',   //
	'OSB2':'',   //
	'SX1' :2,    
	'SX2' :2,
	'SHD' :2.6,  //Affects spoke length calcs only (not displayed size).
	'LACE_OPT':0 }


var DEFAULTS_DISPLAY = {
	'SG1':1,
	'SG2':1,
	'SG3':1,
	'SG4':1,
	'SD' :2,
	'SHOW_R' :1, // true/false or 1/0
	'SHOW_F1':1, // 
	'SHOW_F2':1, // 
	'LINE_SIZE_R':1,
	'LINE_SIZE_F1':1,
	'LINE_SIZE_F2':1,
	'LINE_SIZE_AXES':1,
	'COLOR1': '#44F',
	'COLOR2': '#77D',
	'COLOR3': '#2B2',
	'COLOR4': '#6D6',
	'COLOR_R' : '#AAA',
	'COLOR_F1': '#AAA',
	'COLOR_F2': '#777',
	'COLOR_AXES': '#999',
	'SHOW_AXES': 1, // true/false or 1/0
	'HOLESIZE' : 4, //Displayed size of spoke holes.
	'VIEWBOX_SIZE': 680 }; //Most wheels are < 600 ERD.
/*************************************************/




/*************************************************/
var DEFAULTS_WHEEL = {
	'WHEEL_TYPE':0,
	'ERD' :'',
	'NR'  :1,
	'NF1' :1,
	'NF2' :1,
	'PCD1':40,
	'PCD2':50,
	'FTC1':0,
	'FTC2':0,
	'OSB1':'',
	'OSB2':'',
	'SX1' :0,
	'SX2' :0,
	'SHD' :2.6,
	'LACE_OPT':0 }


var DEFAULTS_DISPLAY = {
	'SG1':1,	 // true/false or 1/0
	'SG2':1,	 //			"
	'SG3':1,	 //			"
	'SG4':1,	 //			"
	'SD' :2,	 //			"
	'SHOW_R' :1, //			"
	'SHOW_F1':1, //			"
	'SHOW_F2':1, //			"
	'LINE_SIZE_R':1,
	'LINE_SIZE_F1':1,
	'LINE_SIZE_F2':1,
	'LINE_SIZE_AXES':1,
	'COLOR1': '#44F',
	'COLOR2': '#77D',
	'COLOR3': '#2B2',
	'COLOR4': '#6D6',
	'COLOR_R' : '#777',
	'COLOR_F1': '#AAA',
	'COLOR_F2': '#777',
	'COLOR_AXES': '#999',
	'SHOW_AXES': 1, // true/false or 1/0
	'HOLESIZE' : 4,
	'VIEWBOX_SIZE': 610 };//Most wheels are < 600 ERD.
/*************************************************/
//##### ########################################################################




//##### ########################################################################
function Log(something, br, esc) {
	if (typeof something === 'undefined') {
		E('CONSOLE').innerHTML = ""
		E('CONSOLE').style['display'] = "none";
		return;
	}

	if (esc) { something = escape_HTML(something + "") }
	
	if (br == true) { br = "<br>" } else { br = "" }
	
	E('CONSOLE').innerHTML += something + br;
	E('CONSOLE').scrollTop = E('CONSOLE').scrollHeight;
	E('CONSOLE').style['display'] = "inline-block";
}//end Log()
//##### ########################################################################




//##### ########################################################################
function escape_HTML(text) {
  var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };

  return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}//end escape_HTML()
//##### ########################################################################




function Load_samples() { //****************************************************/

	WHEEL_TYPE.selectedIndex = DEFAULTS_WHEEL['WHEEL_TYPE'];

	ERD	  .value = DEFAULTS_WHEEL['ERD'];
	NR	  .value = DEFAULTS_WHEEL['NR'];
	NF[1] .value = DEFAULTS_WHEEL['NF1'];
	NF[2] .value = DEFAULTS_WHEEL['NF2'];
	PCD[1].value = DEFAULTS_WHEEL['PCD1'];
	PCD[2].value = DEFAULTS_WHEEL['PCD2'];
	FTC[1].value = DEFAULTS_WHEEL['FTC1'];
	FTC[2].value = DEFAULTS_WHEEL['FTC2'];
	OSB[1].value = DEFAULTS_WHEEL['OSB1'];
	OSB[2].value = DEFAULTS_WHEEL['OSB2'];
	SX[1] .value = DEFAULTS_WHEEL['SX1'];
	SX[2] .value = DEFAULTS_WHEEL['SX2'];
	SHD   .value = DEFAULTS_WHEEL['SHD'];

	LACE_OPT.selectedIndex = DEFAULTS_WHEEL['LACE_OPT'];

	Build_Wheel();

}//end Load_samples() { //******************************************************/




function scroll_blur(event){ //*************************************************
	//Permit "clearing" focus, and some keyboard navigation while in <input>'s.

	//Normalize the event & which/key/charcode...
	if (!event) {var event = window.event;} //for IE
	var event_code = event.which || event.keyCode || event.charCode;
	
	var ESC = 27, AU = 38, AD = 40, PU = 33, PD = 34;

	//remove focus from input/select to allow keyboard arrows/pageup/pagedown/etc page scrolling.
	if (event_code == ESC) { D.activeElement.blur(); return; }

	if (event.target.tagName == "INPUT") {
		//Arrow down scrolls the page up, towards the bottom of the page, and vice-versa.
		if      (event_code == AU) { window.scrollBy(0, -38); }
		else if (event_code == AD) { window.scrollBy(0,  38); }
		else if (event_code == PU) { window.scrollBy(0,-400); }
		else if (event_code == PD) { window.scrollBy(0, 400); }
	}
}//end scroll_blur() //*********************************************************




function Show_Hide_Options(button, target_id, mode){
	//Toggle button.value & innerHTML, and Show or Hide target,

	if (button.value == "none") {
		button.value     = mode; //inline-block, etc...
		//##### button.innerHTML = "Show";
	}
	else {
		button.value     = "none"; 
		//##### button.innerHTML = "Hide";
	}

	E(target_id).style["display"] = button.value;
	
	//##### localStorage.setItem(LS_PREF + button.id, button.value)
}//end Show_Hide()




function Init_Show_Hide(button, target_id) {
	//Check for saved settings & init Show/Hide button & it's target...
	//"LS_PREF": local storage name prefix

	var value = localStorage.getItem(LS_PREF + button.id);

	if ((value === null) || (value == "none")) {
		button.value	 = "none";
		button.innerHTML = "Show";
	} else { 
		button.value	 = "";
		button.innerHTML = "Hide";
	}
	
	E(target_id).style['display'] = button.value;
}//end Init_Show_Hide()





function Create_Spoke_Holes(hole_group, base_id, class1, class2, N, scale, shd, offset) { //***/
	//Create & position N spoke holes in <g id=group>, with radius of shd/2 (shd="spoke hole diameter")
	if (typeof offset == "undefined") { offset = 0 }

	var A = 360/N; //angle between holes
	
	var a = offset;	//angle to current hole from 0
	var cx, cy;		//coordinates for hole

	var odd = true;		//for alternating classes

	for (var sh = 1; sh <= N; sh++) {
		var full_id = base_id + sh;
		
		odd = !odd;
		if (odd) { var class_X = class1 } else { var class_X = class2 }
		hole_group.innerHTML += '<circle id=' + full_id + ' class="' + class_X + '" r="' + (shd/2) + '" cx="0" cy="0" />';

		cx = Math.round(Math.sin( (a/180) * Math.PI) * scale * 10000)/10000;
		cy = Math.round(Math.cos( (a/180) * Math.PI) * scale * 10000)/10000;
		
		E(full_id).setAttribute('cx', cx);
		E(full_id).setAttribute('cy', cy);
		
		a += A; //Spoke hole 1 is first hole at or after 0 degrees/"6 o'clock".
	}

	//##### Used during dev.  Keep?
	//E(base_id + "1").style["fill"]   = "red"; //Spoke 1
	//E(base_id + "1").style["stroke"] = "red"; //  "
	
}//end Create_Spoke_Holes() //*************************************************/




function Calc_Spoke_Length(flange, spoke_id) { //******************************/
	//Calculate actual spoke length in 3-d space, including flange-to-center measurement..
	
	//Get spoke ends
	var x1 = E(spoke_id).getAttribute('x1');
	var y1 = E(spoke_id).getAttribute('y1');
	var x2 = E(spoke_id).getAttribute('x2');
	var y2 = E(spoke_id).getAttribute('y2');
	
	var dx = x2 - x1;
	var dy = y2 - y1;

	var ftc = FTC[flange].value*1; //Final spoke length requires Flange to Center
	var osb = OSB[flange].value*1; //and OSB...
	var w = ftc + osb;

	var S = Math.sqrt(w*w + dx*dx + dy*dy) - SHD.value/2;

	return Math.round(S * 10)/10;
}//end Calc_Spoke_Length() //**************************************************/




function Calc_All_Spoke_Lengths(changed) { //**********************************/
	//Calc spoke lengths for both sides. Used by onchange of OSB & SHD.

	if (!Validate_Setting(changed)) {
		SL[1].value = ""; //WH_spoke_(flange)_(hole)
		SL[3].value = "";
	} else if (NR.value == 0) {
		SL[1].value = ''; //WH_spoke_(flange)_(hole)
		SL[3].value = '';
	} else {
		SL[1].value = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1'); //WH_spoke_(flange)_(hole)
		SL[3].value = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1');
	}

	if (NF[1].value == 0) { SL[1].value = ''; }
	if (NF[2].value == 0) { SL[3].value = ''; }

	//##### For future. Maybe.  Before use, uncomment cooresponding html <input>'s
	//##### SL[2].value = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_2'); //##### For future use.
	//##### SL[4].value = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_2'); //##### For future use.
}//end Calc_All_Spoke_Lengths() //*********************************************/





function Spoke_Length_Calculator(f) { //*****************************************
	//Tradtional method. For the most part.

	var ftc = FTC[f].value*1; //Final spoke length requires Flange to Center
	var osb = OSB[f].value*1; //and OSB...
	var w = ftc + osb;

	var aR  = 360/NR.value;    //angle between holes in Rim.
	var aF  = 360/NF[f].value; //angle between holes in Flange.

	//"zero cross" adjustment angle for triplets.
	if ((NR.value % NF[f].value) == 0) { var a0 = 0 } else { var a0  = aR - aF/2; }

	var rR  = ERD   .value/2;  //radius of Rim
	var rF  = PCD[f].value/2;  //radius of Flange
	var aF1 = SX[f].value*aF + LACE_OPT.value*a0; //angle to spoke hole in flange from "vertical".
	var aF1_rad = aF1/180 * Math.PI; //aF1 in radians
	var cos_aF1 = Math.round(Math.cos( aF1_rad )*10000)/10000;

	var S = Math.sqrt(w*w + rR*rR + rF*rF - 2*rR*rF*cos_aF1) - SHD.value/2;
		S = Math.round(S * 10)/10;

	/**************************./
	Log(LACE_OPT.value,1);
	Log("w:" + w,1);
	Log("rR:" + rR,1);
	Log("rF:" + rF,1);
	Log("aR:" + aR,1);
	Log("aF:" + aF,1);
	Log("a0:" + a0,1);
	Log(NR.value % NF[f].value,1);
	Log(aR % aF,1);
	Log("shd:" + SHD.value/2,1);
	Log("cos..." + cos_aF1,1);
	/***************************/
	Log(">" + S + "<",1);

	return S;
}//end Spoke_Length_Calculator() { //*******************************************




function Draw_Spoke(group, flange, flange_hole, rim_hole, color) { //**********/

	if (typeof color == "undefined") { color = "black" }

	var flange_hole_id = HUB_HOLE_ID_PREFIX + flange + HUB_HOLE_MESOFIX + flange_hole;
	var rim_hole_id	= RIM_HOLE_ID_PREFIX + rim_hole;

	var x1 = E(flange_hole_id).getAttribute('cx');
	var y1 = E(flange_hole_id).getAttribute('cy');
	var x2 = E(rim_hole_id).getAttribute('cx');
	var y2 = E(rim_hole_id).getAttribute('cy');

	var spoke_id = SPOKE_ID_PREFIX + flange + "_" + flange_hole;
	var classes = SPOKE_BASE_CLASS + ' ' + SPOKE_GROUP_PREFIX + group; //ex: 'WH_spoke WH_group1'
	var coords = ' x1="' + x1 +  '" y1="' + y1 +  '" x2="' + x2 +  '" y2="' + y2 +  '" ';
	var style = ' style="stroke:' + color + '"';

	var spoke = '<line id="' + spoke_id + '" class="' + classes+ '" ' + coords + style + '/>' + "\n";
	SPOKES.innerHTML += spoke;
	
	//Calculate & display final spoke length.
	if (flange_hole == 1) { //#####  || (flange_hole == 2)
						    //##### For future use. Before use, uncomment cooresponding html <input>'s
		SL[group].value = Calc_Spoke_Length(flange, spoke_id);
	}
	
	//##### In case I want to calc ALL spokes.
	//##### Log(spoke_id + ") " + Calc_Spoke_Length(flange, spoke_id),1) 
}//end Draw_Spoke() //*********************************************************/




function Lacing_Option(f) { //*************************************************/
	/************************************************************************../
	tl;dr: "It's complicated..."  :)

    In a triplet wheel, with a given spoke count & cross, there are two lace patterns possible: "Type 1" and "Type 2"  :)
    In this program, it is presented as "Lacing Option".  Also, it only concerns the side with more spokes (ex: the 16
	spoke side of an 8:16 triplet). 
    Well, those three options: spoke count, spoke cross, and lace type;  presents us with a three body quatum gravitational
    paradoxical muonicly generational relativistic anti-matter equatorial teseract that has cost me many hours of time & much
    pounding of my head against a cinder block wall...

    Anyway, to determine the matching rim hole for a given flange hole, a modifier is needed, either 1 or -1, depending on
	the desired triplet type & other two conditions. But, it's not always the same. And sometimes it's different, except 
	when it's not...

    All 8 possible combinations (3 "bits": count, cross, type) are summerized in each of the two tables below. 
    The first was created by experimentation of all 8 combination of inputs.  The second is just a translation, but it 
	contains the conditions actually used in the if/then below.
    
        T1   |    T2            1   |   -1               NR: Number of holes in the Rim (24, 27, 32, etc.)
     --------+--------      --------+--------            SX: Spoke Cross (1x, 2x, 3x, etc.)
     NR SX * | NR SX *      NR SX T | NR SX T            * : Modifier (1 or -1)
     --------+--------      --------+--------            T : Triplet Type (T1 or T2)
     E  E  1 | E  E -1      E  E  1 | E  O  1        
     O  E  1 | O  E -1      O  E  1 | O  O  1     \ | /    | | |
     E  O -1 | E  O  1      E  O  2 | E  E  2      \|/     | | |   (The "middle spoke" is on the opposite flange.         )
     0  O -1 | 0  O  1      O  O  2 | O  E  2       X      | | |  
                                                   /|\     | | |  
                                                  Type 1   Type 2 
    
    Now, in basic spoke calc math, it's much simpler, because all that matters is spoke cross - we don't care about the voodoo
	involved in determining matching spoke holes in space.  But here, holes matter. And space.  And time.  I think. I guess.  
	Maybe. I don't know.  But it works now!  :)
    /*************************************************************************/


	var NRE = (NR.value    % 2  == 0); // Even number of rim holes?
	var SXE = (SX[f].value % 2  == 0); // Even Spoke cross?
	var T1  = (LACE_OPT.selectedIndex == 0); // Triplet/Lacing Type 1?

	if ( (NRE && SXE && T1) || (!NRE && SXE && T1) || (NRE && !SXE && !T1) || (!NRE && !SXE && !T1) )
		 { return  1 } 
	else { return -1 }
}//end Lacing_Option() //******************************************************/




function Create_Spoke_Groups(g1, g2, nr, nf, sx, f, color ) { //************/
	sx = Math.floor(sx);

	var gn = g1; //Used to toggle between g1 & g2
	var d  = 1;   //Direction. ie: leading or trailing spokes.

	var r_skip = nr/nf; //Normally 2, but can be 3 (flange 1), then 3/2 (flange 2) for triplets.

	//Flange 1 hole 1 aligns to rim hole 1.  Flange 2 hole 1 aligns to rim hole 2 (generally)...
	if (f == 2) { var f_skip = r_skip/2 } else { var f_skip = 0 }

	for (var h_hole = 1; h_hole <= nf; h_hole += 1) {
		
		var r_hole = (h_hole-1 + sx*d*Lacing_Option(f)) * r_skip + 1 + f_skip
		
		r_hole = Math.round(r_hole) //Needed for triplets. I don't like it, but can't figure out another way...
		
		if (r_hole > nr) {r_hole -= nr;}
		if (r_hole <  1) {r_hole += nr;}
		
		Draw_Spoke(gn,  f,  h_hole,  r_hole ,  color[gn]);
		if (gn == g2) { var gn = g1 } else { var gn = g2 }
		
		d = -d; //toggle direction, aka leading/trailing spokes.
	}


	Set_Style_by_Class( SPOKE_GROUP_PREFIX + g1, "stroke-width", SD.value);
	Set_Style_by_Class( SPOKE_GROUP_PREFIX + g2, "stroke-width", SD.value);
}//end Create_Spoke_Groups() //*************************************************/




function Setup_Wheel(erd, nr, nf1, nf2, pcd1, pcd2, sx1, sx2, shd, spoke_colors) { /****/

	Clear_Wheel(); 

	var AF = 360/nf2; //Angle between holes in Flange
	var offset_f1_f2 = AF/2; //Offset angle between left & right hub flange holes. The radial side is "0".
							 
	var rotate = 180; //180 rotates wheel so that "spoke 1" is at 12 o'clock.

	//Draw & color rim & flange circles..
	var rim_radius = erd/2 + LINE_SIZE_R.value/2 - .5;
	RIM.setAttribute('r', rim_radius); //
	FLANGE1.setAttribute('r', pcd1/2); //erd & pcd's are "D"iameters, but SVG <circle>'s require radii...
	FLANGE2.setAttribute('r', pcd2/2); //

	RIM.style['stroke'] 	= COLOR_R.value;
	FLANGE1.style['stroke'] = COLOR_F1.value;
	FLANGE2.style['stroke'] = COLOR_F2.value;

	RIM.style['stroke-width'] 	  = LINE_SIZE_R.value*1;
	FLANGE1.style['stroke-width'] = LINE_SIZE_F1.value*1;
	FLANGE2.style['stroke-width'] = LINE_SIZE_F2.value*1;



	//Create_Spoke_Holes(group        , base_id   , class1  , class2  , N  , scale , shd, offset)
	var f1_prefix = HUB_HOLE_ID_PREFIX + "1" + HUB_HOLE_MESOFIX;
	var f2_prefix = HUB_HOLE_ID_PREFIX + "2" + HUB_HOLE_MESOFIX;
	Create_Spoke_Holes( RIM_HOLES     , RIM_HOLE_ID_PREFIX , RIM_HOLE_CLASS, RIM_HOLE_CLASS, nr , erd/2 , shd, 0);
	Create_Spoke_Holes( FLANGE1_HOLES , f1_prefix, HUB_HOLE_CLASS, HUB_HOLE_CLASS, nf1, pcd1/2, shd, 0);
	Create_Spoke_Holes( FLANGE2_HOLES , f2_prefix, HUB_HOLE_CLASS, HUB_HOLE_CLASS, nf2, pcd2/2, shd, offset_f1_f2);


	Create_Spoke_Groups(1, 2, nr, nf1, sx1, 1, spoke_colors);
	Create_Spoke_Groups(3, 4, nr, nf2, sx2, 2, spoke_colors);


	Show_Hide_Class( SPOKE_GROUP_PREFIX + '1', SG1.checked); //Spokes are destroyed & re-created
	Show_Hide_Class( SPOKE_GROUP_PREFIX + '2', SG2.checked); // onchange of most settings.
	Show_Hide_Class( SPOKE_GROUP_PREFIX + '3', SG3.checked); //So, re-set their display states.
	Show_Hide_Class( SPOKE_GROUP_PREFIX + '4', SG4.checked); //


	G_WHEEL.setAttribute('transform', " rotate(" + rotate + ")");

	//##### Log(SVG_CONTAINER_DIV.innerHTML,1,1) //##### 
}//end Setup_Wheel() /*********************************************************/




function Clear_Wheel() { //****************************************************/
		RIM_HOLES	 .innerHTML = "";
		FLANGE1_HOLES.innerHTML = "";
		FLANGE2_HOLES.innerHTML = "";
		SPOKES		 .innerHTML = "";
}//end Clear_Wheel() //********************************************************/




function Error_Notice(what, msg) {//*******************************************/
	//what: id of changed input.
	if (typeof msg == 'undefined') { msg = "" }
	msg = "Invalid input: " + E(what).value + ".<br>" + msg;
	MESSAGE_DIV.innerHTML = msg;
	MESSAGE_BOX.style['visibility'] = "visible";
	PRIOR_FOCUS = what;
	E(what).value = PRIOR_VALUE; //Prior to change...
	setTimeout(function() {CLOSE_MSG.focus()},25); //Needed for <select>s. I don't know why.
}//end Error_Notice() //*******************************************************/





function Close_Message() { //**************************************************/
	MESSAGE_BOX.style['visibility'] = "hidden";
	MESSAGE_DIV.innerHTML = "";
	if (E(PRIOR_FOCUS).tagName == "INPUT") { E(PRIOR_FOCUS).select() }
	E(PRIOR_FOCUS).focus();
}//end Close_Message() { //****************************************************/




//##### ########################################################################
//##### make seperate validate function for SX & others, along with a "common" 
//Validate.
//##### ########################################################################




function Validate_Setting(input) { //******************************************/

	var id = input.id
	var value = input.value * 1;

	//Check if basic "cleaned" value from Build_Wheel() has really changed.
	if (input && (input.value == PRIOR_VALUE)) { return false }


	if ((id == NR.id) || (id == NF[1].id) || (id == NF[2].id)) {
		
		if (value > MAX[id]) //(value < 1) ||
		{
			var msg = "Valid range for N<sub>R</sub> & N<sub>F</sub>'s:<br>1 to " + MAX[id] + ".<br>";
			Error_Notice(id, msg);
			return false;
		}
		
		if ((WHEEL_TYPE.value != 2) && ( NF[1].value*1 > NF[2].value*1)) { //WHEEL_TYPE.value=2 is "Custom"
			var msg = "Number of flange holes (N<sub>F</sub>): Side 1  must be less than or equal to Side 2.<br>";
			Error_Notice(id, msg);
			return false;
		}


		/***********************./ //##### ##########
		//##### Not sure if these checks are helpful or a hinderance.
		//In the abstract, they are helpful.  But practically, the way things are currently 
		//laid out & inter-operate, they are not.
		
		if (id != NR.id) {
			var f = id.substring(2); //get flange (1 or 2)
			if ((value % 2 != 0) && ( SX[f].value*1 != 0)) {
				var msg = "Spoke cross must be 0 if flange has an odd number of spoke holes.<br>";
				Error_Notice(id, msg);
				return false;
			}
		}
		
		if ( (NF[1].value*1 + NF[2].value*1) > NR.value*1) {
			var msg = "Sum of flange holes cannot exceed number of rim holes.<br>";
			msg += "Increase NR, or decrease the other NF first.";
			Error_Notice(id, msg);
			return false;
		}
		/************************/ //##### ##########
		
		
	} else if ((id == SX[1].id) || (id == SX[2].id)) { //#####
		
		var f = id.slice(-1); //get flange (the last char of the id: 1 or 2)

		//Long past practical, and the point things repeat or logically break...
		if (value > NF[f].value*1) {
			var msg = "Spoke cross cannot exceed spoke count for flange.";
			Error_Notice(id, msg);
			return false;
		}
		
		if ((NF[f].value % 2 != 0) && (value != 0)) {
			var msg = "Spoke cross must be 0 if flange has an odd number of spoke holes (" + NF[f].value + ").";
			Error_Notice(id, msg);
			return false;
		}
	}


	if (isNaN(value)) {
		Error_Notice(id);
		return false;
	}

	PRIOR_VALUE = value; //Also set in onfocus events.

	return true;
}//end Validate_Setting() //***************************************************/




function Build_Wheel(input) { //***********************************************/

	//##### Log(); //##### Clear the 'CONSOLE'.

	var Spoke_Colors	= ["", COLOR1.value, COLOR2.value,  COLOR3.value, COLOR4.value ];

	if ( input ) { 
		var id = input.id;
		input.value = input.value.trim();

		if (input.value != "") {
			
			//These must be integers
			if ( (id == ERD.id)   || (id == NR.id) || (id == NF[1].id) || (id == NF[2].id) || 
				(id == SX[1].id) || (id == SX[2].id) ) {
				input.value = Math.abs( Math.floor( parseInt(input.value) ) );
			}
			
			//These can be floats.
			if ( (id == PCD[1].id) || (id == PCD[2].id) || 
				(id == FTC[1].id) || (id == FTC[2].id) )
			{
				input.value = Math.abs(parseFloat(input.value));
			}
			
			if (!Validate_Setting(input)) { return }
		}
	}

  //Setup_Wheel(ERD, NR, NF1, NF2, PCD1, PCD2, SX1, SX2, SHD, Spoke_Colors)
	Setup_Wheel( ERD.value*1, NR.value*1, NF[1].value*1, NF[2].value*1,
				 PCD[1].value*1, PCD[2].value*1, SX[1].value*1, SX[2].value*1,
				 HOLESIZE.value*1, Spoke_Colors
				);


	//##### Spoke_Length_Calculator(1);
	//##### Spoke_Length_Calculator(2);

}//end Build_Wheel() //********************************************************/




function Setup_Viewbox() { //**************************************************/

	var erd = ERD.value*1;
	var rim = LINE_SIZE_R.value*1;
	var total = erd + rim * 2;
	
	if (total > 600) { var view_box_size = total + 30 } else { var view_box_size = 610 }

	//Setup viewbox...
	var view_W = view_box_size; //Width
	var view_H = view_box_size; //Height
	var V_offset = (-view_H/2); //Vertical Offset
	SVG_WHEEL.setAttribute('width',  view_W);
	SVG_WHEEL.setAttribute('height', view_H);
	SVG_WHEEL.setAttribute('viewBox', (-view_W/2) + " " + V_offset + " " + view_W + " " + view_H);

	//Set xy axis...
	var max_XY = view_box_size/2;
	X_axis.setAttribute('x1', -max_XY);
	X_axis.setAttribute('y1', 0);
	X_axis.setAttribute('x2',  max_XY);
	X_axis.setAttribute('y2', 0);

	Y_axis.setAttribute('x1', 0);
	Y_axis.setAttribute('y1', -max_XY);
	Y_axis.setAttribute('x2', 0);
	Y_axis.setAttribute('y2',  max_XY);

}//end Setup_Viewbox() { //****************************************************/




function Show_Hide_Class(classname, show) { //*********************************/
	var items = D.getElementsByClassName(classname);

	for (var s = 0; s < items.length; s++)
	{
		if (show) { items[s].style['display'] = "" ;   }
		else 	  { items[s].style['display'] = "none" }
	}
}//end Show_Hide_Class() //****************************************************/




function Show_Hide(what, show) { //**********************************************/
	if (show) { what.style['display'] = ""     }
	else 	  { what.style['display'] = "none" }
}//end Show_Hide() //**********************************************************/




function Set_Style_by_Class(classname, style, value) { //**********************/
	var objects = D.getElementsByClassName(classname);
	for (var s = 0; s < objects.length; s++) { objects[s].style[style] = value; }
}//end Set_Style_by_Class() //*************************************************/




function Set_Attribute_by_Class(classname, attribute, value) { //**************/
	var objects = D.getElementsByClassName( classname );
	for (var x = 0; x < objects.length; x++) { objects[x].setAttribute( attribute, value ); }
}//end Set_Style_by_Class() //*************************************************/




function Setup_Wheel_Type() { //***********************************************/

	if (WHEEL_TYPE.value == 0) { //"Standard" wheels
		
		//Round up to next possible "standard" spoke count (divisible by 4).
		var NR_mod4 = (NR.value*1) % 4;
		if(NR_mod4 != 0) { NR.value = NR.value*1 + (4 - NR_mod4); }
		
		NF[1].value = NR.value/2;
		NF[2].value = NR.value/2;
		NF[1].readOnly = true;
		NF[2].readOnly = true;
		NF[1].tabIndex = -1;
		NF[2].tabIndex = -1;
	} else 
	
	if (WHEEL_TYPE.value == 1) { //"Triplet"
		NR.value = 24; //Just a likely value for default. User can change.
		
		NF[1].value = NR.value/3;
		NF[2].value = NF[1].value*2;
		NF[1].readOnly = true;
		NF[2].readOnly = true;
		NF[1].tabIndex = -1;
		NF[2].tabIndex = -1;
		
		if (NR.value*1 > 23) {
			SX[1].value = 0;
			SX[2].value = 3;
		} else {
			SX[1].value = 0;
			SX[2].value = 2;
		}
		
	} else { //"Custom"
		NF[1].readOnly = false;
		NF[2].readOnly = false;
		NF[1].tabIndex = 0;
		NF[2].tabIndex = 0;
	}
}//end Setup_Wheel_Type() { //*************************************************/




function Assign_Input_Events() { //********************************************/

	//Save prior/existing value in case of error in new value.
	var settings = [WHEEL_TYPE.id, ERD.id, NR.id, NF[1].id, NF[2].id, PCD[1].id, PCD[2].id, FTC[1].id, FTC[2].id, OSB[1].id, OSB[2].id, SX[1].id, SX[2].id, SHD.id];
	for (var x = 0; x < settings.length; x++) {
		//PRIOR_VALUE also set at end of Validate_Setting().
		E(settings[x]).addEventListener("focus", function() { PRIOR_VALUE = this.value; } )
	}


	LOAD_SAMPLES.addEventListener("click", function () { Load_samples() } )


	WHEEL_TYPE.addEventListener("change", function(event) {
		Setup_Wheel_Type()		
		Build_Wheel(this);
	} );

	ERD.addEventListener("change", function() { Build_Wheel(this); Setup_Viewbox(); } )


	NR.addEventListener("change", function(event) {

		//##### if (!Validate_Setting(this)) { return } //##### 

		if ((NR.value*1 > MAX[NR.id])) { //(NR.value*1 < 1) ||
			var msg = "Valid range for N<sub>R</sub> & N<sub>F</sub>'s:<br>1 to " + MAX[NR.id] + ".<br>";
			Error_Notice(NR.id, msg);
			return false;
		}
		
		if (WHEEL_TYPE.value == 0) { //Standard wheel lacings
			
			//NR must be even in standard wheels.
			if(this.value%2 != 0) {
				var msg = "Number of rim spoke holes for a standard wheel must be even.";
				Error_Notice(NR.id, msg);
				return false;
			}
			
			//Also, if NR is not divisible by 4, cross can only be 0.
			if(this.value%4 != 0) { SX[1].value = 0; SX[2].value = 0; }
			
			NF[1].value = NR.value/2;
			NF[2].value = NR.value/2;
		} else
		if (WHEEL_TYPE.value == 1) { //Triplets
			//NR must be divisible by 3.
			if (this.value%3 != 0) {
				var msg= "N<sub>R</sub> must be divisible by 3 for type Triplet.";
				Error_Notice(this.id, msg);
				this.value = PRIOR_VALUE;
				return false;
			}
			NF[1].value = NR.value/3;
			NF[2].value = NF[1].value*2;

			//In triplets, if NR is odd, NF[1] is odd, so SX[1] must be 0.
			var NR_mod2 = (NR.value*1) % 2;
			if (NR_mod2 != 0) { SX[1].value = 0 }
			
			//Practical default cross values for most common triplets (21, 24, or 27 spokes).
			if (NR.value*1 > 23) { SX[2].value = 3 } else { SX[2].value = 2 }
		}

		
		//##### If NR==0, just clear the wheel - don't "Build_Wheel()"...
		if (NR.value*1 == 0) {
			SL[1].value = '';
			SL[3].value = '';
			// SL[2].value = ''; SL[4].value = ''; //
			Clear_Wheel();
		} 
		else {
			Build_Wheel(this)
		}
	} );


	NF[1] .addEventListener("change", function() { Build_Wheel(this) } )
	NF[2] .addEventListener("change", function() { Build_Wheel(this) } )
	PCD[1].addEventListener("change", function() { Build_Wheel(this) } )
	PCD[2].addEventListener("change", function() { Build_Wheel(this) } )
	FTC[1].addEventListener("change", function() { Build_Wheel(this) } )
	FTC[2].addEventListener("change", function() { Build_Wheel(this) } )
	SX[1] .addEventListener("change", function() { Build_Wheel(this) } )
	SX[2] .addEventListener("change", function() { Build_Wheel(this) } )
	LACE_OPT.addEventListener("change", function() { Build_Wheel(this) } )
	
	// Only need to recalc final spoke lengths. OSB & SHD are ignored in calculations for <line> endpoints.
	OSB[1].addEventListener("change", function() { this.value = parseFloat(this.value); Calc_All_Spoke_Lengths(this) } )
	OSB[2].addEventListener("change", function() { this.value = parseFloat(this.value); Calc_All_Spoke_Lengths(this) } )
	SHD   .addEventListener("change", function() { this.value = Math.abs(parseFloat(this.value)); Calc_All_Spoke_Lengths(this) } )

	SHOW_HIDE_DO.addEventListener("click", function() {	Show_Hide_Options(this, DISPLAY_OPTIONS.id, "inline-block")	} )

	COLOR1.addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + '1', "stroke", this.value) } )
	COLOR2.addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + '2', "stroke", this.value) } )
	COLOR3.addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + '3', "stroke", this.value) } )
	COLOR4.addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + '4', "stroke", this.value) } )

	SG1.addEventListener("change", function() { Show_Hide_Class( SPOKE_GROUP_PREFIX + '1', this.checked) } )
	SG2.addEventListener("change", function() { Show_Hide_Class( SPOKE_GROUP_PREFIX + '2', this.checked) } )
	SG3.addEventListener("change", function() { Show_Hide_Class( SPOKE_GROUP_PREFIX + '3', this.checked) } )
	SG4.addEventListener("change", function() { Show_Hide_Class( SPOKE_GROUP_PREFIX + '4', this.checked) } )

	//Spoke size (width). Affects display of spokes only (not calcs).
	SD.addEventListener("change", function() { 
		for (var group=1; group <= 4; group++) {
			Set_Style_by_Class( SPOKE_GROUP_PREFIX + group , "stroke-width", this.value);
		}
	} )

	COLOR_R .addEventListener("change", function() { RIM	.style['stroke'] = this.value } )
	COLOR_F1.addEventListener("change", function() { FLANGE1.style['stroke'] = this.value } )
	COLOR_F2.addEventListener("change", function() { FLANGE2.style['stroke'] = this.value } )

	LINE_SIZE_R.addEventListener("change", function() {
		var rim_radius = ERD.value/2 + this.value/2 - .5;
		RIM.setAttribute('r', rim_radius);
		RIM.style['stroke-width'] = this.value;
		Setup_Viewbox();
	} )

	LINE_SIZE_F1  .addEventListener("change", function() { FLANGE1.style['stroke-width'] = this.value } )
	LINE_SIZE_F2  .addEventListener("change", function() { FLANGE2.style['stroke-width'] = this.value } )
	LINE_SIZE_AXES.addEventListener("change", function() { Set_Style_by_Class(AXIS_CLASS, 'stroke-width', this.value) } )

	SHOW_R .addEventListener("change", function() { Show_Hide(RIM    , this.checked) } )
	SHOW_F1.addEventListener("change", function() { Show_Hide(FLANGE1, this.checked) } )
	SHOW_F2.addEventListener("change", function() { Show_Hide(FLANGE2, this.checked) } )

	COLOR_AXES.addEventListener("change", function() { Set_Style_by_Class( AXIS_CLASS, "stroke", this.value ) } )
	SHOW_AXES .addEventListener("change", function() { Show_Hide_Class( AXIS_CLASS, this.checked ) } )

	HOLESIZE.addEventListener("change", function() {
		//set *radius* of holes (this.value/2)
		Set_Attribute_by_Class( RIM_HOLE_CLASS, 'r', this.value/2)
		Set_Attribute_by_Class( HUB_HOLE_CLASS, 'r', this.value/2)
	} )


	CLOSE_MSG.addEventListener("blur" , function() { Close_Message() } )
	CLOSE_MSG.addEventListener("click", function() { Close_Message() } )
}//end Assign_Input_Events() //************************************************/




function WH_Init() { //********************************************************/
	//Load default values.
	WHEEL_TYPE.selectedIndex = DEFAULTS_WHEEL['WHEEL_TYPE'];

	ERD   .value = DEFAULTS_WHEEL['ERD'];
	NR    .value = DEFAULTS_WHEEL['NR'];
	NF[1] .value = DEFAULTS_WHEEL['NF1'];
	NF[2] .value = DEFAULTS_WHEEL['NF2'];
	PCD[1].value = DEFAULTS_WHEEL['PCD1'];
	PCD[2].value = DEFAULTS_WHEEL['PCD2'];
	FTC[1].value = DEFAULTS_WHEEL['FTC1'];
	FTC[2].value = DEFAULTS_WHEEL['FTC2'];
	OSB[1].value = DEFAULTS_WHEEL['OSB1'];
	OSB[2].value = DEFAULTS_WHEEL['OSB2'];
	SX[1] .value = DEFAULTS_WHEEL['SX1'];
	SX[2] .value = DEFAULTS_WHEEL['SX2'];
	SHD   .value = DEFAULTS_WHEEL['SHD'];

	LACE_OPT.selectedIndex = DEFAULTS_WHEEL['LACE_OPT']; //The index (0 or 1) is used in Lacing_Option().
	
	COLOR1.value = DEFAULTS_DISPLAY['COLOR1'];
	COLOR2.value = DEFAULTS_DISPLAY['COLOR2'];
	COLOR3.value = DEFAULTS_DISPLAY['COLOR3'];
	COLOR4.value = DEFAULTS_DISPLAY['COLOR4'];
	SG1 .checked = DEFAULTS_DISPLAY['SG1'];
	SG2 .checked = DEFAULTS_DISPLAY['SG2'];
	SG3 .checked = DEFAULTS_DISPLAY['SG3'];
	SG4 .checked = DEFAULTS_DISPLAY['SG4'];
	SD  .value   = DEFAULTS_DISPLAY['SD']; //Spoke Diameter, or Size. Affects display of spokes only (not calcs).

	COLOR_R .value   = DEFAULTS_DISPLAY['COLOR_R'];
	COLOR_F1.value   = DEFAULTS_DISPLAY['COLOR_F1'];
	COLOR_F2.value   = DEFAULTS_DISPLAY['COLOR_F2'];
	LINE_SIZE_R .value = DEFAULTS_DISPLAY['LINE_SIZE_R'];
	LINE_SIZE_F1.value = DEFAULTS_DISPLAY['LINE_SIZE_F1'];
	LINE_SIZE_F2.value = DEFAULTS_DISPLAY['LINE_SIZE_F2'];
	SHOW_R  .checked = DEFAULTS_DISPLAY['SHOW_R'];
	SHOW_F1 .checked = DEFAULTS_DISPLAY['SHOW_F1'];
	SHOW_F2 .checked = DEFAULTS_DISPLAY['SHOW_F2'];

	COLOR_AXES.value     = DEFAULTS_DISPLAY['COLOR_AXES'];
	LINE_SIZE_AXES.value = DEFAULTS_DISPLAY['LINE_SIZE_AXES'];
	SHOW_AXES .checked   = DEFAULTS_DISPLAY['SHOW_AXES'];

	HOLESIZE  .value   = DEFAULTS_DISPLAY['HOLESIZE']; //Affects displayed spoke hole size only.

	//end Loading default values

	Setup_Viewbox();

	Assign_Input_Events();

	Build_Wheel();

	//Reduces visually jarring jumping around of elements as page builds during page load.
	CONTAINER.style['visibility'] = "visible";
	CONTAINER.style.opacity = '1'

	ERD.focus();
}//end WH_Init() //************************************************************/


document.addEventListener("keydown", function(event) {scroll_blur(event)} );
window.addEventListener("load", function(){WH_Init()} );
//*****************************************************************************/
})();</script>
