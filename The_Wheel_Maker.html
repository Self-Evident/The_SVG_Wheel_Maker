<!DOCTYPE html>
<meta charset="utf-8"/>



<!--============================================================================
The Wheel Maker
v1.02


Copyright Â© 2017 https://github.com/Self-Evident

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
=============================================================================-->



<title>The Wheel Maker &amp; Spoke Length Calculator</title>


<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { overflow-y: scroll; }


/*** The prefix "WH_" simple means "WHeel" ***/


#WH_notes p {margin-top: .6rem;}

hr.WH {margin: .5rem 0;}

button.WH::-moz-focus-inner { border: 0 }
input.WH:focus, select.WH:focus, button.WH:focus { box-shadow: 0 0 3pt 1pt #006060 }
input[disabled].WH, select.WH:disabled {
	color			: #444;
	background-color: #ddd;
	border			: solid .5px #999;
	padding			: 1px 0 1px 0
}
select.WH { padding-left: .3rem; width: 3.5rem; font-size: .9rem}
select.WH option { padding-left: .5rem }


/* Removes that annoying dotted onfocus outline of FF selects */
select.WH:-moz-focusring {
	color: transparent;
	text-shadow: 0 0 0 #000;
}

#WH_CONTAINER {
	border: 0;
	margin: auto;
	text-align: center;
	padding: 1rem 0 0 0;
	visibility: hidden;		/* opacity & visibility changed at end of onload. */
	opacity: 0;
	transition: opacity .7s;
}

#WH_The_SVG    { width: 630px; display: inline-block; border: 0; }

#WH_WHEEL_TYPE { margin: .3rem 0 .8rem 1rem; padding-left: .1rem; width: 8rem; }

#WH_LACE_OPT   { margin: .5rem 0 .5rem 0; }
#WH_left_side  { display: inline-block; vertical-align: top; position: relative; border: 0; }

table.WH {
	display: inline-table;
	width: 16rem;
	font-family: arial;
	text-align: center;
	border			: solid 1px #444;
	border-collapse	: separate;
	border-radius	: 8px;
	border-spacing	: 3px;
	background-color: rgb(175,198,205);  /** #ccc; **/
	vertical-align: top;
}

table.WH td { padding: 0 0 0 0; border: 0; }
table.WH th { height: 2.2rem; font-size: 1.1rem; border-bottom: solid 2px #333}

table.WH .WH_thv { text-align: left; padding: 0 0 0 3px; width: 6.8rem; font-weight: bold; }
table.WH input   { width: 3.5rem; text-align: center; font: 1rem courier; }
table.WH .WH_color { width: 6rem; }

.WH_load_clear { margin: 0; padding: 0 .2rem; }

.WH_separator { padding: 0; height: .3rem; }

.WH_containers { display: inline-block; vertical-align: top; margin: 0 .5rem; }

#WH_display_options  { display: none; vertical-align: top; border: 0; } 

#WH_show_hide_notes { margin: 0 0 0 0; }

#WH_notes  {
	vertical-align: top;
	border: solid 0px black;
	font-family: arial;
	text-align: left;
	border-radius: 10px;
	display: none;
	padding: 0 0 0 0;
}

#WH_notes td { padding: .2rem .2rem .2rem .5rem; border: solid 1px #555; }
#WH_notes th { padding: .2rem .5rem .2rem .2rem; border: solid 1px #555; }
#WH_notes th.WH_th1 { font-size: 1.2rem; text-decoration: none; }
#WH_notes th.WH { width: 9rem; }


.WH_ndo_buttons {
	display: block;
	min-width: 11rem;
	width: 100%;
	height: 2rem;
	margin: .3rem auto .3rem auto;
	padding: 3px .5rem; ;
	text-align: center;
	font: normal 1.2rem arial;
	border: solid 1px #444;
	border-radius: 7px;
	background-color: #F9F9F9;
	background: linear-gradient(to bottom, #CCC, #EEE, #EEE, #CCC);
}

.WH_ndo_buttons:focus  { background: linear-gradient(to bottom, #CCC, #FFF, #FFF, #CCC); }
.WH_ndo_buttons:hover  { background: linear-gradient(to bottom, #bbb, #FFF, #FFF, #bbb); }
.WH_ndo_buttons:active { background: linear-gradient(to bottom, #EEE, #ddd, #ddd, #EEE); padding: 3px 2px 1px 2px; }



.WH_reset_options {
	font-size: .8rem;
	padding: 0 .2rem;
	float: right;
	margin: 0 0 .2rem -2rem;
}


#WH_rim	 { fill: none; stroke: #999; }
.WH_svg	 { display: inline-block; margin: auto; border: 0; }
.WH_axis { stroke: #999; stroke-width: 1; stroke-dasharray: 3,3; }
.WH_rsh	 { fill: none; stroke: #777; } /*rim spoke holes*/
.WH_hsh	 { fill: none; stroke: #777; } /*hub spoke holes*/
.WH_hsh2 { fill: none; stroke: #ccc; } /*hub spoke holes 2*/
.WH_spoke{ fill: none; stroke: #000; stroke-width: 2; }
.WH_pcd	 { fill: none; stroke: #000; stroke-width: 1; }

.WH_desc { font-siZe: .8rem }
.WH_th1	 { height: 1.0rem; text-decoration: underline; font-weight: bold; }
.WH_th2	 { height: 1.8rem; text-decoration: underline; }

table.WH .WH_th3 th{ height: 1.5rem; font-size: 1rem; border: 0; vertical-align: bottom; }


table.WH td.WH_SL { height: 2rem; }
table.WH td.WH_SL input { width: 5rem; text-align: center; font-size: 1rem; font-weight: bold; margin: 0; }
table.WH td.WH_SLS1 { padding: 0 0 0 1.5rem; height: .8rem; }
table.WH td.WH_SLS2 { padding: 0 1.5rem 0 0; height: .8rem; }

table.WH tr.WH_SLH2 { height: 1.5rem; vertical-align: bottom }

#WH_SL_2_4 { display: none; } /**Set to table-row in Setup_Wheel() if needed.**/

table#WH_advanced_info.WH { border-spacing: 2px; display: inline-block; }
#WH_advanced_info td { font-size: .9rem; text-align: left; padding-left: .2rem; }

select.WH_elbows_laced { padding-left: 0px; font-size: .8rem; width: 4.1rem; }

#WH_advanced_info .lesser_settings td 	   { font-size: .8em; padding-left: .5rem; }
#WH_advanced_info .lesser_settings td input { font-size: .9em; width: 2rem; }

#WH_assumes { font-weight: bold }

#WH_other_calcs { font-family: arial; text-align: left; display: none; }

#WH_MSG_HEADER {
	margin			: auto;
	text-align		: center;
	font-weight		: bold;
	text-decoration : underline;
}

#WH_msg_box {
	vertical-align: top;
	width: 18rem;
	position: absolute;
	top		: 5.5rem;
	left	: 13.5rem;
	border	: solid 2px red;
	border-radius	: 5px;
	padding			: .5rem .5rem .5rem .5rem; 
	background-color: white;
	font-family		: arial;
	text-align		: center;
	visibility		: hidden;  /** toggled in Error_Notice() **/
	max-height: 30rem;
	overflow-y: auto;
}


#WH_close_msg {
	height	: 1.3rem;
	width	: 1.5rem;
	float: right;
	margin: -.5rem -.5rem .5rem .5rem;
	padding	: 2px 0 3px 0 ;
	text-align	: center;
	font		: normal .9rem arial;
	border			: solid 1px #444;
	border-radius	: 3px;
	background-color: #F9F9F9;
}


#WH_ACCEPT_MSG { font-size: 1.2rem; margin: 1rem 0; padding: 2px; }
</style>






<div id=WH_CONTAINER><!--====================================================-->
<div id=WH_left_side><!--==========================================-->

<div id=WH_msg_box>
	<button id=WH_close_msg class=WH>X</button>
	<div id=WH_message><br></div>
	<button id=WH_ACCEPT_MSG class=WH>I Accept</button>
</div>

<table class=WH id=WH_settings>
<tr><th colspan=2>Wheel Settings</th></tr>

<tr><td colspan=2>
		<button type=button id=WH_load_samples   class="WH WH_load_clear">Load Sample Values</button> 
		<button type=button id=WH_clear_settings class="WH WH_load_clear">Clear Values</button>
</td></tr>
<tr><td colspan=2></td></tr>

<tr>
	<td colspan=2><b>Type</b>
		<select id=WH_WHEEL_TYPE class=WH>
			<option value="standard">Standard</option>
			<option value="triplet" >Triplet</option>
			<option value="custom"  >Custom</option>
			<!-- option>Paired Hole Hub</option //Coming soon to a spoke calculator near you! -->
		</select>
		<br>
	</td>
</tr>

<tr><td class=WH_thv>ERD</td><td><input id=WH_ERD class=WH type=text maxlength=5></td></tr>

<tr><td class=WH_thv>Rim Holes</td><td>
		<!-- input id=WH_NR class=WH type=text maxlength=2 -->
		<!-- <option>s added at runtime. -->
		<select id=WH_NR class=WH></select>
</td></tr>

<tr><td></td><td>Side 1 &nbsp;Side 2</td></tr>

<tr>
	<td class=WH_thv>Flange Holes</td>
	<td>
		<input id=WH_NF1 class=WH type=text maxlength=2>
		<input id=WH_NF2 class=WH type=text maxlength=2>
	</td>
</tr>
<tr>
	<td class=WH_thv>PCD</td>
	<td>
		<input id=WH_PCD1 class=WH type=text maxlength=5>
		<input id=WH_PCD2 class=WH type=text maxlength=5>
	</td>
</tr>
<tr>
	<td class=WH_thv>Flange Offset</td>
	<td>
		<input id=WH_FTC1 class=WH type=text maxlength=5>
		<input id=WH_FTC2 class=WH type=text maxlength=5>
	</td>
</tr>
<tr>
	<td class=WH_thv>OC Rim</td>
	<td>
		<input id=WH_OSB1 class=WH type=text maxlength=4>
		<input id=WH_OSB2 class=WH type=text maxlength=4>
	</td>
</tr>

<tr>
	<td class=WH_thv>Cross</td>
	<td>
		<!-- <option>s added at runtime. -->
		<select id=WH_SX1 class=WH></select>
		<select id=WH_SX2 class=WH></select>
	</td>
</tr>

<tr>
	<td class=WH_thv>SHD</td>
	<td><input id=WH_SHD class=WH type=text maxlength=4></td>
</tr>

<tr>
	<td class=WH_thv>Lace Option:</td>
	<td>
		<select id=WH_LACE_OPT class=WH>
			<option value="-1">2&nbsp;</option>
			<option value=" 1" selected>1&nbsp;</option>
		</select>
	</td>
</tr>
</table><!--//end Wheel Settings -->
<br>
<br>


<table class=WH id=WH_spoke_lengths>
	<tr><th colspan=2>Spoke Lengths</th></tr>
	<tr class=WH_SLH2>
		<td class=WH_SLS1>Side 1</td>
		<td class=WH_SLS2>Side 2</td>
	</tr>

	<tr>
		<td  class="WH_SL WH_SLS1"><input id=WH_LENGTH1 type=text readonly tabindex="-1"></td>
		<td  class="WH_SL WH_SLS2"><input id=WH_LENGTH3 type=text readonly tabindex="-1"></td>
	</tr>

	<tr id=WH_SL_2_4>
		<td  class="WH_SL WH_SLS1"><input id=WH_LENGTH2 type=text readonly tabindex="-1"></td>
		<td  class="WH_SL WH_SLS2"><input id=WH_LENGTH4 type=text readonly tabindex="-1"></td>
	</tr>
	
	<tr class=WH_separator><td colspan=2></td></tr>
</table>

<br><br>




<button type=button id=WH_show_hide_advanced class="WH WH_ndo_buttons" value=none>Advanced Build Info</button>
<table class=WH id=WH_advanced_info>
	<!-- tr><th colspan=3>Advanvced Build Info</th></tr -->
	<tbody id=WH_adv_info_tbody>
	<tr class=WH_separator><td colspan=3></td></tr>
	<tr class=lesser_settings><td colspan=2>Flange width at spoke holes:</td><td><input id=WH_FW  class="WH" type=text maxlength=4></td></tr>
	<tr class=lesser_settings><td colspan=2>Spoke diameter at bend:     </td><td><input id=WH_SDB class="WH" type=text maxlength=4></td></tr>

	<tr class=WH_separator><td colspan=3></td></tr>
	<tr><td></td><td>&nbsp; Side 1</td><td>&nbsp; Side 2</td></tr>
	<tr>
		<td>Elbows Laced</td>
		<td>
			<select id=WH_ELBOWS1 class="WH WH_elbows_laced">
				<option value="-1">In</option>
				<option value="0" >Center</option>
				<option value="1" >Out</option>
			</select>
		</td>
		<td>
			<select id=WH_ELBOWS2 class="WH WH_elbows_laced">
				<option value="-1">In</option>
				<option value="0" >Center</option>
				<option value="1" >Out</option>
			</select>
		</td>
	</tr>

	<tr class=WH_separator><td colspan=3></td></tr>
	<tr>
		<td>Length Adjust.</td>
		<td><input id=WH_SL_ADJ1 type=text readonly tabindex="-1"></td>
		<td><input id=WH_SL_ADJ2 type=text readonly tabindex="-1"></td>
	</tr>
	<tr>
		<td>Spoke Ratio</td>
		<td><input id=WH_spoke_ratio1 type=text readonly tabindex="-1"></td>
		<td><input id=WH_spoke_ratio2 type=text readonly tabindex="-1"></td>
	</tr>
	<tr>
		<td>Bracing Angles</td>
		<td><input id=WH_brace_angle1 type=text readonly tabindex="-1">&deg;</td>
		<td><input id=WH_brace_angle2 type=text readonly tabindex="-1">&deg;</td>
	</tr>
	<tr>
		<td>Tension Ratio</td>
		<td><input id=WH_tension_ratio1 type=text readonly tabindex="-1">%</td>
		<td><input id=WH_tension_ratio2 type=text readonly tabindex="-1">%</td>
	</tr>
	<tr class=WH_separator><td colspan=3></td></tr>
	</tbody>
</table>


	<br><br>
	<button type=button id=WH_show_hide_other class="WH WH_ndo_buttons" value="none">A few other calculators</button>
	<div id=WH_other_calcs>
	
		<a href="D-SC.1.html">D-SC 1<a/><br>
		<a href="D-SC.3.html">D-SC 3<a/><br>
	
		<hr class=WH>I have no affiliation with any of the <br> 
					 following calculators or websites.<br>
					 These links are provided for<br>
					 convenience and comparison only.<hr class=WH>
		<a href="https://www.sheldonbrown.com/rinard/spocalc.htm" target="_blank">Sheldon's SpoCalc</a><br>
		<a href="http://www.mrrabbit.net/wheelsbyfleming.php" target="_blank">Mr. Rabbit's SpokeChart v2-0</a><br>
		<a href="http://www.bikeschool.com/tools/spoke-length-calculator" target="_blank">Bike School</a><br>
		<a href="http://www.prowheelbuilder.com/spokelengthcalculator" target="_blank">Pro Wheel Builder</a><br>
		<a href="https://leonard.io/edd/" target="_blank">Edd</a><br>
		<a href="http://www.sapim.be/spoke-calculator" target="_blank">Sapim</a><br>
		<a href="https://spokes-calculator.dtswiss.com/en/" target="_blank">DT Swiss</a><br>
		<a href="http://www.wheelpro.co.uk/spokecalc/" target="_blank">Wheel Pro</a><br>
		<a href="https://biketechtools.com/spoke-length-calculator" target="_blank">Bike Tech Tools</a><br>
		<a href="http://www.kstoerz.com/freespoke/fullcalc" target="_blank">FreeSpoke</a><br>
	</div>

</div><!--//end WH_left_side ======================================-->





<div id=WH_The_SVG><!-- and Dispaly Options =======================-->
	<svg id="WH_svg_wheel" class="WH_svg" width="100%" height="100%">
		<title>Wheel</title>
		<g id="WH_axes">
			<line id="WH_x-axis" class="WH_axis"/>
			<line id="WH_y-axis" class="WH_axis"/>
		</g>
		
		<g id="WH_wheel">
			<circle id="WH_rim"	r=""/>
			<circle id="WH_flange1" class="WH_pcd" r=""/>
			<circle id="WH_flange2" class="WH_pcd" r=""/>
			
			<g id=WH_Holes_and_Spokes>
				<g id="WH_rim_holes"></g>
				<g id="WH_holes_f1"></g>
				<g id="WH_holes_f2"></g>
				<g id="WH_spokes"></g>
			</g>
		</g><!-- end id=WH_wheel -->
	</svg>



	<div class=WH_containers><!--Display Options button & table -->
		
		<button type=button id=WH_show_hide_DO class="WH WH_ndo_buttons" value=none>Display Options</button>
		
		<div id=WH_display_options><!--Display Options-->
			<table class=WH>
				<tr>
					<th colspan=4>Spokes
						<button type=button id=WH_reset_options_spokes class="WH WH_reset_options">Reset</button>
					</th>
				</tr>
				<tr class=WH_th3><th></th><th>Line</th><th>Line</th><th></th></tr>
				<tr class=WH_th1><td>Group</td><td>Color</td><td>Size</td><td>Show?</td></tr>
				<tr class=WH_th2><td colspan=4>Side 1</td></tr>
				<tr>
					<td>1</td>
					<td><input id=WH_SPOKE_COLOR1 class="WH WH_color" type=text></td>
					<td><input id=WH_SPOKE_LINE_SIZE1 class=WH type=text></td>
					<td><input id=WH_SPOKE_SHOW1  class=WH type=checkbox></td>
				</tr>
				<tr>
					<td>2</td>
					<td><input id=WH_SPOKE_COLOR2 class="WH WH_color" type=text></td>
					<td><input id=WH_SPOKE_LINE_SIZE2 class=WH type=text></td>
					<td><input id=WH_SPOKE_SHOW2  class=WH type=checkbox></td>
				</tr>
				<tr class=WH_separator><td colspan=4></td></tr>
				<tr class=WH_th2><td colspan=4>Side 2</td></tr>
				<tr>
					<td>3</td>
					<td><input id=WH_SPOKE_COLOR3 class="WH WH_color" type=text></td>
					<td><input id=WH_SPOKE_LINE_SIZE3 class=WH type=text></td>
					<td><input id=WH_SPOKE_SHOW3  class=WH type=checkbox></td>
				</tr>
				<tr>
					<td>4</td>
					<td><input id=WH_SPOKE_COLOR4 class="WH WH_color" type=text></td>
					<td><input id=WH_SPOKE_LINE_SIZE4 class=WH type=text></td>
					<td><input id=WH_SPOKE_SHOW4  class=WH type=checkbox></td>
				</tr>
				<tr class=WH_separator><td colspan=4></td></tr>
			</table>
			
			<table class=WH>
				<tr>
					<th colspan=4>
						Rim, Flange &amp; Axes
						<button type=button id=WH_reset_options_rim_etc class="WH WH_reset_options">Reset</button>
					</th>
				</tr>
				<tr class=WH_th3><th></th><th>Line</th><th>Line</th><th></th></tr>
				<tr class=WH_th1><td></td><td>Color</td><td>Size</td><td>Show?</td></tr>
				<tr>
					<td>Rim</td>
					<td><input id=WH_RIM_COLOR class="WH WH_color" type=text></td>
					<td><input id=WH_RIM_LINE_SIZE  class=WH type=text></td>
					<td><input id=WH_RIM_SHOW  class=WH type=checkbox></td>
				</tr>
				<tr>
					<td>F1</td>
					<td><input id=WH_F1_COLOR class="WH WH_color" type=text></td>
					<td><input id=WH_F1_LINE_SIZE  class=WH type=text></td>
					<td><input id=WH_F1_SHOW  class=WH type=checkbox></td>
				</tr>
				<tr>
					<td>F2</td>
					<td><input id=WH_F2_COLOR class="WH WH_color" type=text></td>
					<td><input id=WH_F2_LINE_SIZE  class=WH type=text></td>
					<td><input id=WH_F2_SHOW  class=WH type=checkbox></td>
				</tr>
				<tr>
					<td>Holes</td>
					<td><input id=WH_HOLE_COLOR class="WH WH_color" type=text></td>
					<td><input id=WH_HOLE_LINE_SIZE class=WH type=text></td>
					<td><input id=WH_HOLES_SHOW class=WH type=checkbox></td>
				</tr>
				<tr><td colspan=4>Hole Diameter <input id=WH_HOLESIZE class=WH type=text></td></tr>
				<tr><td colspan=4 class=WH_desc>(Affects displayed size only.)</td></tr>
				<tr class=WH_separator><td colspan=4></td></tr>
				<tr>
					<td>Axes</td>
					<td><input id=WH_AXES_COLOR class="WH WH_color" type=text></td>
					<td><input id=WH_AXES_LINE_SIZE  class=WH type=text></td>
					<td><input id=WH_AXES_SHOW  class=WH type=checkbox></td>
				</tr>
				<tr class=WH_separator><td colspan=4></td></tr>
			</table>
		</div><!--//end Display Options ==============-->
	</div><!--//end Display Options <button> & <table>s & <reset>-->
</div><!--//end WH_The_SVG ========================================-->




<br>
	<div class=WH_containers><!-- Notes button & table -->
		<button type=button id=WH_show_hide_notes class="WH WH_ndo_buttons" value=none>Notes</button>
		<table id=WH_notes>
			<tr><th class=WH>Disclaimer</th>
				<td>
					<div id=WH_responsibility>
						<p id=WH_assumes class=WH>In all cases, the user assumes full responsibility for the use of any spoke length, image, or other output of this program.
					</div>
					<div>
						<p class=WH>Like every spoke length calculator, this is a simple utility, and can not determine the validity of every possible combination of rim and hub values.
						<p class=WH>That is, just because the program many generate a theoretical wheel on screen from a given set of inputs, does not guarantee that such a wheel is realistically practical, or possible. Or even that all required spokes lengths are listed.  The preceding will more likely become evident in Custom mode, as it has fewer restrictions on rim &amp; hub values than Standard &amp; Triplet modes.  And while it will generally be obvious when values produce an unrealistic wheel, again, there are no guarantees.
						<p class=WH>For additional information, please refer to geometry. And physics.
					</div>
				</td>
			</tr>

			<tr><th class=WH></th>
				<th>Wheel Settings
					<p>All measurement settings are mm (millimeters).
				</th>
			<tr><th class=WH>Rim Holes</th><td>Number of spoke holes in the Rim. Most of the time, this will be the same as the number of spokes.</td></tr>
			<tr><th class=WH>Flange Holes</th><td>Number of spoke holes in the Flange. Normally, the number of holes in each hub flange is 1/2 of the number of holes in the rim, and 1/2 the spoke count. One notable exception is a triplet laced wheel.  Additionally, if the number of flange holes is odd (not even), the spoke cross for that side must be, and is automatically set to, zero.</td></tr>
			<tr><th class=WH>PCD</th><td>"Pitch Circle Diameter" - diameter of circle running thru the spoke hole centers in the flange. Also referred to as the hub or flange diameter.</td></tr>
			<tr><th class=WH>Flange Offset</th><td> The distance the flange is offset from the hub center.  Also referred to as "Flange to Center", or "Center to Flange", etc.  It is used in the spoke length calculation, but does't affect the displayed image of the wheel.</td></tr>
			<tr><th class=WH>OC</th>
				<td>"Off-Center" - May also be referred to as "OSB", "Offset Spoke bed", "asymetrical", or similar terms.
					<p>The spoke holes in the rim are "off-center", or "off-set", to one side.
					<p>Useage: Enter a (-)negative number for the side that the holes are closer to (spokes will be a tiny bit shorter); and enter a (+)positive number for the side that the holes are further from (spoke will be a tiny bit longer).
					<p>For example, on a rear wheel rim with a 3mm offset, enter -3 for "Side 1" (the left/non-drive side), and 3 for "Side 2" (the right/drive side).
					<p>As with Flange Offset, it does not affect the displayed wheel.
				</td>
			</tr>
			<tr><th class=WH>Cross</th>
				<td>"Spoke Cross" value.  Number of spokes each spoke crosses on the same side of wheel.
					<p>In Standard and Triplet modes, spoke crossings are automatically set to common values for a given rim hole count, but can be changed if desired.  Additionally, the cross must be zero if the number of holes in the flange is odd (not even).
					<p>In Custom mode, if the number of flange holes is odd, cross can be non-zero, but all spokes on that side will be laced the same direction.  Spokes on the opposite flange will be laced in the opposite direction if they are also odd, otherwise they will be laced normally.
				</td>
			</tr>
			<tr><th class=WH>SHD</th><td>"Spoke Hole Diameter". Like FtC &amp; OSB, this value only affects final spoke length, and not the wheel as displayed.</td></tr>
			<tr><th class=WH>Lace Option</th><td>Asymetrical lacings, such as triplets and skip-hole, can generally produce two possible patterns (and spoke lengths).  The two patterns depend on which direction Spoke 1 is laced in relation to Hole 0.  Just try it &amp; see.</td>

			<tr><th class=WH></th><th>
				<p>Advanced Build Info
				<p>The "Advanced Build Info" section is largely academic, and can be ignored for most practical spoke length calculations.
			</th>
			<tr><th class=WH>Flange Width</th><td>The flange width at spoke holes affects bracing angles and tension ratio. It is often about 3mm.</td>
			<tr><th class=WH>Spoke Diameter at the Bend</th><td>Spoke diameter just before the "J" bend, where it goes into the hub. This is usually 2mm, but can be other values. The value affects bracing angles &amp; tension ratio.</td>
			<tr><th class=WH>Elbows Laced</th><td>Specify if the spokes are laced elbows In, Out, or Center (alternating).  This affects the bracing angle, and subsequently, the tension ratio.  Geometrically, "Center" is the mid-point of the flange thickness, and is the position used for general spoke length calculations.  </td>
			<tr><th class=WH>Length Adjust.</th><td>How much the spoke length is affected by lacing choice (elbows in/out). In general, not enough to worry about.</td>
			<tr><th class=WH>Spoke Ratio</th><td>The (Side 1):(Side 2) spoke ratio. Usually 1:1, but is 1:2 for triplets, and can be other ratios in custom mode.</td>
			<tr><th class=WH>Bracing Angles</th><td>The lateral angle the spoke makes going from the rim to the hub.  This is affected by the flange-to-center width, OC rims, PCD, ERD, and spoke cross. Geometricallly, this value is also affected by the spoke hole diameter, but only by a tiny amount. Even less.</td>
			<tr><th class=WH>Tension Ratio</th><td>The theoretical spoke tension ratio (Side 1):(Side 2).  Side 2 is defined as 100%. This value is based on the spoke ratio and bracing angles.  Note that a change in the bracing angle on either side will affect the ratio listed for Side 1.</td>
			<tr><th class=WH></th><td></td>
		</table>
	</div><!--//end Notes button & table  =============-->

</div><!--//end WH_CONTAINER ================================================-->







<script>(function(){
/******************************************************************************/
var D = document;
function E(id) { return document.getElementById(id); }

var NS_ = "WH_"; //"Namespace" prefix used for <element> id's & class names.

var LS_WHEEL_SETTINGS  = NS_ + 'wheel_settings';  //Name of wheel settings saved to localStorage.
var LS_DISPLAY_OPTIONS = NS_ + 'display_options'; //Name of display settings saved to localStorage.

var BG_STANDARD = "rgb(175,198,205)";  //Used for bg color of SETTINGS when in Standard mode.
var BG_TRIPLET  = "rgb(130,166,176)";  //	"		"		"		"		   Triplet mode.
var BG_CUSTOM   = "#FAB";			   //	"		"		"		"		   Custom mode.

var PRIOR_FOCUS = ""; //Used to return focus to input that had error. Set onfocus() of the inputs.



//Various messeges
var MSGS = {};
MSGS['notice']  = "<div id=WH_MSG_HEADER>Notice!</div>";
MSGS['invalid'] = "Invalid input: ";
MSGS['max_fl']  = "Maximum value for flange holes: ";
MSGS['nf1_2']   = "Number of flange holes:<br>Side 1 must be less than or equal to Side 2.<br>";
MSGS['nf2_1']   = "Number of flange holes:<br>Side 2 must be greater than or equal to Side 1.<br>";




//id & class prefixes, etc.
var SPOKE_ID_PREFIX 	= NS_ + "spoke_";
var HUB_HOLE_ID_PREFIX	= NS_ + "f";	//Hub/flange hole id ex: WH_f1_sh1
var HUB_HOLE_MESOFIX	= "_sh";	//HUB_HOLE_ID_PREFIX + 1 + HUB_HOLE_MESOFIX + 1
var RIM_HOLE_ID_PREFIX	= NS_ + "rsh"; //WH_rsh1, WH_rsh2, etc...
var RIM_HOLE_CLASS		= NS_ + "rsh";
var SPOKE_GROUP_PREFIX	= NS_ + "group"; //WH_group1, ..., WH_group4
var SPOKE_BASE_CLASS	= NS_ + "spoke";
var HUB_HOLE_CLASS		= NS_ + "hsh";
var AXIS_CLASS			= NS_ + "axis";
var SPOKE_HOLES			= NS_ + "spoke_holes";




//Assign all necessary element references here.
var $RESPONSIBILITY = E(NS_ + 'responsibility');

var $CONTAINER		= E(NS_ + 'CONTAINER');
var $SETTINGS		= E(NS_ + 'settings');
var $LOAD_SAMPLES	= E(NS_ + 'load_samples');
var $CLEAR_SETTINGS	= E(NS_ + 'clear_settings');
var $WHEEL_TYPE		= E(NS_ + 'WHEEL_TYPE');


var $ERD  = E(NS_ + 'ERD');	// Effective Rim Diameter
var $NR   = E(NS_ + 'NR');	// Number of holes in the Rim
var $NF	 = [];
	$NF[1]= E(NS_ + 'NF1');	// Number of holes in Flange 1
	$NF[2]= E(NS_ + 'NF2');	//    "		   "		"	 2


	//not elements, but requires a few elements defined above...
var MAX = {};			 //At these values, it starts to take to long to run.
	MAX[$NR.id]    = 72; //MAX NR need to be divisible by 3 AND by 4,  for Build_NR() to work for both standard & triplet modes.
	MAX[$NF[1].id] = 72;
	MAX[$NF[2].id] = 72;


var $PCD    = [];
	$PCD[1] = E(NS_ + 'PCD1');	// Pitch Circle Diameter 1
	$PCD[2] = E(NS_ + 'PCD2');	// 	 "	   "		"	 2
var $FTC    = [];
	$FTC[1] = E(NS_ + 'FTC1');	// Flange-to-Center 1 distance
	$FTC[2] = E(NS_ + 'FTC2');	// 	  "			"	2	 "
var $OSB    = [];
	$OSB[1] = E(NS_ + 'OSB1');	// Offset Spoke Bed 1 (off center rim)
	$OSB[2] = E(NS_ + 'OSB2');	// 	  "			"	2	 "		"
var $SX     = [];
	$SX[1]  = E(NS_ + 'SX1');	// Spoke Crossing side 1
	$SX[2]  = E(NS_ + 'SX2');	// Spoke Crossing side 2
var $SHD    = E(NS_ + 'SHD');	// Spoke Hole Diameter. Affects spoke length calcs only.

var $LACE_OPT = E(NS_ + 'LACE_OPT');// Wheel Type/Lacing Option
	$LACE_OPT.options[0].value = -1; //Type 2. The option values (1 or -1) are used in the 
	$LACE_OPT.options[1].value =  1; //Type 1. spoke length calculations. DO NOT CHANGE 

var $SL   = [];					//Spoke Lengths
	$SL[1]= E(NS_ + 'LENGTH1');	//Flange 1 Group 1 (ie: leading/trailing...)
	$SL[3]= E(NS_ + 'LENGTH3');	//		 2		 3

	$SL[2]= E(NS_ + 'LENGTH2');	//	  	 1		 2
	$SL[4]= E(NS_ + 'LENGTH4');	//		 2		 4

var $SL_2_4 = E(NS_ + "SL_2_4"); //<tr> with lengths for "even" numbered spokes. Usually the same and not displayed.

var $SHOW_HIDE_ADVANCED = E(NS_ + 'show_hide_advanced'); //<button> to show/hide advanced build info
var $ADVANCED_INFO = E(NS_ + 'advanced_info'); //<div> around advanced info.

var $FW	 = E(NS_ + 'FW');  //Flange Width, at spoke holes.
var $SDB = E(NS_ + 'SDB'); //Spoke Diameter, at bend.

var $ELBOWS	= [];
	$ELBOWS[1] = E(NS_ + 'ELBOWS1');
	$ELBOWS[2] = E(NS_ + 'ELBOWS2');

var $SL_ADJ    = []; //Spoke Lengths adjusted for elbows in or out.
	$SL_ADJ[1] = E(NS_ + 'SL_ADJ1');
	$SL_ADJ[2] = E(NS_ + 'SL_ADJ2');

var $SPOKE_RATIO    = [];
	$SPOKE_RATIO[1] = E(NS_ + 'spoke_ratio1');
	$SPOKE_RATIO[2] = E(NS_ + 'spoke_ratio2');

var $BRACE_ANGLE    = [];
	$BRACE_ANGLE[1] = E(NS_ + 'brace_angle1');
	$BRACE_ANGLE[2] = E(NS_ + 'brace_angle2');

var $TENSION_RATIO    = [];
	$TENSION_RATIO[1] = E(NS_ + 'tension_ratio1');
	$TENSION_RATIO[2] = E(NS_ + 'tension_ratio2');

var $DISPLAY_OPTIONS = E(NS_ + 'display_options'); //<div> around display options to enable show/hide

var $OTHER_CALCS = E(NS_ + 'other_calcs'); //<div> around A Few Other Calcs links

var $SHOW_HIDE_OTHER = E(NS_ + 'show_hide_other'); //<button> to show/hide other calcs links.
var $SHOW_HIDE_NOTES = E(NS_ + 'show_hide_notes'); //<button> to show/hide Notes.
var $SHOW_HIDE_DO    = E(NS_ + 'show_hide_DO');    //<button> to show/hide display options.

var $RESET_OPTIONS_SPOKES  = E(NS_ + 'reset_options_spokes');   //<button> to reset display options.
var $RESET_OPTIONS_RIM_ETC = E(NS_ + 'reset_options_rim_etc');  //<button> to reset display options.

var $SPOKE_COLOR    = [];
	$SPOKE_COLOR[1] = E(NS_ + 'SPOKE_COLOR1');//Spoke group 1 color
	$SPOKE_COLOR[2] = E(NS_ + 'SPOKE_COLOR2');//Spoke group 2 color
	$SPOKE_COLOR[3] = E(NS_ + 'SPOKE_COLOR3');//Spoke group 3 color
	$SPOKE_COLOR[4] = E(NS_ + 'SPOKE_COLOR4');//Spoke group 4 color

var $SPOKE_LINE_SIZE    = []; 
	$SPOKE_LINE_SIZE[1] = E(NS_ + 'SPOKE_LINE_SIZE1');//Spoke group 1 line width
	$SPOKE_LINE_SIZE[2] = E(NS_ + 'SPOKE_LINE_SIZE2');//			  2
	$SPOKE_LINE_SIZE[3] = E(NS_ + 'SPOKE_LINE_SIZE3');//			  3
	$SPOKE_LINE_SIZE[4] = E(NS_ + 'SPOKE_LINE_SIZE4');//			  4

var $SPOKE_SHOW    = [];
	$SPOKE_SHOW[1] = E(NS_ + 'SPOKE_SHOW1');// Show spoke group 1  These are mostly for trouble shooting.
	$SPOKE_SHOW[2] = E(NS_ + 'SPOKE_SHOW2');// Show spoke group 2			  "				"
	$SPOKE_SHOW[3] = E(NS_ + 'SPOKE_SHOW3');// Show spoke group 3			  "				"
	$SPOKE_SHOW[4] = E(NS_ + 'SPOKE_SHOW4');// Show spoke group 4			  "				"

var $RIM	 = E(NS_ + 'rim'); //<circle>
var $FLANGE1 = E(NS_ + 'flange1'); //<circle>
var $FLANGE2 = E(NS_ + 'flange2'); //<circle>

var $RIM_COLOR = E(NS_ + 'RIM_COLOR'); //
var $F1_COLOR  = E(NS_ + 'F1_COLOR');//
var $F2_COLOR  = E(NS_ + 'F2_COLOR');//

var $RIM_LINE_SIZE = E(NS_ + 'RIM_LINE_SIZE');//Line widths of the rim & flange circles.
var $F1_LINE_SIZE  = E(NS_ + 'F1_LINE_SIZE');
var $F2_LINE_SIZE  = E(NS_ + 'F2_LINE_SIZE');

var $RIM_SHOW = E(NS_ + 'RIM_SHOW');	// Show Rim circle.
var $F1_SHOW  = E(NS_ + 'F1_SHOW');	// Show Flange 1 circle.
var $F2_SHOW  = E(NS_ + 'F2_SHOW');	// Show Flange 2 circle.

var $HOLESIZE	    = E(NS_ + 'HOLESIZE');  //Displayed spoke hole size (all holes)
var $HOLE_COLOR     = E(NS_ + 'HOLE_COLOR');     //Spoke hole color
var $HOLE_LINE_SIZE = E(NS_ + 'HOLE_LINE_SIZE'); //Spoke hole line thickness
var $HOLES_SHOW	    = E(NS_ + 'HOLES_SHOW');     //Take a guess...

var $AXES_COLOR     = E(NS_ + 'AXES_COLOR');//
var $AXES_LINE_SIZE = E(NS_ + 'AXES_LINE_SIZE');
var $AXES_SHOW  	= E(NS_ + 'AXES_SHOW'); //

var $SPOKES		   = E(NS_ + 'spokes');   //<g> containing all spokes.
var $RIM_HOLES	   = E(NS_ + 'rim_holes');//<g> containing rim holes.
var $FLANGE1_HOLES = E(NS_ + 'holes_f1'); //<g> containing flange 1 holes.
var $FLANGE2_HOLES = E(NS_ + 'holes_f2'); //<g> containing flange 2 holes.

var $MSG_BOX 	 = E(NS_ + 'msg_box');	 //Container div for msg div & [Close] btn.
var $CLOSE_MSG	 = E(NS_ + 'close_msg'); //[Close] button for error message box.
var $MESSAGE_DIV = E(NS_ + 'message');	 //div for actual error message.
var $ACCEPT_MSG  = E(NS_ + 'ACCEPT_MSG'); //[I Accept] disclaimer button. id is also cookie name.


var $SVG_WHEEL = E(NS_ + 'svg_wheel'); //Main <svg> element containing wheel & axes..
var $G_WHEEL   = E(NS_ + 'wheel'); //<g> containing just the wheel elements: spokes, holes, rim, & flanges.

var $SVG_CONTAINER_DIV = E(NS_ + 'The_SVG');

var $NOTES = E(NS_ + 'notes'); //Notes <div>.

var $X_axis = E(NS_ + 'x-axis');
var $Y_axis = E(NS_ + 'y-axis');

//end assignment of element references.



/*************************************************./
//Consider all raw size & x/y values to be mm,
//to coorespond directly to rim, hub, & spoke measurements.


/*************************************************/
var DEFAULT_VALUES = {
	'WHEEL_TYPE': "standard", //0=Standard, 1=Triplet, 2=Custom
	'ERD' : 577,
	'NR'  : 24,
	'NF1' : 12, 
	'NF2' : 12,
	'PCD1': 38.5,
	'PCD2': 50.6,
	'FTC1': 37.7, //FtC & OSB affect spoke length calcs only (not display).
	'FTC2': 17.1, //
	'OSB1': "",   //
	'OSB2': "",   //
	'SX1' : 2,    
	'SX2' : 2,
	'SHD' : 2.6,	//Affects spoke length calcs only (not displayed size).
	'LACE_OPT': 1,	//1 or -1
	'FW'  : 3,		//Flange Width, at spoke holes.
	'SDB' : 2,		//Spoke Diameter, at bend.
	'ELBOWS1': 0,	//0 = flange center, 1 = elbows out, -1 = elbows in
	'ELBOWS2': 0	//
}


var DEFAULT_OPTIONS = {
	'show_hide_advanced':"none", //none or inline-block
	'show_hide_other': "none", 	 //  "			"
	'show_hide_notes': "none", 	 //  "			"
	'show_hide_DO'   : "none", 	 //  "			"
	'SPOKE_COLOR1': "#477", //Spoke group colors
	'SPOKE_COLOR2': "#477", //
	'SPOKE_COLOR3': "#355", //
	'SPOKE_COLOR4': "#355", //
	'SPOKE_LINE_SIZE1': 2,
	'SPOKE_LINE_SIZE2': 2,
	'SPOKE_LINE_SIZE3': 2,
	'SPOKE_LINE_SIZE4': 2,
	'SPOKE_SHOW1':1,	// true/false or 1/0
	'SPOKE_SHOW2':1,	//		"		"
	'SPOKE_SHOW3':1,	//		"		"
	'SPOKE_SHOW4':1,	//		"		"
	'RIM_SHOW'   :1,	//		"		"
	'F1_SHOW'    :1,	//		"		"
	'F2_SHOW'    :1,	//		"		"
	'RIM_LINE_SIZE' :30,
	'F1_LINE_SIZE'  :1,
	'F2_LINE_SIZE'  :1,
	'AXES_LINE_SIZE':1,
	'RIM_COLOR' : "#BBB",
	'F1_COLOR'  : "#AAA",
	'F2_COLOR'  : "#777",
	'HOLE_COLOR': "#000",
	'HOLE_LINE_SIZE': 2, //This plus HOLESIZE = displayed diameter.
	'HOLES_SHOW': 1,
	'HOLESIZE'  : 2, //Displayed size/diameter of spoke holes (less line size).

	'AXES_COLOR': "#999",
	'AXES_SHOW' : 1, // true/false or 1/0

	'VIEWBOX_SIZE': 640 }; //Most wheels are < 600 ERD.
/*************************************************/




function Save_Settings(ls_name, defaults) { //*********************************/
	//Save as "id1:value1&id2:value..."

	var setting = "", all_settings = "";
	var x = 0;

	for (var id in defaults) {
		setting = E(NS_ + id);
		if (!setting) { continue }
		
		if (x++ > 0) { all_settings += "&"; }
		if (setting.type == "checkbox") { all_settings += setting.id + ":" + setting.checked; }
		else 							{ all_settings += setting.id + ":" + setting.value;   }
	}

	localStorage.setItem(ls_name, all_settings);

}//end Save_Settings() { //****************************************************/




function Load_Saved_Settings(ls_name) { //*************************************/
	var all_settigns = localStorage.getItem(ls_name);

	if (all_settigns == null) { return false; }

	var settings = all_settigns.split("&"); //get id:value pairs

	for (var x = 0; x < settings.length; x++){
		
		var id    = settings[x].split(":")[0];
		var value = settings[x].split(":")[1];
		
		if (!E(id)) { continue }; //skip inValid element id's.
		
		//.checked is boolean, and strings, even "true", become false if assigned as a string.
		if (E(id).type == "checkbox") { E(id).checked = (value == "true"); } 
		else						  { E(id).value   = value }
	}

	return true;
}//end Load_Saved_Settings() { //**********************************************/




function Validate_Wheel_Settings() { //****************************************/
	//For now, just a very basic sanitation of loaded values.

	if (($WHEEL_TYPE.value != "custom") && ($WHEEL_TYPE.value != "triplet")) { $WHEEL_TYPE.value = "standard"; }
	if ($LACE_OPT.value != "-1") { $LACE_OPT.value = 1; }

	//For now, just make sure they're numbers.
	for (var name in DEFAULT_VALUES) {
		var setting = E(NS_ + name);
		if ( !setting ) { continue }
		if ((setting == $WHEEL_TYPE) || (setting == $LACE_OPT)) { continue }
		
		if (isNaN(setting.value)) { setting.value = "" }
	}
	
	Save_Settings(LS_WHEEL_SETTINGS, DEFAULT_VALUES); //in case any were invalid.
}//end Validate_Wheel_Settings() { //******************************************/




function Load_Samples() { //***************************************************/

	if ($ACCEPT_MSG.value != "true") { return; }

	$ERD   .value = DEFAULT_VALUES['ERD'];
	$NR	   .value = DEFAULT_VALUES['NR'];
	$NF[1] .value = DEFAULT_VALUES['NF1'];
	$NF[2] .value = DEFAULT_VALUES['NF2'];
	$PCD[1].value = DEFAULT_VALUES['PCD1'];
	$PCD[2].value = DEFAULT_VALUES['PCD2'];
	$FTC[1].value = DEFAULT_VALUES['FTC1'];
	$FTC[2].value = DEFAULT_VALUES['FTC2'];
	$OSB[1].value = DEFAULT_VALUES['OSB1'];
	$OSB[2].value = DEFAULT_VALUES['OSB2'];
	$SHD   .value = DEFAULT_VALUES['SHD'];

	$LACE_OPT.value = DEFAULT_VALUES['LACE_OPT'];
	$FW .value = DEFAULT_VALUES['FW'];
	$SDB.value = DEFAULT_VALUES['SDB'];
	$ELBOWS[1].value = DEFAULT_VALUES['ELBOWS1']
	$ELBOWS[2].value = DEFAULT_VALUES['ELBOWS2']

	Build_SX_Options($WHEEL_TYPE.value, 1, $NF[1].value, $SX[1].value);
	Build_SX_Options($WHEEL_TYPE.value, 2, $NF[2].value, $SX[2].value);

	$SX[1].value = DEFAULT_VALUES['SX1'];
	$SX[2].value = DEFAULT_VALUES['SX2'];

	SX_Enable_Disable(1);
	SX_Enable_Disable(2);

	Setup_Viewbox();

	Setup_Wheel_Type();

	Build_Wheel();

	Save_Settings(LS_WHEEL_SETTINGS, DEFAULT_VALUES);

}//end Load_Samples() { //*****************************************************/




function Clear_Settings() { //*************************************************/

	$ERD   .value = '';
	$NR	   .value = '';
	$NF[1] .value = '';
	$NF[2] .value = '';
	$PCD[1].value = '';
	$PCD[2].value = '';
	$FTC[1].value = '';
	$FTC[2].value = '';
	$OSB[1].value = '';
	$OSB[2].value = '';
	$SX[1] .value = '';
	$SX[2] .value = '';
	$SHD   .value = '';
	$ELBOWS[1].value = 0;
	$ELBOWS[2].value = 0;
	$FW.value  = DEFAULT_VALUES['FW'];
	$SDB.value = DEFAULT_VALUES['SDB'];

	$LACE_OPT.value = 1;

	Setup_Viewbox();

	Clear_Wheel();

	localStorage.removeItem(LS_WHEEL_SETTINGS);

}//end Clear_Settings() { //***************************************************/




function Load_DEFAULT_OPTIONS_Spokes() { //************************************/
	for (var group = 1; group <=4; group++) {
		$SPOKE_COLOR[group]    .value   = DEFAULT_OPTIONS['SPOKE_COLOR'     + group];
		$SPOKE_LINE_SIZE[group].value   = DEFAULT_OPTIONS['SPOKE_LINE_SIZE' + group];
		$SPOKE_SHOW[group]     .checked = DEFAULT_OPTIONS['SPOKE_SHOW'      + group];
	}
}//end Load_DEFAULT_OPTIONS_Spokes() { //**************************************/




function Load_DEFAULT_OPTIONS_Rim_etc() { //***********************************/
	$RIM_COLOR .value   = DEFAULT_OPTIONS['RIM_COLOR'];
	$F1_COLOR.value     = DEFAULT_OPTIONS['F1_COLOR'];
	$F2_COLOR.value     = DEFAULT_OPTIONS['F2_COLOR'];
	$RIM_LINE_SIZE .value = DEFAULT_OPTIONS['RIM_LINE_SIZE'];
	$F1_LINE_SIZE.value = DEFAULT_OPTIONS['F1_LINE_SIZE'];
	$F2_LINE_SIZE.value = DEFAULT_OPTIONS['F2_LINE_SIZE'];
	$RIM_SHOW .checked  = DEFAULT_OPTIONS['RIM_SHOW'];
	$F1_SHOW.checked    = DEFAULT_OPTIONS['F1_SHOW'];
	$F2_SHOW.checked    = DEFAULT_OPTIONS['F2_SHOW'];

	$AXES_COLOR.value     = DEFAULT_OPTIONS['AXES_COLOR'];
	$AXES_LINE_SIZE.value = DEFAULT_OPTIONS['AXES_LINE_SIZE'];
	$AXES_SHOW .checked   = DEFAULT_OPTIONS['AXES_SHOW'];

	$HOLE_COLOR.value     = DEFAULT_OPTIONS['HOLE_COLOR'];
	$HOLE_LINE_SIZE.value = DEFAULT_OPTIONS['HOLE_LINE_SIZE'];
	$HOLES_SHOW.checked   = DEFAULT_OPTIONS['HOLES_SHOW'];

	$HOLESIZE.value       = DEFAULT_OPTIONS['HOLESIZE'];
}//end Load_DEFAULT_OPTIONS_Rim_etc() { //*************************************/




function Load_DEFAULT_OPTIONS() { //*******************************************/

	Load_DEFAULT_OPTIONS_Spokes();

	Load_DEFAULT_OPTIONS_Rim_etc()	

}//end Load_DEFAULT_OPTIONS() //***********************************************/




function scroll_blur(event){ //************************************************/
	//Permit "clearing" focus, and some keyboard navigation while in <input>'s.

	//Normalize the event & which/key/charcode...
	if (!event) {var event = window.event;} //for IE
	var event_code = event.which || event.keyCode || event.charCode;
	
	var ESC = 27, AU = 38, AD = 40, PU = 33, PD = 34;

	//remove focus from input/select to allow keyboard arrows/pageup/pagedown/etc page scrolling.
	if (event_code == ESC) { D.activeElement.blur(); return; }

	if (event.target.tagName == "INPUT") {
		//Arrow down scrolls the page up, towards the bottom of the page, and vice-versa.
		if      (event_code == AU) { window.scrollBy(0, -38); }
		else if (event_code == AD) { window.scrollBy(0,  38); }
		else if (event_code == PU) { window.scrollBy(0,-400); }
		else if (event_code == PD) { window.scrollBy(0, 400); }
	}
}//end scroll_blur() //********************************************************/




function Show_Hide_Options(button, target, mode) { //**************************/
	//Toggle button.value, and Show or Hide target,

	if (button.value == "none") { button.value     = mode;   } //inline-block, etc...
	else 						{ button.value     = "none"; }

	target.style["display"] = button.value;

	Scroll_Into_View(target, button.offsetHeight + 10);

	Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS);
}//end Show_Hide_Options() //**************************************************/




function Bracing_Angle(f, adj) { //********************************************/
	//tan(bracing angle) = (FtC +/- OSB) / (rR - y1 - rSH)
	
	if (!adj) { adj = 0 } //Consider whether spokes laced elbows out or in. (+/- ~2.5mm)

	var rR = $ERD.value/2;			//radius of Rim
	var rF = $PCD[f].value/2;		//radius of Flange
	var ftc= $FTC[f].value*1 + adj;	//flange to center + elbows laced in or out...
	var osb= $OSB[f].value*1;		//offset spoke bed (off-center)
	var rSH= $SHD.value/2;			//radius of Spoke Hole (spoke hole diameter/2)
	var aR = 360/$NR.value*1;		//angle between holes in Rim
	var aF = 360/$NF[f].value*1;	//angle between holes in flange
	var lo = $LACE_OPT.value*1; 	//lacing option, 1 or -1. For standard lacings, doesn't matter.
	

	//"angle" to hole zero. For standard wheels = 0, but not for triplets.
	if (($NR.value % $NF[f].value) == 0) { var a0 = 0; } else { var a0  = aR - aF/2; }

	var af     = ($SX[f].value * aF) + a0 * lo; //angle to hole in flange  spoke.
	var af_rad = af/180 * Math.PI; 		 //af in radians
	var y1     = rF * Math.cos(af_rad);  // x1^2 + y1^2 = rF^2
	var tan_aB = (ftc + osb) / (rR - y1 - rSH);//tangent of Bracing angle
	var aB_rad = Math.atan(tan_aB);		 //Bracing angle (in radians)
	var aB    = aB_rad * 180 / Math.PI;	 //Bracing angle (in degrees)

	return aB;
}//end Bracing_Angle() { //****************************************************/




function Update_Advanced_Info(save) { //***************************************/

	$SPOKE_RATIO[1].value = '';
	$SPOKE_RATIO[2].value = '';

	if ($NF[1].value == 0) { var spoke_ratio = ""; }
	else 				   { var spoke_ratio = parseFloat($NF[2].value / $NF[1].value).toFixed(2); }

	if ($NR.value != 0 && $NF[1].value != 0) { $SPOKE_RATIO[1].value = 1; }
	$SPOKE_RATIO[2].value = spoke_ratio;

	//For determining brace angles when spokes laced Elbows In/Elbows out, vs flange Center (altertnating).
	//(Flange Width + Spoke Diameter at Bend)/2
	var brace_adj = $FW.value/2 + $SDB.value/2;

	var aB1 = Bracing_Angle(1, brace_adj * $ELBOWS[1].value);
	var aB2 = Bracing_Angle(2, brace_adj * $ELBOWS[2].value);

	if ((aB1 <= 0) || isNaN(aB1)) {
		var bracing_ratio = 0;
		$BRACE_ANGLE[1].value = "";
		$TENSION_RATIO[1].value = "";
	}
	else {
		var bracing_ratio = aB2/aB1;
		$BRACE_ANGLE[1].value = aB1.toFixed(2);
		$TENSION_RATIO[1].value = (bracing_ratio * spoke_ratio * 100).toFixed(1);
	}

	if ((aB2 <= 0) || isNaN(aB2)) {
		$BRACE_ANGLE[2].value = "";
		$TENSION_RATIO[2].value = "";
	}
	else {
		$BRACE_ANGLE[2].value = aB2.toFixed(2);
		$TENSION_RATIO[2].value = 100; //By definition
	}

	var sl_1   = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1', 10000)
	var sl_1io = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1', 10000, brace_adj * $ELBOWS[1].value)

	var sl_2   = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1', 10000)
	var sl_2io = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1', 10000, brace_adj * $ELBOWS[2].value)

	$SL_ADJ[1].value = Math.round((sl_1io - sl_1)*100)/100;
	$SL_ADJ[2].value = Math.round((sl_2io - sl_2)*100)/100;


	if (save) { Save_Settings(LS_WHEEL_SETTINGS, DEFAULT_VALUES) }

}//end Update_Advanced_Info() { //*********************************************/




function Build_NR_Options(wheel_type, max, new_value) { //*********************/

	var skip = 4; //"standard"
	if (wheel_type == "triplet") { skip = 3 } else 
	if (wheel_type == "custom" ) { skip = 1 }
	
	
	var options = "";
	for (var x = max; x >= 0; x -= skip) {
		options += "<option value="+x+">"+x+"</option>\n"
	}

	$NR.innerHTML = options;
	$NR.value = new_value;
}//end Build_NR_Options(wheel_type) { //***************************************/




function Build_SX_Options(wheel_type, f, max, value) { //**********************/

	value = value*1;

	var options = ""
	

	if (wheel_type != "custom") { max = Math.floor(max/4); }

	for (var x = max; x >= 0; x--) { 
		options += "<option value="+x+">"+x+"</option>\n"
	}


	if (max == 0)    { value = 0       } else
	if (value > max) { value = max - 1 }

	$SX[f].innerHTML = options;
	$SX[f].value = value;
}//end Build_SX_Options() { //*************************************************/




function Create_Spoke_Holes(hole_group, base_id, class1, class2, N, scale, shd, offset) { //***/
	//Create & position N spoke holes in <g id=group>, with radius of shd/2 (shd="spoke hole diameter")
	if (typeof offset == "undefined") { offset = 0 }

	var A = 360/N; //angle between holes

	var a = offset;	//angle to current hole from 0
	var cx, cy;		//coordinates for hole

	var odd = true;	//for alternating classes

	for (var sh = 1; sh <= N; sh++) {
		var full_id = base_id + sh;
		
		odd = !odd;
		if (odd) { var class_X = class1 } else { var class_X = class2 } //##### Not yet used...
		
		var classes = SPOKE_HOLES + " " + class_X;
		
		hole_group.innerHTML += '<circle id=' + full_id + ' class="' + classes + '" r="' + (shd/2) + '" cx="0" cy="0" />';
		
		cx = Math.sin( (a/180) * Math.PI) * scale;
		cy = Math.cos( (a/180) * Math.PI) * scale;
		
		E(full_id).setAttribute('cx', cx);
		E(full_id).setAttribute('cy', cy);
		
		a += A; //Spoke hole 1 is first hole at or after 0 degrees/(6 o'clock), ccw.
	}
}//end Create_Spoke_Holes() //*************************************************/




function Calc_Spoke_Length(flange, spoke_id, round_to, elbows) { //************/
	//Calculate actual spoke length in 3-d space, including flange-to-center measurement..
	//elbows = +/- offset from flange centerline to spoke centerline (elbows out/in)
	
	if (!E(spoke_id)) { return '' }
	
	if (!round_to) { round_to = 10 } //decimal places. 10 is 1, 100 is 2, etc...
	
	if (!elbows) { elbows = 0 }

	//Get spoke ends
	var x1 = E(spoke_id).getAttribute('x1');
	var y1 = E(spoke_id).getAttribute('y1');
	var x2 = E(spoke_id).getAttribute('x2');
	var y2 = E(spoke_id).getAttribute('y2');
	
	var dx = x2 - x1;
	var dy = y2 - y1;

	var ftc = $FTC[flange].value*1; //Final spoke length requires Flange to Center
	var osb = $OSB[flange].value*1; //and OSB...
	var w = ftc + osb + elbows;

	var S = Math.sqrt(w*w + dx*dx + dy*dy) - $SHD.value/2;

	return Math.round(S * round_to)/round_to;
}//end Calc_Spoke_Length() //**************************************************/




function Calc_Spoke_Lengths(validate, changed, integer, allow_neg) { //********/
	//Calc spoke lengths for both sides. Used by onchange of OSB & SHD.

	if (validate) {
		if (!Validate_Input(changed, integer, allow_neg)) { return false }
		changed.prior_value = changed.value; //Also set in onfocus events and in Build_Wheel().
	}

	//Odd spokes: 1, 3, 5, etc...
	$SL[1].value = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1'); //WH_spoke_(flange)_(hole)
	$SL[3].value = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1');

	//Even spokes: 2, 4, 6, etc...
	$SL[2].value = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_2');
	$SL[4].value = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_2');

	Update_Advanced_Info(true); //update & save settings

}//end Calc_Spoke_Lengths() //*************************************************/





function Spoke_Length_Calculator(f) { //***************************************/
	//Tradtional method. For the most part. Not currently used except for dev.
	//Not valid for some skip hole configurations (and maybe others). Don't know why.

	var ftc = $FTC[f].value*1; //Final spoke length requires Flange to Center
	var osb = $OSB[f].value*1; //and OSB...
	var w = ftc + osb;

	var aR  = 360/$NR.value;    //angle between holes in Rim.
	var aF  = 360/$NF[f].value; //angle between holes in Flange.

	//"zero cross" adjustment angle for triplets. Fails for some skip-hole configs. Don't know why.
	//Valid if flange1 spokes + flange2 spokes == rim holes.
	if (($NR.value % $NF[f].value) == 0) { var a0 = 0 } else { var a0  = aR - aF/2; }

	var rR  = $ERD   .value/2;  //radius of Rim
	var rF  = $PCD[f].value/2;  //radius of Flange
	var aF1 = $SX[f].value*aF + $LACE_OPT.value*a0; //angle to spoke hole in flange from "vertical".
	var aF1_rad = aF1/180 * Math.PI; //aF1 in radians
	var cos_aF1 = Math.round(Math.cos( aF1_rad )*10000)/10000;

	var S = Math.sqrt(w*w + rR*rR + rF*rF - 2*rR*rF*cos_aF1) - $SHD.value/2;
		S = Math.round(S * 10)/10;

	return S;
}//end Spoke_Length_Calculator() { //******************************************/




function Add_Spoke(group, flange, flange_hole, rim_hole, color) { //***********/

	if (typeof color == "undefined") { color = "black" }

	var flange_hole_id = HUB_HOLE_ID_PREFIX + flange + HUB_HOLE_MESOFIX + flange_hole;
	var rim_hole_id	= RIM_HOLE_ID_PREFIX + rim_hole;

	var x1 = E(flange_hole_id).getAttribute('cx');
	var y1 = E(flange_hole_id).getAttribute('cy');
	var x2 = E(rim_hole_id).getAttribute('cx');
	var y2 = E(rim_hole_id).getAttribute('cy');

	var spoke_id = SPOKE_ID_PREFIX + flange + "_" + flange_hole;
	var classes = SPOKE_BASE_CLASS + ' ' + SPOKE_GROUP_PREFIX + group; //ex: 'WH_spoke WH_group1'
	var coords = ' x1="' + x1 +  '" y1="' + y1 +  '" x2="' + x2 +  '" y2="' + y2 +  '" ';
	var style = ' style="stroke:' + color + '"';

	var spoke = '<line id="' + spoke_id + '" class="' + classes+ '" ' + coords + style + '/>' + "\n";
	$SPOKES.innerHTML += spoke;
	
}//end Add_Spoke() //**********************************************************/




function Lacing_Option(f) { //*************************************************/
    /****************************************************../
    tl;dr: It's complicated...  :) 

	"Full" Explanation:
    In a triplet wheel, with a given spoke count & cross (just whether they're even/odd),
    there are two lace patterns possible: "Type 1" and "Type 2".  In wheels with standard 
	lace patterns (2x, 3x, etc), the two pattern types end up just being mirror images of 
	one another. 
    
    In this program, it is presented as "Lacing Option".  Also, it really only matters on the side
    with more spokes (ex: the 16 spoke side of an 8:16 triplet). 

    Well, those three options: even/odd spoke count, even/odd spoke cross, and lace type,
    presents us with a three body quatum paradoxical muonicly  gravitational relativistic 
    generational equatorial anti-matter teseract.  And the effort to solve it cost me many hours 
    of time & much pounding of my head against a cinder block wall.
    Yes, many brain cells died to bring us this informtaiton...

    Anyway, for a consistent display of the wheel (spokes don't keep changing direcion), to determine
	the matching rim hole for a given flange hole, a modifier is needed,  either 1 or -1, depending on 
	the desired triplet type & other two conditions. But, it's not always the same. And sometimes it's 
	different, except when it's not...

    All 8 possible combinations (3 "bits": count, cross, type) and their resultant modifers are summerized 
    in the table below. 

     NR SX T|          NR: Even or Odd Number of holes in the Rim
     -------+--        SX: Even or Odd Spoke Cross
     E  E  1|          T : Triplet Type (1 or 2)
     O  E  1| M        M : Resultant Modifier (1 or -1)
     E  O  2| 1
     O  O  2|
     -------+--     \ | /    | | |
     E  O  1|        \|/     | | |   (The "middle spoke" is on the opposite flange.)
     O  O  1| M       X      | | |  
     E  E  2|-1      /|\     | | |  
     O  E  2|       Type 1   Type 2 

    Now, in basic spoke calc math, it's much simpler, because all that matters is spoke cross - we
    don't care about the voodoo involved in determining matching spoke holes in space.  But here,
    holes matter. And space.  And time.  I think. I guess.  Maybe. I don't know.  But it works now!  :)
    /******************************************************/


	var NRE = ($NR.value    % 2  == 0); // Even number of rim holes?
	var SXE = ($SX[f].value % 2  == 0); // Even Spoke cross?
	var T1  = ($LACE_OPT.value   == 1); // Triplet/Lacing Type 1?

	if ( (NRE && SXE && T1) || (!NRE && SXE && T1) || (NRE && !SXE && !T1) || (!NRE && !SXE && !T1) )
		 { return  1 } 
	else { return -1 }
}//end Lacing_Option() //******************************************************/




function Custom_Odd_NF(nf) { //************************************************/
	//Check if odd flange hole count while in "custom" mode.
	
	if ( (($WHEEL_TYPE.value == "custom") && (nf%2 != 0)) ) { return true; }
	return false;
}//end Custom_Odd_NF() { //****************************************************/




function Create_Spoke_Groups(g1, g2, nr, nf, sx, f, color ) { //***************/
	sx = Math.floor(sx);

	if (nf < 1) { return } //can't lace a spoke with no flange holes...

	var gn = g1; //Used to toggle between g1 & g2
	var d  = 1;   //Direction. ie: leading or trailing spokes.

	if (Custom_Odd_NF(nf) && f == 2 ) { d = -1 }


	var r_skip = nr/nf; //Normally 2, but can be 3 (flange 1), then 3/2 (flange 2) for triplets.

	//Flange 1 hole 1 aligns to rim hole 1.  Flange 2 hole 1 aligns to rim hole 2 (generally, if NF1 <= NF2)...
	if (f == 2) { var f_skip = r_skip/2 } else { var f_skip = 0 }

	for (var h_hole = 1; h_hole <= nf; h_hole += 1) {
		
		var r_hole = (h_hole-1 + sx*d*Lacing_Option(f)) * r_skip + 1 + f_skip
		
		r_hole = Math.round(r_hole) //Needed for triplets. I don't like it, but can't figure out another way...
		
		if (r_hole > nr) {r_hole -= nr;}
		if (r_hole <  1) {r_hole += nr;}
		
		//Make sure there's a hole in both rim & hub for the spoke
		if ((nr != 0) && (nf != 0)) { Add_Spoke(gn,  f,  h_hole,  r_hole ,  color[gn]); }
		
		if (gn == g2) { var gn = g1 } else { var gn = g2 }
		
		
		if (!Custom_Odd_NF(nf)) {
			d = -d; //toggle direction, aka leading/trailing spokes.
		}
		//Else, all spokes on side with odd spoke count laced same direction.
	}
}//end Create_Spoke_Groups() //************************************************/




function Make_Rim(save) { //***************************************************/
	//Adjust displayed rim radius so spoke ends only touch inner radius, not middle/actual radius.
	
	if ($ERD.value == 0) { return false; }
	var rim_radius = $ERD.value/2 + $RIM_LINE_SIZE.value/2 - .5;
	$RIM.setAttribute('r', rim_radius);
	$RIM.style['stroke']	= $RIM_COLOR.value;
	$RIM.style['stroke-width'] = $RIM_LINE_SIZE.value;
	Setup_Viewbox();
	if (save) { Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS) }
}//end Make_Rim() { //*********************************************************/



function Setup_Wheel(erd, nr, nf1, nf2, pcd1, pcd2, sx1, sx2, shd, spoke_colors) { /****/
	//shd as used here, and in Create_Spoke_Holes(), only affects 
	//displayed spoke hole size, and not spoke length calcs.

	var AF = 360/nf2; //Angle between holes in Flange.
	var offset_f1_f2 = AF/2; //Offset angle between left & right hub flange holes. The radial side is "0".
							 
	var rotate = 0; //180 rotates wheel so that "spoke 1" is at 12 o'clock. Helped during dev. Now, not so much.

	//Draw basic rim & flange circles..
	var rim_radius = erd/2 + $RIM_LINE_SIZE.value/2 - .5;
	$RIM.setAttribute('r', rim_radius); //
	$FLANGE1.setAttribute('r', pcd1/2); //erd & pcd's are "D"iameters, but SVG <circle>'s require radii...
	$FLANGE2.setAttribute('r', pcd2/2); //

	var f1_prefix = HUB_HOLE_ID_PREFIX + "1" + HUB_HOLE_MESOFIX;
	var f2_prefix = HUB_HOLE_ID_PREFIX + "2" + HUB_HOLE_MESOFIX;
	Create_Spoke_Holes( $RIM_HOLES     , RIM_HOLE_ID_PREFIX , RIM_HOLE_CLASS, RIM_HOLE_CLASS, nr , erd/2 , shd, 0);
	Create_Spoke_Holes( $FLANGE1_HOLES , f1_prefix, HUB_HOLE_CLASS, HUB_HOLE_CLASS, nf1, pcd1/2, shd, 0);
	Create_Spoke_Holes( $FLANGE2_HOLES , f2_prefix, HUB_HOLE_CLASS, HUB_HOLE_CLASS, nf2, pcd2/2, shd, offset_f1_f2);

	//Drawing side 2 first puts side one spokes visually "on top".
	Create_Spoke_Groups(3, 4, nr, nf2, sx2, 2, spoke_colors); //Side 2
	Create_Spoke_Groups(1, 2, nr, nf1, sx1, 1, spoke_colors); //Side 1

	Set_Wheel_Styles();

	$G_WHEEL.setAttribute('transform', " rotate(" + rotate + ")");
}//end Setup_Wheel() /*********************************************************/




function Set_Wheel_Styles_Spokes() { //****************************************/
	for (var group = 1; group <= 4; group++) {
		Set_Style_by_Class( SPOKE_GROUP_PREFIX + group, "stroke-width", $SPOKE_LINE_SIZE[group].value);
		Set_Style_by_Class( SPOKE_GROUP_PREFIX + group, "stroke"      , $SPOKE_COLOR[group].value);
		Show_Hide_Class(SPOKE_GROUP_PREFIX + group, $SPOKE_SHOW[group].checked);
	}
}//end Set_Wheel_Styles_Spokes() { //******************************************/




function Set_Wheel_Styles_Rim_etc() { //***************************************/
	Make_Rim(); //Rim line size affects displayed rim radius.
	$FLANGE1.style['stroke'] = $F1_COLOR.value;
	$FLANGE2.style['stroke'] = $F2_COLOR.value;
	$FLANGE1.style['stroke-width'] = $F1_LINE_SIZE.value*1;
	$FLANGE2.style['stroke-width'] = $F2_LINE_SIZE.value*1;

	Set_Style_by_Class(SPOKE_HOLES, 'stroke-width', $HOLE_LINE_SIZE.value);
	Set_Style_by_Class(SPOKE_HOLES, "stroke", $HOLE_COLOR.value);
	Show_Hide_Class( SPOKE_HOLES, $HOLES_SHOW.checked);

	Set_Style_by_Class( AXIS_CLASS, 'stroke-width', $AXES_LINE_SIZE.value );
	Set_Style_by_Class( AXIS_CLASS, "stroke", $AXES_COLOR.value );
	Show_Hide_Class( AXIS_CLASS, $AXES_SHOW.checked );

	Show_Hide($RIM    , $RIM_SHOW.checked);
	Show_Hide($FLANGE1, $F1_SHOW.checked);
	Show_Hide($FLANGE2, $F2_SHOW.checked);
}//end Set_Wheel_Styles_Rim_etc() { //*****************************************/




function Set_Wheel_Styles() { //***********************************************/
	Set_Wheel_Styles_Spokes();
	Set_Wheel_Styles_Rim_etc()
}//end Set_Wheel_Styles() { //*************************************************/




function Clear_Wheel() { //****************************************************/
	$RIM    .setAttribute('r', 0);
	$FLANGE1.setAttribute('r', 0);
	$FLANGE2.setAttribute('r', 0);
	$RIM_HOLES	  .innerHTML = "";
	$FLANGE1_HOLES.innerHTML = "";
	$FLANGE2_HOLES.innerHTML = "";
	$SPOKES		  .innerHTML = "";
	$SL[1].value = ''; //side 1, odd spokes
	$SL[2].value = ''; //side 1, even spokes
	$SL[3].value = ''; //side 2, odd spokes
	$SL[4].value = ''; //side 2, even spokes
	$SL_ADJ[1].value = ""; //Spoke lengths adjusted for elbows in/out.
	$SL_ADJ[2].value = ""; //
	$SPOKE_RATIO[1].value = '';
	$SPOKE_RATIO[2].value = '';
	$BRACE_ANGLE[1].value = '';
	$BRACE_ANGLE[2].value = '';
	$TENSION_RATIO[1].value = '';
	$TENSION_RATIO[2].value = '';
}//end Clear_Wheel() //********************************************************/




function Build_Wheel(save, input, integer) { //********************************/

	if (input) {
		if (!Validate_Input(input, integer)) { return false }
		
		//Check if basic "cleaned" value from Validate_Input() has really changed.
		if (input.value == input.prior_value) { return false }
		
		input.prior_value = input.value; //Also set in onfocus events & in Calc_Spoke_Lengths().
	}


	Clear_Wheel();


	//Any spokes to build?
	if ($ERD.value == 0 && $PCD[1].value == 0 && $PCD[2].value == 0) { return false; }


	var Spoke_Colors = ["", $SPOKE_COLOR[1].value, $SPOKE_COLOR[2].value,  $SPOKE_COLOR[3].value, $SPOKE_COLOR[4].value ];


	//Setup_Wheel(ERD, NR, NF1, NF2, PCD1, PCD2, SX1, SX2, SHD, Spoke_Colors)
	Setup_Wheel( $ERD.value*1, $NR.value*1, $NF[1].value*1, $NF[2].value*1,
				 $PCD[1].value*1, $PCD[2].value*1, $SX[1].value*1, $SX[2].value*1,
				 $HOLESIZE.value*1, Spoke_Colors
				);


	Calc_Spoke_Lengths();


	//Are all spokes on each side the same length? (Only check first two.)
	if ( (($NF[1].value < 2) || ($SL[1].value == $SL[2].value)) && ($SL[3].value == $SL[4].value))
		 { $SL_2_4.style['display'] = "none";      } //Yes   Well, the first two are, at least.
	else { $SL_2_4.style['display'] = "table-row"; } //No


	Update_Advanced_Info(save);
}//end Build_Wheel() //********************************************************/




function Error_Notice(init, what, msg) {//*************************************/
	//what: id of changed input.
	if (typeof msg == 'undefined') { msg = "" }

	if (!init && (what.tagName == "INPUT")) { msg = MSGS['invalid'] + ' "' + what.value + '".<br>' + msg; }

	$MESSAGE_DIV.innerHTML = msg;
	$MSG_BOX.style['visibility'] = "visible"; 
	$MSG_BOX.scrollTop = 0;
	
	//Resets input to prior value, except when...
	if (!init && what.id != $WHEEL_TYPE.id) { what.value = what.prior_value; }

	PRIOR_FOCUS = what.id;

	if (init == "init") {
		//Set a couple styles just for init. Reset in Close_Message().
		$MSG_BOX.style['text-align'] = "left";
		$MSG_BOX.style['top'] = "1rem";
		
		$CLOSE_MSG.style['visibility'] = "hidden";
		$ACCEPT_MSG.style['display'] = "";
		$LOAD_SAMPLES.focus(); //So user has to take action to focus & click the [I Accept] button.
	}
	else {
		$CLOSE_MSG.style['visibility'] = "";
		$ACCEPT_MSG.style['display'] = "none"; 
		//setTimeout needed when changing wheel "Type", if there's a msg. I don't know why.
		setTimeout(function() { $CLOSE_MSG.focus() },55);
	}
}//end Error_Notice() //*******************************************************/




function Close_Message() { //**************************************************/
	$MSG_BOX.style['visibility'] = "hidden";
	$MESSAGE_DIV.innerHTML = "";
	if (E(PRIOR_FOCUS).tagName == "INPUT") { E(PRIOR_FOCUS).select() }
	E(PRIOR_FOCUS).focus();
	$MSG_BOX.style['text-align'] = ""; //Restore values to style sheet from those 
	$MSG_BOX.style['top']        = ""; //used for the init msg/disclaimer.
}//end Close_Message() { //****************************************************/




function Set_SX() { //*********************************************************/
	//Set practical default cross values for most flange hole counts, even impractical ones.
	//User can change SX manually if desired.

	if ($WHEEL_TYPE.value == "custom") { return; }

	if ($NF[2].value*1 <  4) { $SX[2].value = 0 } else
	if ($NF[2].value*1 < 10) { $SX[2].value = 1 } else
	if ($NF[2].value*1 < 16) { $SX[2].value = 2 } else
	if ($NF[2].value*1 < 20) { $SX[2].value = 3 } else
	if ($NF[2].value*1 < 26) { $SX[2].value = 4 } else
	if ($NF[2].value*1 < 36) { $SX[2].value = 5 } else
							{ $SX[2].value = 6 }
	
	if ($WHEEL_TYPE.value == "standard") { $SX[1].value = $SX[2].value; }
	if ($WHEEL_TYPE.value == "triplet")  { $SX[1].value = 0; }
}//end Set_SX() { //***********************************************************/




function Set_NF(nr_value) { //*************************************************/
	//Do not call while *in* "custom" mode.

	$NF[1].prior_value = $NF[1].value;
	$NF[2].prior_value = $NF[2].value;

	if ($WHEEL_TYPE.value == "standard") {
		
		//Cooresponding NF's required for a given NR.
		$NF[1].value = nr_value/2;
		$NF[2].value = nr_value/2;
		
	} else
	if ($WHEEL_TYPE.value == "triplet") {
		
		//Cooresponding NF's required for a given NR.
		$NF[1].value = nr_value/3;
		$NF[2].value = $NF[1].value*2;
		
	}//end if ($WHEEL_TYPE.value...)


	if ($WHEEL_TYPE.value == "custom") { return; }
	
	//For Standard & Triplet modes
	$NF[1].disabled = true;
	$NF[2].disabled = true;

}//end Set_NF() { //***********************************************************/




function SX_Enable_Disable(f) { //*********************************************/
	//Generally, spoke cross must be 0 if NF is odd.

	if ($WHEEL_TYPE.value == "custom") { return }

	if ($NF[f].value%2 == 0)	{ //even hole count

		$SX[f].disabled = false;
	}
	else {					  //odd
		$SX[f].disabled = true;
		$SX[f].value = 0;
	}
}//end SX_Enable_Disable() { //************************************************/




function Validate_NR() { //****************************************************/
	//Acutal validation of NR is no longer needed (NR is now a <select>), but some other checks are.

	Set_NF($NR.value);

	Build_SX_Options($WHEEL_TYPE.value, 1, $NF[1].value, $SX[1].value);
	Build_SX_Options($WHEEL_TYPE.value, 2, $NF[2].value, $SX[2].value);

	Set_SX()

	//If NF is odd, cross can only be 0. (Except in "custom" mode.)
	SX_Enable_Disable(1);
	SX_Enable_Disable(2);


	if ($NR.value*1 > 0) { return true } //Build_WHeel() on return

	//Else if NR==0, clear the spokes, rim holes, & various spoke length results.
	$NR.prior_value = $NR.value;

	$RIM_HOLES	 .innerHTML = "";
	$SPOKES		 .innerHTML = "";
	$SL[1].value = ''; //side 1, odd spokes
	$SL[2].value = '';
	$SL[3].value = ''; //side 2, odd spokes
	$SL[4].value = '';

	$SL_ADJ[1].value = '';
	$SL_ADJ[2].value = '';
	$SPOKE_RATIO[1].value = '';
	$SPOKE_RATIO[2].value = '';
	$BRACE_ANGLE[1].value = '';
	$BRACE_ANGLE[2].value = '';
	$TENSION_RATIO[1].value = '';
	$TENSION_RATIO[2].value = '';

	if ($WHEEL_TYPE.value != "custom") {
		$FLANGE1_HOLES.innerHTML = "";
		$FLANGE2_HOLES.innerHTML = "";
	}


	Save_Settings(LS_WHEEL_SETTINGS, DEFAULT_VALUES);

	return false; //No spokes, so can't Build_Wheel().

}//end Validate_NR() { //******************************************************/




function Validate_NF(nf, f) { //***********************************************/

	if ($NF[f].value*1 > MAX[$NF[f].id]) {
		var msg = MSGS['max_fl'] + MAX[$NF[f].id] + ".<br>";
		Error_Notice('', $NF[f], msg);
		return false;
	}

	//##### Figure out how to make this not needed (how flange-rim holes are matched up).
	if ( $NF[1].value*1 > $NF[2].value*1) { //Things mess up...
		if (f==1) { var msg = MSGS['nf1_2']; }
		else 	  { var msg = MSGS['nf2_1']; }
		Error_Notice('', $NF[f], msg);
		return false;
	}

	Build_SX_Options($WHEEL_TYPE.value, f, $NF[f].value, $SX[f].value);
	SX_Enable_Disable(f);

	return true;
}//end Validate_NF() //********************************************************/




function Validate_Input(input, integer, allow_neg) { //************************/

	input.value = input.value.trim();

	if (isNaN(input.value)) { Error_Notice('', input); return false; }

	//Some values (really just OC) can be negative.
	if (!allow_neg && (input.value*1 < 0)) { Error_Notice('', input); return false; }

	if (input.value != "") {
		if (integer) { input.value = Math.floor(parseFloat(input.value)); }
		else 		 { input.value = parseFloat(input.value); }
	}

	return true;
}//end Validate_Input() { //***************************************************/




function Setup_Viewbox() { //**************************************************/

	if ($ERD.value == 0 && $PCD[1].value == 0 && $PCD[2].value == 0) { total = DEFAULT_OPTIONS['VIEWBOX_SIZE']; }
	else {
		var erd = $ERD.value*1;
		var rim = $RIM_LINE_SIZE.value*1;
		var total = (erd + rim * 2) * 1.05; //The 1.05 just adds a little buffer space around the wheel.
	}

	var view_box_size = total

	//Setup viewbox...
	var view_W = view_box_size; //Width
	var view_H = view_box_size; //Height
	var V_offset = (-view_H/2); //Vertical Offset 

	$SVG_WHEEL.setAttribute('viewBox', (-view_W/2) + " " + V_offset + " " + view_W + " " + view_H);

	//Set xy axis...
	var max_XY = view_box_size/2;
	$X_axis.setAttribute('x1', -max_XY);
	$X_axis.setAttribute('y1', 0);
	$X_axis.setAttribute('x2',  max_XY);
	$X_axis.setAttribute('y2', 0);

	$Y_axis.setAttribute('x1', 0);
	$Y_axis.setAttribute('y1', -max_XY);
	$Y_axis.setAttribute('x2', 0);
	$Y_axis.setAttribute('y2',  max_XY);

}//end Setup_Viewbox() { //****************************************************/




function Show_Hide_Class(classname, show, save) { //***************************/
	var items = D.getElementsByClassName(classname);

	for (var s = 0; s < items.length; s++)
	{
		if (show) { items[s].style['display'] = "" ;   }
		else 	  { items[s].style['display'] = "none" }
	}

	if (save) { Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS); }

}//end Show_Hide_Class() //****************************************************/




function Show_Hide(what, show, save) { //**************************************/
	if (show) { what.style['display'] = ""     }
	else 	  { what.style['display'] = "none" }

	if (save) { Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS); }

}//end Show_Hide() //**********************************************************/




function Scroll_Into_View(target, extra) { //**********************************/
	//Only scroll if target display is !=none, and 
	//if the top of the element is not visible in the window.

	if (target.style['display'] == "none") { return; }

	var rect = target.getBoundingClientRect();

	//window contents scroll down if off the top...
    if (rect.top < extra) { window.scrollBy(0, rect.top - extra); return; }


	var viewable_amount = window.innerHeight - rect.top;
	var min_top_visible = 150; //Scroll this much of element into view, if less than this amount.

	//window contents scroll up if off the bottom...
    if (viewable_amount < min_top_visible) { window.scrollBy(0, min_top_visible - viewable_amount); }

}//end Scroll_Into_View() { //*************************************************/




function Set_Style_by_Class(classname, style, value, save) { //****************/
	var objects = D.getElementsByClassName(classname);
	for (var s = 0; s < objects.length; s++) { objects[s].style[style] = value; }

	if (save) { Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS); }

}//end Set_Style_by_Class() //*************************************************/




function Set_Save_Style(element, style, value) { //****************************/
	element.style[style] = value;
	Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS); 
}//end Set_Save_Style() //*****************************************************/




function Set_Attribute_by_Class(classname, attribute, value) { //**************/
	var objects = D.getElementsByClassName( classname );
	for (var x = 0; x < objects.length; x++) { objects[x].setAttribute( attribute, value ); }
}//end Set_Attribute_by_Class() //*********************************************/




function Setup_Wheel_Type(init) { //*******************************************/
	//Adjust/set NR, NF, & SX as needed for each type(mode) -  (standard/triplet/custom).

	var nr_new = $NR.value*1;

	if ($WHEEL_TYPE.value == "standard") { //NR must, at least,  be even,
		var nr_mod4 = nr_new % 4		  //but in standard mode, only allow counts dividible by 4.
		if (nr_mod4 != 0) { nr_new += (4 - nr_mod4); } //"round up" if not div/4.
		$SETTINGS.style['background-color'] = BG_STANDARD;
	}


	if ($WHEEL_TYPE.value == "triplet") { //NR must be divisible by 3
		var nr_mod3 = nr_new % 3;
		if (nr_mod3 != 0) { nr_new += (3 - nr_mod3); } //"round up" if not div/3.
		$SETTINGS.style['background-color'] = BG_TRIPLET;
	}


	Build_NR_Options($WHEEL_TYPE.value, MAX[$NR.id], nr_new);


	if ($WHEEL_TYPE.value != "custom") {
		Set_NF(nr_new);
		Build_SX_Options($WHEEL_TYPE.value, 1, $NF[1].value, $SX[1].value);
		Build_SX_Options($WHEEL_TYPE.value, 2, $NF[2].value, $SX[2].value);
		
		if (init != "init") {
	 		Set_SX();
			
			SX_Enable_Disable(1);
			SX_Enable_Disable(2);
		}
		return true; //Build_Wheel() on return
	}

	//else custom...
	var f = 1;
	Build_SX_Options($WHEEL_TYPE.value, f, $NF[f].value, $SX[f].value);
	$NF[f].disabled = false;
	$SX[f].disabled = false;

	var f = 2;
	Build_SX_Options($WHEEL_TYPE.value, f, $NF[f].value, $SX[f].value);
	$NF[f].disabled = false;
	$SX[f].disabled = false;

	
	$SETTINGS.style['background-color'] = BG_CUSTOM;
	
	return false; //No need to Build_Wheel(), as no wheel values have changed.

}//end Setup_Wheel_Type() { //*************************************************/




function Assign_Events() { //**************************************************/

	var save = true; //Just for clarity below, as some functions have an option to save settings.

	//Save current value (as .prior_value) onfocus in case of error in new value.
	var settings = [$WHEEL_TYPE, $LACE_OPT, $ERD, $NR, $NF[1], $NF[2], $PCD[1], $PCD[2], $FTC[1], $FTC[2], $OSB[1], $OSB[2], $SX[1], $SX[2], $SHD, $FW, $SDB];
	for (var x = 0; x < settings.length; x++) {
		settings[x].addEventListener("focus", function() {
			if ($ACCEPT_MSG.value != "true") { $ACCEPT_MSG.focus(); }
			this.prior_value = this.value; //also set in Bulid_Wheel() and in Calc_Spoke_Lengths().
		});
	}


	$LOAD_SAMPLES  .addEventListener("click", function () { Load_Samples()   });
	$CLEAR_SETTINGS.addEventListener("click", function () { Clear_Settings() });

	$WHEEL_TYPE.addEventListener("change", function() {
		if (Setup_Wheel_Type()) { Build_Wheel() }
		Save_Settings(LS_WHEEL_SETTINGS, DEFAULT_VALUES);
	});

	$ERD     .addEventListener("change", function() { Build_Wheel(save, this, 0); Setup_Viewbox(); });
	$NR      .addEventListener("change", function() { if (Validate_NR())        { Build_Wheel(save, this, 1); } });
	$NF[1]   .addEventListener("change", function() { if (Validate_NF(this, 1)) { Build_Wheel(save, this, 1); } });
	$NF[2]   .addEventListener("change", function() { if (Validate_NF(this, 2)) { Build_Wheel(save, this, 1); } });
	$PCD[1]  .addEventListener("change", function() { Build_Wheel(save, this, 0); });
	$PCD[2]  .addEventListener("change", function() { Build_Wheel(save, this, 0); });
	$FTC[1]  .addEventListener("change", function() { Build_Wheel(save, this, 0); });
	$FTC[2]  .addEventListener("change", function() { Build_Wheel(save, this, 0); });
	$SX[1]   .addEventListener("change", function() { Build_Wheel(save, this, 1); }); //3rd param, allows int's only.
	$SX[2]   .addEventListener("change", function() { Build_Wheel(save, this, 1); }); //Probably superfluous for a <select>...
	$LACE_OPT.addEventListener("change", function() { Build_Wheel(save) });

	// Only need to recalc final spoke lengths. OSB & SHD are ignored in display calculations for <line> endpoints.
	var validate = true;
	$OSB[1]	  .addEventListener("change", function() { Calc_Spoke_Lengths(validate, this, 0, 1); }); //3rd param, 1, allows neg numbers.
	$OSB[2]	  .addEventListener("change", function() { Calc_Spoke_Lengths(validate, this, 0, 1); });
	$SHD	  .addEventListener("change", function() { Calc_Spoke_Lengths(validate, this, 0, 0); });

	$ELBOWS[1].addEventListener("change", function() { Update_Advanced_Info(save); });
	$ELBOWS[2].addEventListener("change", function() { Update_Advanced_Info(save); });
	$FW 	  .addEventListener("change", function() { Update_Advanced_Info(save); });
	$SDB	  .addEventListener("change", function() { Update_Advanced_Info(save); });


	$SHOW_HIDE_ADVANCED.addEventListener("click", function() { Show_Hide_Options(this, $ADVANCED_INFO	, "inline-block"); });
	$SHOW_HIDE_DO      .addEventListener("click", function() { Show_Hide_Options(this, $DISPLAY_OPTIONS	, "inline-block"); });
	$SHOW_HIDE_NOTES   .addEventListener("click", function() { Show_Hide_Options(this, $NOTES			, "inline-block"); });
	$SHOW_HIDE_OTHER   .addEventListener("click", function() { Show_Hide_Options(this, $OTHER_CALCS		, "inline-block"); });


	for (var group = 1; group <= 4; group++) {
		(function(g) {
			$SPOKE_COLOR[g]    .addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + g, "stroke", this.value, save); });
			$SPOKE_LINE_SIZE[g].addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + g, "stroke-width", this.value, save); });
			$SPOKE_SHOW[g]     .addEventListener("change", function() { Show_Hide_Class( SPOKE_GROUP_PREFIX + g, this.checked, save); });
		})(group);
	}

	$RIM_COLOR    .addEventListener("change", function() { Set_Save_Style($RIM,     'stroke', this.value); });
	$RIM_LINE_SIZE.addEventListener("change", function() { Make_Rim(save); });
	$RIM_SHOW     .addEventListener("change", function() { Show_Hide($RIM    , this.checked, save) });

	$F1_COLOR     .addEventListener("change", function() { Set_Save_Style($FLANGE1, 'stroke', this.value); });
	$F1_LINE_SIZE .addEventListener("change", function() { Set_Save_Style($FLANGE1, 'stroke-width', this.value); });
	$F1_SHOW      .addEventListener("change", function() { Show_Hide($FLANGE1, this.checked, save) });

	$F2_COLOR     .addEventListener("change", function() { Set_Save_Style($FLANGE2, 'stroke', this.value); });
	$F2_LINE_SIZE .addEventListener("change", function() { Set_Save_Style($FLANGE2, 'stroke-width', this.value); });
	$F2_SHOW      .addEventListener("change", function() { Show_Hide($FLANGE2, this.checked, save) });

	$AXES_COLOR    .addEventListener("change", function() { Set_Style_by_Class( AXIS_CLASS, "stroke", this.value, save); });
	$AXES_LINE_SIZE.addEventListener("change", function() { Set_Style_by_Class(AXIS_CLASS, 'stroke-width', this.value, save); });
	$AXES_SHOW     .addEventListener("change", function() { Show_Hide_Class( AXIS_CLASS, this.checked, 1); });

	$HOLE_COLOR    .addEventListener("change", function() { Set_Style_by_Class(SPOKE_HOLES, "stroke"      , this.value, save); });
	$HOLE_LINE_SIZE.addEventListener("change", function() { Set_Style_by_Class(SPOKE_HOLES, 'stroke-width', this.value, save); });
	$HOLES_SHOW    .addEventListener("change", function() { Show_Hide_Class(SPOKE_HOLES, this.checked, save); });
	
	$HOLESIZE.addEventListener("change", function() { 				//$HOLESIZE is diameter
		Set_Attribute_by_Class( RIM_HOLE_CLASS, 'r', this.value/2); //set *radius* of holes (this.value/2)
		Set_Attribute_by_Class( HUB_HOLE_CLASS, 'r', this.value/2);
		Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS);
	});


	$RESET_OPTIONS_SPOKES.addEventListener("click", function() {
		Load_DEFAULT_OPTIONS_Spokes();
		Set_Wheel_Styles_Spokes();
		Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS);
	});


	$RESET_OPTIONS_RIM_ETC.addEventListener("click", function() {
		Load_DEFAULT_OPTIONS_Rim_etc();
		Set_Wheel_Styles_Rim_etc();
		Set_Attribute_by_Class( RIM_HOLE_CLASS, 'r', $HOLESIZE.value/2);
		Set_Attribute_by_Class( HUB_HOLE_CLASS, 'r', $HOLESIZE.value/2);
		Save_Settings(LS_DISPLAY_OPTIONS, DEFAULT_OPTIONS);
	});


	$CLOSE_MSG.addEventListener("blur" , function() { Close_Message() });
	
	$CLOSE_MSG.addEventListener("click", function() { Close_Message() });

	$ACCEPT_MSG.addEventListener("click", function() {
		$ACCEPT_MSG.value = "true";
		var expires = new Date(+new Date() + 2592000000); //in 30 days (in milliseconds) Should it be Longer? Shorter?
		D.cookie = $ACCEPT_MSG.id + "=true; expires=" + expires.toUTCString() + "; path=/";
		Close_Message();
	});


	D.addEventListener("keydown", function(event) {scroll_blur(event)});
}//end Assign_Events() //******************************************************/




function Init() { //***********************************************************/

	Assign_Events();

	Build_NR_Options("custom", MAX[$NR.id], 0);  //Temp until settings loaded, then again in Setup_Wheel_Type().
	Build_SX_Options("custom", 1, MAX[$NR.id], 0);	//		"		"		"		"		"		"		"
	Build_SX_Options("custom", 2, MAX[$NR.id], 0);	//		"		"		"		"		"		"		"

	var saved_settings_found = Load_Saved_Settings(LS_WHEEL_SETTINGS);  //If any...

	if (saved_settings_found) { Validate_Wheel_Settings(); } else { $LACE_OPT.value = 1 ; }

	Load_DEFAULT_OPTIONS();
	Load_Saved_Settings(LS_DISPLAY_OPTIONS); //If any...		

	Setup_Viewbox();

	Setup_Wheel_Type("init");

	if (saved_settings_found) { Build_Wheel(); }


	$ADVANCED_INFO  .style["display"] = $SHOW_HIDE_ADVANCED.value;
	$OTHER_CALCS	.style["display"] = $SHOW_HIDE_OTHER.value;
	$DISPLAY_OPTIONS.style["display"] = $SHOW_HIDE_DO.value;
	$NOTES			.style["display"] = $SHOW_HIDE_NOTES.value;

	//Reduce the visually jarring, if brief,  jumping around of page elements during page load.
	$CONTAINER.style['visibility'] = "visible";
	$CONTAINER.style.opacity = '1'


	//Disclaimer - check cookies to see if already accepted.
	//Why cookies? I don't know, it was late/early and seemed like a good idea at the time...
	$ACCEPT_MSG.value = "false"; //initialize [I Accept] button value.
	var COOKIES = D.cookie.split("; ");
	for (var x = 0; x < COOKIES.length; x++) {
		COOKIES[x] = COOKIES[x].split("=");
		if (COOKIES[x][0] == $ACCEPT_MSG.id) {
			if (COOKIES[x][1] == "true") { $ACCEPT_MSG.value = "true"; }
			break; //There can be only one...
		}
	}

	if ($ACCEPT_MSG.value == "true")
		{ $ERD.focus(); }
	else
		{ Error_Notice('init', $ERD, MSGS['notice'] + $RESPONSIBILITY.innerHTML); }

}//end Init() //***************************************************************/





window.addEventListener("load", function(){Init()});
//*****************************************************************************/
})();</script>

