<!DOCTYPE html>
<meta charset="utf-8"/>



<!--=========================================================================..>
The SVG Wheel Maker
vbeta.10


Copyright © 2017 https://github.com/Self-Evident  David W. Gay

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
<!--=========================================================================-->



<script>(function(){
var D = document;
function E(id) { return document.getElementById(id); }



//##### ###########################################################################
function Log(something, br) {
	if (typeof something === 'undefined') { E('CONSOLE').innerHTML = ""; return; }
	if (br == true) { br = "<br>" } else { br = "" }
	something = escape_HTML(something + "");
	
	E('CONSOLE').innerHTML += something + br;
	E('CONSOLE').scrollTop = E('CONSOLE').scrollHeight;
	E('CONSOLE').style['display'] = "inline-block";
}//end Log()
//##### ###########################################################################




//##### ###########################################################################
function escape_HTML(text) {
  var map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };

  return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}//end escape_HTML()
//##### ###########################################################################




function Create_Spoke_Holes(group, id, class1, class2, N, scale, shd, offset) { //***/
	//Create & position N spoke holes in <g id=group>, with radius of shd/2 (shd="spoke hole diameter")

	var odd = true;		//for alternating classes

	for (var sh = 1; sh <= N; sh++) {
		var full_id = id + '_' + sh;
		odd = !odd;
		if (odd) { var class_X = class1 } else { var class_X = class2 }
		E(group).innerHTML += '<circle id=' + full_id + ' class="' + class_X + '" r="' + (shd/2) + '" cx="0" cy="0" />';
	}

	//##### 
	E(id + "_1").style["fill"] = "red"; //#####
	
	Move_Spoke_Holes(id, N, scale, offset); //
}//end Create_Spoke_Holes() //*************************************************/




function Move_Spoke_Holes(id, N, scale, offset) { //********************/
	if (typeof offset == "undefined") { offset = 0 }

	var A = 360/N; //angle between holes
	
	var a = offset;	//angle to current hole from 0
	var cx, cy;		//coordinates for hole

	for (var sh = 1; sh <= N; sh++) {
		var full_id = id + '_' + sh;
		
		cx = Math.round(Math.sin( (a/180) * Math.PI) * scale * 10000)/10000;
		cy = Math.round(Math.cos( (a/180) * Math.PI) * scale * 10000)/10000;
		
		E(full_id).setAttribute('cx', cx);
		E(full_id).setAttribute('cy', cy);
		
		a += A; //Spoke hole 1 is first hole at or after 0 degrees/"6 o'clock".
	}
}//end Move_Spoke_Holes() //***************************************************/




function Draw_Spoke(group, flange, flange_hole, rim_hole, color) { //*********/

	if (typeof color == "undefined") { color = "black" }

	var group_id = "WH_spokes"; //##### add a parameter for each group? (1-4) //#####
	var flange_hole_id = "WH_f" + flange + "sh_" + flange_hole;
	var rim_hole_id	= "WH_rsh_" + rim_hole;

	var x1 = E(flange_hole_id).getAttribute('cx');
	var y1 = E(flange_hole_id).getAttribute('cy');

	var x2 = E(rim_hole_id).getAttribute('cx');
	var y2 = E(rim_hole_id).getAttribute('cy');

	var style = ' style="stroke:'+color+'"';
	var coords = ' x1="'+x1+'" y1="'+y1+'" x2="'+x2+'" y2="'+y2+'" ';
	var spoke = '<line class="WH_spoke WH_group' + group + '"' + coords + style + '/>' + "\n";
	E(group_id).innerHTML += spoke;

	//Calculate final spoke length, including FtC...
	var xd = x2 - x1
	var yd = y2 - y1
	var ftc = E('FTC' + flange).value;
	var s1 = Math.sqrt(xd*xd + yd*yd + ftc*ftc) - E('SHD').value/2;
	s1 = Math.round(s1*10)/10;
	Log(s1,1); //#####
	
}//end Draw_Spoke() //*********************************************************/




function Lacing_Option(f) { //*************************************************/
	/*************************************************************************
	tl;dr: "It's complicated..."  :)

	In a triplet wheel, with a given spoke count & cross, there are two lace patterns possible: "Type 1" and "Type 2"  :)
	In this program, it is presented as "Lacing Option".  Also, it only concerns the side with more spokes (ie: 16 vs 8).
	Well, those three options: spoke count, spoke cross, and lace type;  presents us with a three body quatum gravitational
	paradoxical	muonicly generational anti-matter teseractic equation that cost me many hours of time & much pounding of my 
	head against a cinder block wall...

	Anyway, a modifier is needed, either 1 or -1, depending on the desired triplet type & other two conditions. But, it's not
	always the same. And sometimes it's different, except when it's not...

	All 8 possible combinations (3 "bits": count, cross, type) are summerized in each of the two tables below. 
	Each shows all 8 combinations, but with a different focus.  Because...
	

	    T1   |    T2		    1   |   -1				NR: Number of holes in the Rim (24, 27, 32, etc.)
	 --------+--------		--------+--------			SX: Spoke Cross (1x, 2x, 3x, etc.)
	 NR SX * | NR SX *		NR SX T | NR SX T			* : Modifier (1 or -1)
	 --------+--------		--------+--------			T : Triplet Type (T1 or T2)
	 E  E  1 | E  E -1		E  E  1 | E  O  1		   \ | /	| | |
	 O  E  1 | O  E -1		O  E  1 | O  O  1			\|/ 	| | |
	 E  O -1 | E  O  1		E  O  2 | E  E  2			 X 		| | |
	 0  O -1 | 0  O  1		O  O  2 | O  E  2		    /|\		| | |
													   Type 1   Type 2
	/*************************************************************************/


	var NRE = (E('NR'    ).value/2 == Math.round(E('NR'    ).value/2));  // Even number of rim holes?
	var SXE = (E('SX' + f).value/2 == Math.round(E('SX' + f).value/2));  // Even Spoke cross?
	var T1  = (E('LACE_OPT').selectedIndex == 0);						 // Triplet/Lacing Type 1?

	Log(NRE + " " + SXE + " " + T1,1 )	//##### 

	if ( ( NRE &&  SXE &&  T1) || (!NRE &&  SXE &&  T1) ||
		 ( NRE && !SXE && !T1) || (!NRE && !SXE && !T1)
		)
		 { return  1 } 
	else { return -1 }
}//end Lacing_Option() //******************************************************/




function Create_Spoke_Group(group, nr, nf, X, f, d, lace_opt, color ) { //*******/

	if (d == 1) {var s1 = 1; } else { var s1 = 2; } //odd or even group of spokes
	
	Log("Group " + group + "",1)		  //#####
	Log("(F:" + f + ", D:" + d + ")", 1); //#####

	for (var h_hole = s1; h_hole <= nf; h_hole += 2) {

		var r_skip = nr/nf;
		var r_hole = (h_hole + d*X*Lacing_Option(f))*r_skip + f - r_skip - 0.5;

		r_hole = Math.round(r_hole)
		if (r_hole > nr) {r_hole -= nr;}
		if (r_hole <  1) {r_hole += nr;}
		
		Log(h_hole + ", ")//#####
		Log(r_hole + ": ")//#####
		
		Draw_Spoke(group,  f,  h_hole,  r_hole ,  color);
	}
	Log("",1)//#####
}//end Create_Spoke_Group() //*************************************************/




function Setup_Wheel(ERD, NR, NF1, NF2, PCD1, PCD2, SX1, SX2, SHD, lace_opt, desc, spoke_colors) { /****/
	Clear_Wheel();

	var LACE = E('LACE_OPT')
	Log("Lace Option: " + LACE.options[LACE.selectedIndex].text + "= " + LACE.value,1) //#####
	Log('F = "Flange"',1)//#####
	Log('D = "Direction"',1)//#####


	var NF = [0, NF1, NF2];
	var SX = [0, SX1, SX2];

	var AR = 360/NR;  //Angle between holes in Rim
	var AF = 360/NF2; //Angle between holes in Flange
	
	var offset_f1_f2 = AF/2; //Offset angle between left & right hub flange holes. The radial side is "0".
							 //##### Issue if triplet entered as 16:8 instead of 8:16?? Probably, but haven't checked yet...
							 
	var rotate = 180; //##### -11.25; //Rotate whole wheel...

	//Draw & color rim & flange circles..
	E('WH_ERD') .setAttribute('r', ERD/2); //ERD & PCD's are "D"iameters. SVG <circle>'s require a radius...
	E('WH_PCD1').setAttribute('r', PCD1/2);//
	E('WH_PCD2').setAttribute('r', PCD2/2);//
	E('WH_ERD') .style['stroke'] = E('COLOR_R').value;
	E('WH_PCD1').style['stroke'] = E('COLOR_F1').value;
	E('WH_PCD2').style['stroke'] = E('COLOR_F2').value;


	Create_Spoke_Holes('WH_rim_holes', 'WH_rsh' , 'WH_rsh', 'WH_rsh', NR , ERD/2 , SHD, 0);
	Create_Spoke_Holes('WH_flange_1' , 'WH_f1sh', 'WH_hsh', 'WH_hsh', NF1, PCD1/2, SHD, 0);
	Create_Spoke_Holes('WH_flange_2' , 'WH_f2sh', 'WH_hsh', 'WH_hsh', NF2, PCD2/2, SHD, offset_f1_f2);


	var f = 1; //flange
	//##### 
	Create_Spoke_Group(1, NR, NF[f], SX[f], f,  1, 1, spoke_colors[1])
	//##### 
	Create_Spoke_Group(2, NR, NF[f], SX[f], f, -1, 1, spoke_colors[2])

	var f = 2; //flange
	//##### 
	Create_Spoke_Group(3, NR, NF[f], SX[f], f,  1, lace_opt, spoke_colors[3])
	//##### 
	Create_Spoke_Group(4, NR, NF[f], SX[f], f, -1, lace_opt, spoke_colors[4])


	Show_Hide_Class('WH_group1', E('SHOW1').checked); //Spokes are destroyed & re-created
	Show_Hide_Class('WH_group2', E('SHOW2').checked); // onchange of most settings.
	Show_Hide_Class('WH_group3', E('SHOW3').checked); //So, re-set their display state.
	Show_Hide_Class('WH_group4', E('SHOW4').checked); //


	//##### E('WH_desc').innerHTML = desc;

	var view_W = 610; //Width
	var view_H = 610; //Height
	var V_offset = (-view_H/2); //Vertical Offset
	E('WH_box').setAttribute('width',  view_W);
	E('WH_box').setAttribute('height', view_H);
	E('WH_box').setAttribute('viewBox', (-view_W/2) + " " + V_offset + " " + view_W + " " + view_H);

	E('WH_wheel').setAttribute('transform', " rotate(" + rotate + ")");
}//end Setup_Wheel() /*********************************************************/




function Clear_Wheel() { //****************************************************/
		Log(); //Clear Log of wheel info
		E('WH_rim_holes').innerHTML = "";
		E('WH_flange_1') .innerHTML = "";
		E('WH_flange_2') .innerHTML = "";
		E('WH_spokes')   .innerHTML = "";
}//end Clear_Wheel() //********************************************************/




function Build_Wheel() { //****************************************************/

	var Spoke_Colors	= ["", E('COLOR1').value, E('COLOR2').value,  E('COLOR3').value, E('COLOR4').value ]; //"none" to hide a group

  //Setup_Wheel(ERD, NR, NF1, NF2, PCD1, PCD2, SX1, SX2, SHD, LACE_OPT, desc, Spoke_Colors)
	Setup_Wheel(
		E('ERD').value*1, E('NR').value*1, E('NF1').value*1, E('NF2').value*1,
		E('PCD1').value*1, E('PCD2').value*1, E('SX1').value*1, E('SX2').value*1,
		E('SHD').value*1, E('LACE_OPT').value*1, "HEY!!!!!", Spoke_Colors
	);
}//end Build_Wheel() //********************************************************/




function Show_Hide_Class(what, show) { //**************************************/
	var items = D.getElementsByClassName(what);

	for (var s = 0; s < items.length; s++) {
		if (show) { items[s].style['display'] = "" ; }
		else 	  { items[s].style['display'] = "none" }
	}
}//end Show_Hide_Class() //****************************************************/




function Set_Spoke_Color(group, color) { //************************************/
	var spokes = D.getElementsByClassName('WH_group' + group);
	for (var s = 0; s < spokes.length; s++) { spokes[s].style['stroke'] = color; }
}//end Set_Spoke_Color() //****************************************************/




function Show_Hide(what, show) { //********************************************/
	if (show) { E(what).style['display'] = ""  }
	else 	  { E(what).style['display'] = "none" }
}//end Show_Hide() //**********************************************************/




function Assign_Onchange_Events() { //*****************************************/
	E('ERD')	  .onchange = function() { Build_Wheel() }
	E('NR')		  .onchange = function() { Build_Wheel() }
	E('NF1')	  .onchange = function() { Build_Wheel() }
	E('NF2')	  .onchange = function() { Build_Wheel() }
	E('PCD1')	  .onchange = function() { Build_Wheel() }
	E('PCD2')	  .onchange = function() { Build_Wheel() }
	E('SX1')	  .onchange = function() { Build_Wheel() }
	E('SX2')	  .onchange = function() { Build_Wheel() }
	E('FTC1')	  .onchange = function() { Build_Wheel() }
	E('FTC2')	  .onchange = function() { Build_Wheel() }
	E('LACE_OPT') .onchange = function() { Build_Wheel() }
	

	E('SHD').onchange = function() {
		//##### Changing spoke hole diameter affects final spoke length, so we need to rebuild to recompute.
		//##### (Spoke length is calculated in Draw_Spoke())
		Build_Wheel(); return;
		
		var spoke_holes = D.getElementsByClassName('WH_rsh');
		for (var h = 0; h < spoke_holes.length; h++) { spoke_holes[h].setAttribute('r', this.value/2); }//set *radius* of hole
		
		var spoke_holes = D.getElementsByClassName('WH_hsh');
		for (var h = 0; h < spoke_holes.length; h++) { spoke_holes[h].setAttribute('r', this.value/2); }//set *radius* of hole
	}


	E('AXES').onchange = function() { Show_Hide_Class('WH_axis', this.checked); }


	E('COLOR1').onchange = function() { Set_Spoke_Color(1, this.value) }
	E('COLOR2').onchange = function() { Set_Spoke_Color(2, this.value) }
	E('COLOR3').onchange = function() { Set_Spoke_Color(3, this.value) }
	E('COLOR4').onchange = function() { Set_Spoke_Color(4, this.value) }
	E('SHOW1').onchange = function() { Show_Hide_Class('WH_group1', this.checked) }
	E('SHOW2').onchange = function() { Show_Hide_Class('WH_group2', this.checked) }
	E('SHOW3').onchange = function() { Show_Hide_Class('WH_group3', this.checked) }
	E('SHOW4').onchange = function() { Show_Hide_Class('WH_group4', this.checked) }
	

	E('COLOR_R') .onchange = function() { E('WH_ERD') .style['stroke'] = this.value }
	E('COLOR_F1').onchange = function() { E('WH_PCD1').style['stroke'] = this.value }
	E('COLOR_F2').onchange = function() { E('WH_PCD2').style['stroke'] = this.value }
	E('SHOW_R')  .onchange = function() { Show_Hide('WH_ERD',  this.checked) }
	E('SHOW_F1') .onchange = function() { Show_Hide('WH_PCD1', this.checked) }
	E('SHOW_F2') .onchange = function() { Show_Hide('WH_PCD2', this.checked) }
	
}//end Assign_Onchange_Events() //*********************************************/





window.onload = function() { //************************************************/

	//Load default values.
	E('ERD') .value = 577;
	E('NR')  .value = 24;
	E('NF1') .value =  8;
	E('NF2') .value = 16;
	E('PCD1').value = 38.5;
	E('PCD2').value = 50.6;
	E('FTC1').value = 37.7;
	E('FTC2').value = 17.1;
	E('SX1') .value = 0;
	E('SX2') .value = 2;
	E('SHD') .value = 2.6;
	E('LACE_OPT').selectedIndex = 0;
	
	E('COLOR1').value = "#77F"; //blueish
	E('COLOR2').value = "#44F"; //blueish-er
	E('COLOR3').value = "#6F6"; //greenish
	E('COLOR4').value = "#4D4"; //greenish-er
	E('SHOW1').checked = 1//#####true;
	E('SHOW2').checked = 1//#####true;
	E('SHOW3').checked = 1//#####true;
	E('SHOW4').checked = 1//#####true;

	E('COLOR_R') .value = "#777"; //gray
	E('COLOR_F1').value = "#AAA"; //lighter gray
	E('COLOR_F2').value = "#777"; //gray
	E('SHOW_R') .checked = true;
	E('SHOW_F1').checked = true;
	E('SHOW_F2').checked = true;

	E('AXES').checked = true;
	//end default values


	Assign_Onchange_Events();

	Build_Wheel();

	E('ERD').focus();

	//#####	Log(E('body').innerHTML)

}//end window.onload //********************************************************/

})();</script>




<body id=body>
<style>
body {margin: 0}
* { margin: 0; padding: 0; box-sizing: border-box; }

table.settings { border: solid 1px gray; border-collapse: collapse; font-family: arial; width: 10rem; }
table.settings th { border: solid 0px red; text-align: left; }
table.settings td { border: solid 0px red; text-align: center; }
table.settings input  { width: 3rem; text-align: center; }
table.settings select { width: 3rem; text-align: center; }

/*** The prefix "WH_" simple means "WHeel" ***/
table th#WH_desc { border: solid 0px red; text-align: center }
#WH_ERD	 { fill: none; stroke: #999; }
.WH_svg	 { border: solid 0px gray; display: inline-block; margin: auto; }
.WH_axis { stroke: #999; stroke-width: 1; stroke-dasharray: 3,3; } /*//##### stroke-width*/
.WH_rsh	 { fill: none; stroke: #777; } /*rim spoke holes*/
.WH_hsh	 { fill: none; stroke: #777; } /*hub spoke holes*/
.WH_hsh2 { fill: none; stroke: #ccc; } /*hub spoke holes 2*/
.WH_spoke{ fill: none; stroke: #000; stroke-width: 2; }
.WH_pcd	 { fill: none; stroke: #000; stroke-width: 1; } /*//#####  stroke-dasharray: .5,.5;  */
</style>


<!-------------->
<style>
#CONSOLE { 
	vertical-align:top;
	display: none; 
	XXXXX_float: right;
	font-family: Courier New; 
	font-size: .8em; 
	border: solid 1px gray; 
	max-height: 40rem ;
	XXXXX_SX22.75rem; 
	overflow-y: scroll; 
	word-break: break-all;
	padding: 0 .5em; }
</style>
<!------------------>




<div id=left_side style="display: inline-block; vertical-align: top">

<table class=settings style="display: inline-block; vertical-align:top;">
<tr><th colspan=2 id=WH_desc></th></tr>
<tr><td colspan=2><b>Wheel Settings</b></td></tr>
<tr><th>ERD:</th><td><input id=ERD  class=input type=text value=580></td></tr>
<tr><th>NR: </th><td><input id=NR   class=input type=text value=24 ></td></tr>
<tr>
	<th>NF:</th>
	<td style="min-width: 6.5rem"><!--//##### move style to sheet-->
		<input id=NF1  class=input type=text>
		<input id=NF2  class=input type=text>
	</td>
</tr>
<tr>
	<th>PCD:</th>
	<td>
		<input id=PCD1 class=input type=text>
		<input id=PCD2 class=input type=text>
	</td>
</tr>
<tr>
	<th>FtC:</th>
	<td>
		<input id=FTC1 class=input type=text>
		<input id=FTC2 class=input type=text>
	</td>
</tr>
<tr>
	<th>SX:</th>
	<td>
		<input id=SX1  class=input type=text>
		<input id=SX2  class=input type=text>
	</td>
</tr>
<tr>
	<th>SHD:</th>
	<td><input id=SHD  class=input type=text></td>
</tr>
<tr><td colspan=2>&nbsp;</td></tr>
<tr>
	<th colspan=2>Lace Option:
		<select id=LACE_OPT name=LACE_OPT>
			<option value= 1>1&nbsp;</option>
			<option value=-1>2&nbsp;</option>
		</select>
	</th>
</tr>
</table>


<br><br>


<table class=settings>
<tr><td colspan=3><b>Spoke Options</b></td></tr>
<tr>
	<td>Group</td>
	<td>Color</td>
	<td>Show?</td>
</tr>
<tr>
	<td>1</td>
	<td><input id=COLOR1 class=input type=text></td>
	<td><input id=SHOW1  class=input type=checkbox></td>
</tr>
<tr>
	<td>2</td>
	<td><input id=COLOR2 class=input type=text></td>
	<td><input id=SHOW2  class=input type=checkbox></td>
</tr>
<tr>
	<td>3</td>
	<td><input id=COLOR3 class=input type=text></td>
	<td><input id=SHOW3  class=input type=checkbox></td>
</tr>
<tr>
	<td>4</td>
	<td><input id=COLOR4 class=input type=text></td>
	<td><input id=SHOW4  class=input type=checkbox></td>
</tr>
</table>


<br>


<table class=settings>
<tr><td colspan=3><b>Rim &amp; Flange Options</b></td></tr>
<tr>
	<td></td>
	<td>Color</td>
	<td>Show?</td>
</tr>
<tr>
	<td>Rim</td>
	<td><input id=COLOR_R class=input type=text></td>
	<td><input id=SHOW_R  class=input type=checkbox></td>
</tr>
<tr>
	<td>F1</td>
	<td><input id=COLOR_F1 class=input type=text></td>
	<td><input id=SHOW_F1  class=input type=checkbox></td>
</tr>
<tr>
	<td>F2</td>
	<td><input id=COLOR_F2 class=input type=text></td>
	<td><input id=SHOW_F2  class=input type=checkbox></td>
</tr>
</table>


<br>


<table class=settings>
<tr>
	<td colspan=2>
		<b>Show Axes:</b>
		<input id=AXES  class=input type=checkbox>
	</td>
</tr>
</table>


</div><!--//end left_side -->



<svg id="WH_box" class="WH_svg">
	<title>Wheel</title>
	<g id="WH_axes">
		<line id="WH_x-axis" class="WH_axis"  x1="-305"	y1=   "0"	x2="305"	y2=  "0"/>
		<line id="WH_y-axis" class="WH_axis"  x1=   "0"	y1="-305"	x2=  "0"	y2="305"/>
	</g>

	<g id="WH_wheel">
		<circle id="WH_ERD"  class="WH_erd" r=""/>
		<circle id="WH_PCD1" class="WH_pcd" r=""/>
		<circle id="WH_PCD2" class="WH_pcd" r=""/>
		
		
		<g id=WH_Holes_and_Spokes>
			<g id="WH_rim_holes"></g>
			<g id="WH_flange_1"></g>
			<g id="WH_flange_2"></g>
			<g id="WH_spokes"></g>

			<!---------------------.>
			<g id="WH_spokes_1"></g>
			<g id="WH_spokes_2"></g>
			<g id="WH_spokes_3"></g>
			<g id="WH_spokes_4"></g>
			<!---------------------->
		</g>
	</g><!-- end <svg id=WH_wheel> -->
</svg>

<div id=CONSOLE></div>
</body>
