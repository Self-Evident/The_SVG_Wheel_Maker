<!DOCTYPE html>
<meta charset="utf-8"/>
<link rel='shortcut icon' type='image/ico' href='favicon.ico'>


<!--//===== UPDATE VERSION AND DATE! Output in footer. =====-->
<script>var SLC_VERSION = "v1.11 2018-08-02" //##### </script>
<!--//======================================================-->


<!--============================================================================
The Wheel Maker and Spoke Length Calculator

Copyright Â© 2017-2018 https://github.com/Self-Evident

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
=============================================================================-->



<title>The Wheel Maker &amp; Spoke Length Calculator</title>


<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { overflow-y: scroll; }


/*** The prefix "SLC_" simply means "Spoke Length Calculator" ***/
ul.SLC { padding-left: 1rem; }
p.SLC { margin: .4rem 0; }

.SLC_indents { margin-left: 1.5rem; }

hr.SLC {margin: .5rem 0; }

a.SLC { outline: 0; text-decoration: none; display: inline-block; background-color: #EEE }

a.SLC:focus, a.SLC:hover { background-color: #ccc; text-decoration: none; }

button.SLC        { border: solid 1px #444; padding: 0 5px 2px 4px ; background: linear-gradient(to bottom, #CCC, #FFF, #FFF, #CCC); }
button.SLC:focus  { background: linear-gradient(to bottom, #CCC, #FFF, #FFF, #CCC); }
button.SLC:hover  { background: linear-gradient(to bottom, #eee, #FFF, #FFF, #eee); }
button.SLC:active { background: linear-gradient(to bottom, #EEE, #ddd, #ddd, #EEE); padding: 0px 6px 1px 3px; }


button.SLC::-moz-focus-inner { border: 0 }

input.SLC:focus, select.SLC:focus, button.SLC:focus { box-shadow: 0 0 3pt 1pt #006060 }
input[type=text].SLC   { width: 3.3rem; text-align: center; font: 1rem courier; }

input[type=checkbox]:hover { box-shadow: 0 0 0pt 1pt black; }

input[readonly].SLC {
	border: solid .10rem #077;
	border-radius: 4px;
	background-color: rgba(255,255,255, .8);
}

input[disabled].SLC, select.SLC:disabled {
	color			: #555;
	background-color: rgba(255,255,255, .4);
	border: solid 1px #7a7a7a;
}
select.SLC { padding: 0 0 0 .3rem; width: 3.3rem; font-size: .9rem; height: 1.3rem; border: solid 1px #7a7a7a; }
select.SLC option { padding-left: .5rem }

select.SLC:hover { border-color: black; }

/* Removes that annoying dotted onfocus outline of FF selects */
select.SLC:-moz-focusring {
	color: transparent;
	text-shadow: 0 0 0 #000;
}

.SLC_imex_mode { background-color: #DDD }

#SLC_CONTAINER {
	position: relative;
	border: 0;
	margin: auto;
	text-align: center;
	padding: 1rem 0 0 0;
	visibility: hidden;  /* visibility & opacity changed at end of onload. */
	opacity: 0;
	/* //##### transition: opacity .5s; #############*/
	display: block;
}


.SLC_imex_containers { position: absolute;
	top: 3rem;
	border: solid 1px teal;
	box-shadow: 0 0 10pt 4pt teal;
	background-color: white;
	display: none;
	margin: 0 0 0 1rem;
	padding: .5rem;
	min-width: 200px;
	max-width: 700px;
	
	text-align: left;
	z-index : 999;
	font-family: arial;
}

.SLC_inexport_btns { font-size: 1rem; padding: .2rem 1rem; border-radius: 6px; }

.SLC_IMEX_DATA { border: solid 1px black; padding: .3rem; margin-top: .5rem; font-family: courier; word-break: break-all;}

#SLC_EXPORT_OUTPUT { }

#SLC_IMPORT_INPUT  {
	width: 100%;
	height: 40rem;
	overflow: auto;
}



#SLC_The_SVG    { width: 630px; display: inline-block; border: 0; }

#SLC_svg_wheel  { border: solid 1px #AAA; border-radius: 8px; }

#SLC_WHEEL_TYPE { margin: 0 0 .5rem .2rem; padding-left: .1rem; width: 8rem; }
#SLC_ph_container {}

.SLC_theta { display: inline-block; width: .5rem; }

.SLC_phha { margin: 0 0 0 0; width: 2.8rem; } /** paired hole hub angle **/

#SLC_HUB_AUTO_ANGLES { padding: 0; width: 5.3rem; }

#SLC_LACE_OPT   { margin: .5rem 0 .5rem 0; }

#SLC_left_side  {
	display: inline-block;
	vertical-align: top;
	position: relative;
	border: 0;
	max-width: 16rem;
}

#SLC_WHEEL_SELECT_OPTS td { text-align: right; padding-right: .5rem; }

#SLC_rename_box {
	position: relative;
	display: inline-block;
	margin: 2px 0 0 0;
	padding: 0;
}
#SLC_CURRENT_WHEEL {
	width  : 11.5rem;
	margin : 0;
	padding: 0;
	font-family: arial;
}
#SLC_CURRENT_WHEEL option { text-align: left; padding-left: .2rem;}
#SLC_WHEEL_NAME {
	position: absolute;
	top     : 1px;
	left    : 2.15rem;
	margin  : 0;
	padding : 0 0 0 .05rem;
	width   : 9.3rem;
	height  : 1.32em;
	border     : solid 1px transparent;
	text-align : left;
	font-size  : .9rem;
	font-family: arial;  /** set to same as CURRENT_WHEEL. **/
	visibility : hidden; /** visible during rename only **/
}


#SLC_auto_copy_div { font-size: .9rem; padding-bottom: .4rem; }
#SLC_auto_copy_div input { width: 1rem; margin: 0 .5rem; }

table.SLC {
	display: inline-table;
	width: 16rem;
	font-family: arial;
	text-align: center;
	border			: solid 1px #444;
	border-collapse	: separate;
	border-radius	: 8px;
	border-spacing	: 3px;
	background-color: rgb(175,198,205);  /** #ccc; **/
	vertical-align: top;
	margin: 0 0 1rem 0;
}

table.SLC td { padding: 0 0 0 0; border: 0; }
table.SLC th { height: 2.2rem; font-size: 1.1rem; border-bottom: solid 2px #333}

table.SLC .SLC_thv { text-align: right; padding: 0 0 0 3px; width: 6.8rem; font-weight: bold; }
table.SLC .SLC_color { width: 6rem; }



.SLC_wheel_btns { text-align: right; }

.SLC_load_clear { margin: 0; padding: 0 .2rem; border-radius: 4px; }

.SLC_separator { padding: 0; height: .3rem; }

.SLC_containers { display: inline-block; vertical-align: top; margin: 0 .5rem; }

#SLC_display_options  { display: none; vertical-align: top; border: 0; } 

table.SLC_DO { height: 19rem; }


#SLC_SCALE_MODE  { padding: 0 .3em 0 .2rem; width: 5rem; }

#SLC_scale_options {
	margin: 0 0 .25rem 0;
	padding: .2rem; 0;
	font-family: arial;
	text-align: center;
	border			: solid 1px #444;
	border-collapse	: separate;
	border-radius	: 8px;
	border-spacing	: 3px;
	background-color: rgb(175,198,205);  /** #ccc; **/
	vertical-align: top;
}

#SLC_show_hide_notes { margin: 0 0 0 0; }

#SLC_notes p { margin-top: .5rem; }

#SLC_notes  {
	vertical-align: top;
	border: solid 0px black;
	font-family: arial;
	text-align: left;
	display: none;
	padding: 0 0 0 0;
}

#SLC_adv_hdr { border-bottom: solid 2px #333; }
#SLC_adv_r1c1 { width: 8rem }
#SLC_adv_r1c2 { }
#SLC_adv_r1c2 { }

#SLC_see_notes { border-radius: 5px; }

#SLC_notes td { padding: .2rem .2rem .2rem .5rem; border: solid 1px #555; }
#SLC_notes th { padding: .2rem .5rem .2rem .2rem; border: solid 1px #555; }
#SLC_notes th.SLC_th1 { font-size: 1.2rem; text-decoration: none; }
#SLC_notes th.SLC { width: 9rem; }

.SLC_list_option_in_text  { display: inline-block; width: 5rem; border: solid 1px gray; margin-bottom: 1px; padding: 1px .2rem 0 .2rem; }
.SLC_list_option_in_text2 { display: inline-block; width: 3rem; border: solid 1px gray; margin-bottom: 1px; padding: 1px .2rem 0 .2rem; }

.SLC_ndo_buttons {
	display: block;
	min-width: 11rem;
	width: 100%;
	height: 2rem;
	margin: .3rem auto .3rem auto;
	padding: 3px .5rem;
	text-align: center;
	font: normal 1.2rem arial;
	border-radius: 8px;
}


.SLC_reset_options {
	font-size: .8rem;
	padding: 0 .2rem;
	float: right;
	margin: 0 0 .2rem -2rem;
}


#SLC_rim	 { fill: none; stroke: #999; }
.SLC_svg	 { display: inline-block; margin: auto; border: 0; }
.SLC_axis { stroke: #999; stroke-width: 1; stroke-dasharray: 3,3; }
.SLC_rsh	 { fill: #000; stroke: #777; stroke-width: 0; } /*rim spoke holes*/
.SLC_hsh	 { fill: #000; stroke: #777; stroke-width: 0; } /*hub spoke holes 1 */
.SLC_hsh2 { fill: #000; stroke: #ccc; stroke-width: 0; } /*hub spoke holes 2 */
.SLC_spoke{ fill: none; stroke: #000; stroke-width: 2; }
.SLC_pcd	 { fill: none; stroke: #000; stroke-width: 1; }

.SLC_desc { font-siZe: .8rem }
.SLC_th1	 { height: 1.0rem; text-decoration: underline; font-weight: bold; }
.SLC_th2	 { height: 1.8rem; text-decoration: underline; }

table.SLC .SLC_th3 th{ height: 1.5rem; font-size: 1rem; border: 0; vertical-align: bottom; }


table.SLC td.SLC_SL { height: 2rem; }
table.SLC td.SLC_SL input { 
	width: 5rem;
	text-align: center;
	font-size: 1rem;
	font-weight: bold;
	margin: 0;
}

table.SLC td.SLC_SLS1 { padding: 0 0 0 1.5rem; height: .8rem; }
table.SLC td.SLC_SLS2 { padding: 0 1.5rem 0 0; height: .8rem; }

table.SLC tr.SLC_SLH2 { height: 1.5rem; vertical-align: bottom }

#SLC_SL_2_4 { display: none; } /**Set to table-row in Setup_Wheel() when needed.**/

table#SLC_advanced_info.SLC { border-spacing: 2px; display: inline-block; }
#SLC_advanced_info td { font-size: .9rem; text-align: left; padding-left: .2rem; }

select.SLC_elbows_laced { padding-left: 0px; font-size: .9rem; width: 4.1rem; }

#SLC_advanced_info .lesser_settings td 	   { font-size: .8em; padding-left: .5rem; }
#SLC_advanced_info .lesser_settings td input { width: 2rem; font-size: .9rem; }

#SLC_assumes { font-weight: bold }

#SLC_other_calcs   { font-family: arial; text-align: left; display: none; }
#SLC_other_calcs a { min-width: 55%; border-bottom: solid 2px white; }

#SLC_MSG_HEADER {
	margin			: auto;
	text-align		: center;
	font-weight		: bold;
	text-decoration : underline;
}

#SLC_msg_box {
	vertical-align: top;
	width: 18rem;
	position: absolute;
	top		: 6rem;
	left	: 2rem;
	z-index : 999;
	border	: solid 1px red;
	border-radius	: 5px;
	padding			: .5rem .5rem .5rem .5rem; 
	background-color: white;
	font-family		: arial;
	text-align		: center;
	visibility		: hidden;  /** toggled in Error_Notice() **/
	max-height: 30rem;
	overflow-y: auto;
	box-shadow: 0 0 10pt 3pt red;
}


#SLC_close_msg {
	height	: 1.3rem;
	width	: 1.5rem;
	float: right;
	margin: -.5rem -.5rem .5rem .5rem;
	padding	: 2px 0 3px 0 ;
	text-align	: center;
	font		: normal .9rem arial;
	border			: solid 1px #444;
	border-radius	: 3px;
	background-color: #F9F9F9;
}


#SLC_ACCEPT_MSG { font-size: 1.2rem; margin: 1rem 0; padding: 2px; }

#SLC_DELETE_ALL_DATA {  }

</style>







<!--#########################################################################-->
<style>#CONSOLE { vertical-align:top; font-family: Courier New; font-size: .8em; border: solid 1px red; max-height: 55rem ; max-width: 54em; overflow: scroll; word-break: break-all; padding: 0 .1em; color: yellow; background-color: black; position: fixed; top: 0; right: 0; z-index: 999; }</style>
<div id=CONSOLE></div>
<script>
function Log(something, br, esc, nowrap, maxwidth) {
	var console = document.getElementById('CONSOLE');
	var height = window.innerHeight + "px";
	console.style['max-height'] = height;
	if (typeof something === 'undefined') { console.innerHTML = ""; console.style['display'] = "none"; return; }
	if (br == true) { br = "<br>" } else { br = "" }
	if (esc) {
		var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
		something = (something + "").replace(/[&<>"']/g, function(m) { return map[m]; });
	}
	if (nowrap) {document.getElementById('CONSOLE').style.whiteSpace = "nowrap";}
	if (maxwidth) {document.getElementById('CONSOLE').style['max-width'] = maxwidth;}
	console.innerHTML += something + br;
	console.scrollTop = console.scrollHeight;
	console.style['display'] = "inline-block";
}//end Log()
Log(); //Hide it until it's used...
</script>
<!--#########################################################################-->








<div id=SLC_CONTAINER><!--====================================================-->

<div id=SLC_IMPORT_container class=SLC_imex_containers>
	<p>Copy/Paste your previously saved data to the area below.
	<p>Then click</p>
	<button id=SLC_perform_import class="SLC SLC_inexport_btns">Import Data</button>
	<button id=SLC_close_import   class="SLC SLC_inexport_btns">Return to Wheel</button>
	<textarea id=SLC_IMPORT_INPUT class="SLC SLC_IMEX_DATA"></textarea>
</div>

<div id=SLC_EXPORT_container class=SLC_imex_containers>
	<p>Copy and paste the text below into a blank text file in your favorite text editor.
	   Do not edit the data unless you <i>really</i> know what you're doing!</p>
	<button id=SLC_copy_to_clipboard class=SLC_inexport_btns>Copy to Clipboard</button>
	<button id=SLC_close_export      class=SLC_inexport_btns>Return to Wheel</button>
	<div id=SLC_EXPORT_OUTPUT class=SLC_IMEX_DATA></div>
</div>

<div id=SLC_left_side><!--==========================================-->

<div id=SLC_msg_box>
	<button id=SLC_close_msg class=SLC>X</button>
	<div id=SLC_message><br></div>
	<button id=SLC_ACCEPT_MSG class=SLC>I Accept</button>
</div>

<table class=SLC id=SLC_settings>
<tr><th colspan=2>Wheel Settings</th></tr>

<tr id=SLC_WHEEL_SELECT_OPTS>
	<td colspan=2><b>Wheel</b>
		<div id=SLC_rename_box>
			<select id=SLC_CURRENT_WHEEL class=SLC><!-- Populated onload --></select><br>
			<input id=SLC_WHEEL_NAME type=text class=SLC value="" tabindex=-1>
		</div>
	</td>
</tr>

<tr><td colspan=2 class=SLC_wheel_btns>
		<div id=SLC_auto_copy_div>Auto-Copy<input id=SLC_auto_copy class=SLC type=checkbox></div>
		<button type=button id=SLC_rename_wheel   class="SLC SLC_load_clear">Rename</button>
		<button type=button id=SLC_load_samples   class="SLC SLC_load_clear">Load Sample</button> 
		<button type=button id=SLC_clear_settings class="SLC SLC_load_clear">Clear</button>
		<hr class=SLC>
</td></tr>

<tr>
	<td colspan=2><b>Type</b>
		<select id=SLC_WHEEL_TYPE class=SLC>
			<option value="standard">Standard</option>
			<option value="triplet" >Triplet</option>
			<!-- //##### option value="phh"     >Paired Hole Hub</option -->
			<!-- //##### option value="ppr"     >Paired Hole Rim</option -->
			<!-- //##### option value="pprh"    >Paired Hole Rim & Hub</option -->
			<option value="custom"  >Custom</option>
		</select>
	</td>
</tr>






<tbody id=SLC_ph_container>
<tr>
	<td colspan=2>
		Paired Holes: &nbsp; <label class=SLC><input id=SLC_PH_HUB class=SLC type=checkbox>Hub</label> &nbsp;
		<!--//##### prototype - no other code yet. Maybe someday...########################################-->
		<label class=SLC style="color:#999"><input id=SLC_PH_RIM class=SLC type=checkbox disabled>Rim</label>
	</td>
</tr>
<tr class=SLC_phh_options>
	<td colspan=2>Hub Auto-Angles
		<select id=SLC_HUB_AUTO_ANGLES class=SLC>
			<option value="half">1/2 Even</option>
			<option value="off">Off</option>
			<option value="even">Even</option>
		</select>
	</td>
</tr>
<tr class=SLC_phh_options>
	<td>PHH Angles</td>
	<td>
		<input id=SLC_PHHA1 class="SLC SLC_phha" type=text maxlength=5         ><span class=SLC_theta>&deg;</span>
		<input id=SLC_PHHA2 class="SLC SLC_phha" type=text maxlength=5 disabled><span class=SLC_theta>&deg;</span>
	</td>
</tr>
<tr class=SLC_phh_options style="display: none">
	<td>PHH Distances</td>
	<td>
		<input id=SLC_PHHD1 class="SLC SLC_phha" type=text maxlength=5         ><span class=SLC_theta></span>
		<input id=SLC_PHHD2 class="SLC SLC_phha" type=text maxlength=5 disabled><span class=SLC_theta></span>
	</td>
</tr>
</tbody>
<tr><td colspan=2><hr class=SLC></td></tr>






<tr><td class=SLC_thv>ERD</td><td><input id=SLC_ERD class=SLC type=text maxlength=5></td></tr>

<tr><td class=SLC_thv>Rim Holes</td>
	<td><select id=SLC_NR class=SLC><!-- <option>s added at runtime. --></select></td>
</tr>

<tr><td></td><td>Side 1 &nbsp;Side 2</td></tr>
<tr>
	<td class=SLC_thv>Flange Holes</td>
	<td><input id=SLC_NF1 class=SLC type=text maxlength=2> <input id=SLC_NF2 class=SLC type=text maxlength=2></td>
</tr>
<tr>
	<td class=SLC_thv>PCD</td>
	<td><input id=SLC_PCD1 class=SLC type=text maxlength=5> <input id=SLC_PCD2 class=SLC type=text maxlength=5></td>
</tr>
<tr>
	<td class=SLC_thv>Flange Offset</td>
	<td><input id=SLC_FTC1 class=SLC type=text maxlength=5> <input id=SLC_FTC2 class=SLC type=text maxlength=5></td>
</tr>
<tr>
	<td class=SLC_thv>OC Rim</td>
	<td><input id=SLC_OSB1 class=SLC type=text maxlength=4> <input id=SLC_OSB2 class=SLC type=text maxlength=4></td>
</tr>
<tr>
	<td class=SLC_thv>Cross</td><!-- <option>s added at runtime. -->
	<td><select id=SLC_SX1 class=SLC></select> <select id=SLC_SX2 class=SLC></select></td>
</tr>
<tr>
	<td class=SLC_thv>SHD</td>
	<td><input id=SLC_SHD class=SLC type=text maxlength=4></td>
</tr>

<tr>
	<td class=SLC_thv>Lace Option:</td>
	<td>
		<select id=SLC_LACE_OPT class=SLC>
			<option value="-1">2&nbsp;</option>
			<option value=" 1" selected>1&nbsp;</option>
		</select>
	</td>
</tr>
</table><!--//end Wheel Settings -->



<table class=SLC id=SLC_spoke_lengths>
	<tr><th colspan=2>Spoke Lengths</th></tr>
	<tr class=SLC_SLH2>
		<td class=SLC_SLS1>Side 1</td>
		<td class=SLC_SLS2>Side 2</td>
	</tr>

	<tr>
		<td  class="SLC_SL SLC_SLS1"><input id=SLC_LENGTH1 class=SLC type=text readonly tabindex="-1"></td>
		<td  class="SLC_SL SLC_SLS2"><input id=SLC_LENGTH3 class=SLC type=text readonly tabindex="-1"></td>
	</tr>

	<tr id=SLC_SL_2_4>
		<td  class="SLC_SL SLC_SLS1"><input id=SLC_LENGTH2 class=SLC type=text readonly tabindex="-1"></td>
		<td  class="SLC_SL SLC_SLS2"><input id=SLC_LENGTH4 class=SLC type=text readonly tabindex="-1"></td>
	</tr>
	
	<tr class=SLC_separator><td colspan=2></td></tr>
</table>




<button type=button id=SLC_show_hide_advanced class="SLC SLC_ndo_buttons" value=none>Advanced Build Info</button>
<table class=SLC id=SLC_advanced_info>
	<tbody id=SLC_adv_info_tbody>
	<tr><td id=SLC_adv_r1c1></td><td id=SLC_adv_r1c2></td><td id=SLC_adv_r1c3></td></tr>
	<tr class=SLC_separator><td colspan=3 id=SLC_adv_hdr>
		(This section does not directly affect the "Spoke Lengths" provided above.
		See <button type=button id=SLC_see_notes class="SLC">Notes etc.</button>
		for more information.)
	</td></tr>
	<tr class=lesser_settings><td colspan=2>Flange width at spoke holes:</td><td><input id=SLC_FW  class="SLC" type=text maxlength=4></td></tr>
	<tr class=lesser_settings><td colspan=2>Spoke diameter at bend:     </td><td><input id=SLC_SDB class="SLC" type=text maxlength=4></td></tr>

	<tr class=SLC_separator><td colspan=3></td></tr>
	<tr><td></td><td>&nbsp; Side 1</td><td>&nbsp; Side 2</td></tr>
	<tr>
		<td>Elbows Laced</td>
		<td>
			<select id=SLC_ELBOWS1 class="SLC SLC_elbows_laced">
				<option value="-1">In</option>
				<option value="0" >Center</option>
				<option value="1" >Out</option>
			</select>
		</td>
		<td>
			<select id=SLC_ELBOWS2 class="SLC SLC_elbows_laced">
				<option value="-1">In</option>
				<option value="0" >Center</option>
				<option value="1" >Out</option>
			</select>
		</td>
	</tr>

	<tr class=SLC_separator><td colspan=3></td></tr>
	<tr>
		<td>Length Adjust.</td>
		<td><input id=SLC_SL_ADJ1 class=SLC type=text readonly tabindex="-1"></td>
		<td><input id=SLC_SL_ADJ2 class=SLC type=text readonly tabindex="-1"></td>
	</tr>
	<tr>
		<td>Spoke Ratio</td>
		<td><input id=SLC_spoke_ratio1 class=SLC type=text readonly tabindex="-1"></td>
		<td><input id=SLC_spoke_ratio2 class=SLC type=text readonly tabindex="-1"></td>
	</tr>
	<tr>
		<td>Bracing Angles</td>
		<td><input id=SLC_brace_angle1 class=SLC type=text readonly tabindex="-1">&deg;</td>
		<td><input id=SLC_brace_angle2 class=SLC type=text readonly tabindex="-1">&deg;</td>
	</tr>
	<tr>
		<td>Tension Ratio</td>
		<td><input id=SLC_tension_ratio1 class=SLC type=text readonly tabindex="-1">%</td>
		<td><input id=SLC_tension_ratio2 class=SLC type=text readonly tabindex="-1">%</td>
	</tr>
	<tr>
		<td>Tension</td>
		<td><input id=SLC_TENSION1 class=SLC type=text readonly tabindex="-1"></td>
		<td><input id=SLC_TENSION2 class=SLC type=text></td>
	</tr>
	<tr class=SLC_separator><td colspan=3></td></tr>
	</tbody>
</table>


	<br>
	<button type=button id=SLC_show_hide_other class="SLC SLC_ndo_buttons" value="none">A few other calculators</button>
	<div id=SLC_other_calcs>
		Ancesters to The Wheel Builder:<br>
		<a id=a1 class=SLC href="D-SC.1.html">D-SC 1</a><br>
		<a id=a2 class=SLC href="D-SC.3.html">D-SC 3</a><br>
		<br>
		<hr class=SLC>
		And a few other spoke length calculators from around the web:<br>
		<p class="SLC SLC_desc">(I have no affiliation with the following calculators or websites.
		Their links are provided for convenience and comparison only.)</p>
		
		<a class=SLC href="https://www.sheldonbrown.com/rinard/spocalc.htm" target="_blank">Sheldon's SpoCalc</a><br>
		<a class=SLC href="http://www.mrrabbit.net/wheelsbyflemingapplications.php" target="_blank">Mr. Rabbit's SpokeChart v2-0<br><span class=SLC_indents>(link near bottom of page)</span></a><br>
		<a class=SLC href="https://www.bikeschool.com/index.php/resources/spoke-calculator" target="_blank">Bike School</a><br>
		<a class=SLC href="http://www.prowheelbuilder.com/spokelengthcalculator" target="_blank">Pro Wheel Builder</a><br>
		<a class=SLC href="https://leonard.io/edd/" target="_blank">Edd</a><br>
		<a class=SLC href="http://www.sapim.be/spoke-calculator" target="_blank">Sapim</a><br>
		<a class=SLC href="https://spokes-calculator.dtswiss.com/en/" target="_blank">DT Swiss</a><br>
		<a class=SLC href="http://www.wheelpro.co.uk/spokecalc/" target="_blank">Wheel Pro</a><br>
		<a class=SLC href="https://biketechtools.com/spoke-length-calculator" target="_blank">Bike Tech Tools</a><br>
		<a class=SLC href="http://www.kstoerz.com/freespoke/fullcalc" target="_blank">FreeSpoke</a><br>
	</div>

</div><!--//end SLC_left_side ======================================-->





<div id=SLC_The_SVG><!-- and Dispaly Options =======================-->
	<svg id="SLC_svg_wheel" class="SLC_svg" width="100%" height="100%">
		<title>Wheel</title>
		<g id="SLC_axes">
			<line id="SLC_x-axis" class="SLC_axis"/>
			<line id="SLC_y-axis" class="SLC_axis"/>
		</g>
		
		<g id="SLC_wheel">
			<circle id="SLC_rim"	r=""/>
			<circle id="SLC_flange1" class="SLC_pcd" r=""/>
			<circle id="SLC_flange2" class="SLC_pcd" r=""/>
			
			<g id=SLC_Holes_and_Spokes>
				<g id="SLC_rim_holes"></g>
				<g id="SLC_holes_f1"></g>
				<g id="SLC_holes_f2"></g>
				<g id="SLC_spokes"></g>
			</g>
		</g><!--//end id=SLC_wheel -->
	</svg>



	<div class=SLC_containers><!-- Display Options button & tables -->
		
		<button type=button id=SLC_show_hide_DO class="SLC SLC_ndo_buttons" value=none>Display Options</button>
		
		<div id=SLC_display_options>
			
			<div id=SLC_scale_options class=SLC>
				Scale:
				<select id=SLC_SCALE_MODE class=SLC>
					<option value="auto">auto</option>
					<option value="fixed">fixed</option>
				</select>
				<input id=SLC_SCALE_auto class=SLC type=text disabled value=TEST>
				<input id=SLC_SCALE_fixed class=SLC type=text>
				<button type=button id=SLC_reset_scale class="SLC">Reset</button>
			</div>
			
			<table class="SLC SLC_DO">
				<tr>
					<th colspan=4>Spokes
						<button type=button id=SLC_reset_options_spokes class="SLC SLC_reset_options">Reset</button>
					</th>
				</tr>
				<tr class=SLC_th3><th></th><th>Line</th><th>Line</th><th></th></tr>
				<tr class=SLC_th1><td>Group</td><td>Color</td><td>Size</td><td>Show?</td></tr>
				<tr class=SLC_th2>
					<td></td>
					<td colspan=2>Side 1</td>
					<td><input id=SLC_SHOW_SIDE1 class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>1</td>
					<td><input id=SLC_SPOKE_COLOR1 class="SLC SLC_color" type=text></td>
					<td><input id=SLC_SPOKE_LINE_SIZE1 class=SLC type=text></td>
					<td><input id=SLC_SPOKE_SHOW1 class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>2</td>
					<td><input id=SLC_SPOKE_COLOR2 class="SLC SLC_color" type=text></td>
					<td><input id=SLC_SPOKE_LINE_SIZE2 class=SLC type=text></td>
					<td><input id=SLC_SPOKE_SHOW2  class=SLC type=checkbox></td>
				</tr>
				<tr class=SLC_separator><td colspan=4></td></tr>
				<tr class=SLC_th2>
					<td></td>
					<td colspan=2>Side 2</td>
					<td><input id=SLC_SHOW_SIDE2 class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>3</td>
					<td><input id=SLC_SPOKE_COLOR3 class="SLC SLC_color" type=text></td>
					<td><input id=SLC_SPOKE_LINE_SIZE3 class=SLC type=text></td>
					<td><input id=SLC_SPOKE_SHOW3 class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>4</td>
					<td><input id=SLC_SPOKE_COLOR4 class="SLC SLC_color" type=text></td>
					<td><input id=SLC_SPOKE_LINE_SIZE4 class=SLC type=text></td>
					<td><input id=SLC_SPOKE_SHOW4 class=SLC type=checkbox></td>
				</tr>
				<tr class=SLC_separator><td colspan=4>&nbsp;</td></tr>
			</table>
			
			<table class="SLC SLC_DO">
				<tr>
					<th colspan=4>
						Rim, Flange &amp; Axes
						<button type=button id=SLC_reset_options_rim_etc class="SLC SLC_reset_options">Reset</button>
					</th>
				</tr>
				<tr class=SLC_th3><th></th><th>Line</th><th>Line</th><th></th></tr>
				<tr class=SLC_th1><td></td><td>Color</td><td>Size</td><td>Show?</td></tr>
				<tr>
					<td>Rim</td>
					<td><input id=SLC_RIM_COLOR class="SLC SLC_color" type=text></td>
					<td><input id=SLC_RIM_LINE_SIZE  class=SLC type=text></td>
					<td><input id=SLC_RIM_SHOW  class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>F1</td>
					<td><input id=SLC_F1_COLOR class="SLC SLC_color" type=text></td>
					<td><input id=SLC_F1_LINE_SIZE  class=SLC type=text></td>
					<td><input id=SLC_F1_SHOW  class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>F2</td>
					<td><input id=SLC_F2_COLOR class="SLC SLC_color" type=text></td>
					<td><input id=SLC_F2_LINE_SIZE  class=SLC type=text></td>
					<td><input id=SLC_F2_SHOW  class=SLC type=checkbox></td>
				</tr>
				<tr>
					<td>Spoke Holes</td>
					<td><input id=SLC_HOLE_COLOR class="SLC SLC_color" type=text></td>
					<td></td>
					<td><input id=SLC_HOLES_SHOW class=SLC type=checkbox></td>
				</tr>
				<tr><td colspan=4>Spoke Hole Diameter <input id=SLC_HOLE_SIZE class=SLC type=text></td></tr>
				<tr><td colspan=4 class=SLC_desc>(Affects displayed size only.)</td></tr>
				<tr class=SLC_separator><td colspan=4></td></tr>
				<tr>
					<td>Axes</td>
					<td><input id=SLC_AXES_COLOR class="SLC SLC_color" type=text></td>
					<td><input id=SLC_AXES_LINE_SIZE  class=SLC type=text></td>
					<td><input id=SLC_AXES_SHOW  class=SLC type=checkbox></td>
				</tr>
				<tr class=SLC_separator><td colspan=4></td></tr>
			</table>
			<br>
		</div><!--//end Display Options ==============-->
	</div><!--//end Display Options <button> & <table>s & <reset>-->
</div><!--//end SLC_The_SVG ========================================-->
<br><br>




	<div class=SLC_containers><!-- Notes button & table -->
		<button type=button id=SLC_show_hide_notes class="SLC SLC_ndo_buttons" value=none>Notes etc.</button>
		<table id=SLC_notes>
			<tr><th class=SLC>Disclaimer</th>
				<td>
					<div id=SLC_responsibility>
						<p id=SLC_assumes class=SLC>In all cases, the user assumes full responsibility for the use of any spoke length, image, or other output of this program.
					</div>
					<div>
						<p class=SLC>Like every spoke length calculator, this is a simple utility, and can not determine the validity of every possible combination of rim and hub values.
						<p class=SLC>That is, just because the program many generate a theoretical wheel on screen from a given set of inputs, does not guarantee that such a wheel is realistically practical, or even possible. Or even that all required spokes lengths are listed.  The preceding will more likely become evident in Custom mode, as it has fewer restrictions on rim &amp; hub values than Standard &amp; Triplet modes.  And while it will may often be obvious when values produce an unrealistic wheel, again, there are no guarantees.
						<p class=SLC>For additional information, please refer to geometry. And physics.
					</div>
				</td>
			</tr>
			
			<tr><th class=SLC>Misc</th>
				<td><p>All wheels with saved settings are marked with two colons (" :: ") after the the wheel number in the Wheel select list.
					<p>Wheels don't have to be named.  That is, you can click [Rename] and delete the name, except for the " :: " indicator.
				</td>
			</tr>
			
			<tr><th class=SLC>Auto-Copy</th>
				<td>
					<p>The values for the current wheel can be copied to a blank wheel (one that has no settings):
					<ul class=SLC>
						<li>Select the wheel to copy.
						<li>Make sure Auto-Copy is checked.
						<li>Select a blank wheel (no "::" after the number) from the Wheel select list.
					</ul>
					<p>To prevent Auto-Copy, make sure the option is unckecked.
				</tD>
			</tr>

			<tr><th class=SLC></th>
				<th>Wheel Settings
					<p>All measurement settings are mm (millimeters), except those that aren't (like angles).
				</th>
			</tr>

			<tr><th class=SLC>Paird Holes</th>
				<td>
					<p>Available only with Standard &amp; Custom Wheel Types.
					<p>With <span class=SLC_list_option_in_text>Standard</span> wheels, and Paired Holes Hub selected, hole angles and spoke cross for Side 2 are automatically set to the same value as Side 1.
					<p>With <span class=SLC_list_option_in_text>Triplet</span> wheels, Paired Hole options are not available.
					<p>With <span class=SLC_list_option_in_text>Custom</span> wheels, and Paired Holes Hub selected, hole angles and spoke cross for Side 1 and Side 2 are user selectable and independent of one another.
				</td>
			</tr>

			<tr><th class=SLC>Hub Auto-Angles</th>
				<td><p>Determines if potiential angles between paired-holes are automatically calculated &amp; displayed in PHH Angles fields (<u>P</u>aired <u>H</u>ole <u>H</u>ub) with changes to the number of Flange Holes.
				
					<ul class=SLC>
						<li><span class=SLC_list_option_in_text>Even</span> The calculated values are the "normal" non-paired-hole angles for the specified hole counts, with even spacing of the holes around the flange.
						<li><span class=SLC_list_option_in_text>1/2 Even</span> The calculated values are one half of the the "normal" angles for the specified hole counts.
						<li><span class=SLC_list_option_in_text>Off</span> Angles are user provided, and are not automatically calculated.
					</ul>
				</td>
			</tr>

			<tr><th class=SLC>ERD</th>
				<td>The "<b>E</b> ffective <b>R</b> im <b>D</b> iameter".<br>
					<p>A picture could say a thousand words, but Google says a lot more...
					<p>Note that when the Display Option "Scale" is set to <span class=SLC_list_option_in_text2>auto</span>, the displayed wheel (and all componants) automatically resize based on this value. Subsequently, the displayed diameter will remain the same (fill the wheel box), but the hub, spokes, etc, will scale accordingly.
				</td>
			</tr>
			
			<tr><th class=SLC>Rim Holes</th><td>Number of spoke holes in the Rim. Most of the time, this will be the same as the number of spokes.</td></tr>
			
			<tr><th class=SLC>Flange Holes</th><td>
				Number of spoke holes in the Flange. Normally, the number of holes in each hub flange is 1/2 of the number of holes in the rim, and 1/2 the spoke count. One notable exception is a triplet laced wheel.  Additionally, if the number of flange holes is odd (not even), the spoke cross for that side must be, and is automatically set to, zero.
				<p>Note that the number of holes for Side 1 must be less than or equal to Side 2. This is due to some unsolved programming hangup that I can't solve. 
			</td></tr>
			
			<tr><th class=SLC>PCD</th><td>"Pitch Circle Diameter" - diameter of circle running thru the spoke hole centers in the flange. Also referred to as the hub or flange diameter.</td></tr>
			
			<tr><th class=SLC>Flange Offset</th><td> The distance the flange is offset from the hub center.  Also referred to as "Flange to Center", or "Center to Flange", etc.  It is used in the spoke length calculation, but does't affect the displayed image of the wheel.
				<p>Since it's highly impractical to actually measure anything from the hub center (since it's never marked), to obtain these values, measure from the locknut to the flange, and then subtract that value from 1/2 the hub length (the "OLD", or "over locknut distance").
				<p>For example, common road hubs have an "OLD" of 130mm.  Half of that is 65mm.  So, if the distance from the left (or Side 1) locknut to the left flange center is 27.5mm, then the Side 1 Flange Offset is (65 - 27.5), or 37.5mm .
			</td></tr>
			
			<tr><th class=SLC>OC</th>
				<td>"Off-Center" - May also be referred to as "OSB", "Offset Spoke bed", "asymetrical", or similar terms.
					<p>The spoke holes in the rim are "off-center", or "off-set", to one side.
					<p>Useage: Enter a (-)negative number for the side that the holes are closer to (spokes will be a tiny bit shorter); and enter a (+)positive number for the side that the holes are further from (spoke will be a tiny bit longer).
					<p>For example, on a rear wheel rim with a 3mm offset, enter -3 for "Side 1" (the left/non-drive side), and 3 for "Side 2" (the right/drive side).
					<p>As with Flange Offset, it does not affect the displayed wheel.
				</td>
			</tr>
			<tr><th class=SLC>Cross</th>
				<td>"Spoke Cross" value.  Number of spokes each spoke crosses on the same side of wheel.
					<p>In Standard and Triplet modes, spoke crossings are automatically set to common values for a given rim hole count, but can be changed if desired.  Additionally, the cross must be zero if the number of holes in the flange is odd (not even).
					<p>In Custom mode, if the number of flange holes is odd, cross can be non-zero, but all spokes on that side will be laced the same direction.  Spokes on the opposite flange will be laced in the opposite direction if they are also odd, otherwise they will be laced normally.
				</td>
			</tr>
			<tr><th class=SLC>SHD</th><td>"Spoke Hole Diameter". Like Flange Offset &amp; OC, this value only affects final spoke length, and not the wheel as displayed.</td></tr>
			<tr><th class=SLC>Lace Option</th><td>Asymetrical lacings, such as triplets and skip-hole, can generally produce two possible patterns (and spoke lengths).  The two patterns depend on which direction Spoke 1 is laced in relation to Hole 0.  Just try it &amp; see.</td></tr>
			
			<tr><th class=SLC id=SLC_advanced_notes></th>
				<th><p>Advanced Build Info</th>
			</tr>
			
			<tr><th class=SLC id=SLC_advanced_notes>General Info</th>
				<td>
					<p>The "Advanced Build Info" section is largely academic, and can be ignored for most practical spoke length calculations.
					<p>Basically, this section does not directly affect the "Spoke Lengths" provided above. Instead, it
						just indicates the effects to various spoke values (length, angle, etc) based on "Flange width", 
						"Spoke diameter at bend", and "Elbows Laced".
				</td>
			</tr>

			<tr><th class=SLC>Flange Width</th><td>The flange width at spoke holes affects bracing angles and tension ratio. It is often about 3mm. Also, it only matters if spokes are not laced "Center" (not entirely true, but true enough for now).</td></tr>
			<tr><th class=SLC>Spoke Diameter at the Bend</th><td>Spoke diameter just before the "J" bend, where it goes into the hub. This is usually 2mm, but can be other values. The value affects bracing angles &amp; tension ratio. Also, it only matters if spokes are not laced "Center" (not entirely true, but true enough for now).</td></tr>
			
			<tr><th class=SLC>Elbows Laced</th>
				<td>Specify if the spokes are laced elbows In, Out, or Center.  This affects the bracing angle and tension ratio.  It also affects spoke length a tiny amount. The differences between "Center" and "In" or "Out" are determined by Flange Width and Spoke Diameter at Bend.
					<p>Geometrically, "Center" is the mid-point of the flange thickness, and is the position used for general spoke length calculations by every spoke length calculator.  However, except for specially made hubs and spokes (eg: straight pull), spokes can not actually be laced "center".
					<p>So, if "Center" is used to approximate a common wheel where the spokes are acually laced alternately in/out/in/out (default), the other Advanced values (Length Adjust, Bracing Angles, etc) are just rough approximations.
					<p>A lot of other superfluous details are left out, because it gets complicated and doesn't really matter. So, go ride!
				</td>
			</tr>
			
			<tr><th class=SLC>Length Adjust.</th><td>How much the spoke length is affected by lacing choice (elbows in/out). In general, not enough to worry about.</td></tr>
			<tr><th class=SLC>Spoke Ratio</th><td>The (Side 1):(Side 2) spoke ratio. Usually 1:1, but is 1:2 for triplets, and can be other ratios in custom mode.</td></tr>
			<tr><th class=SLC>Bracing Angles</th><td>The lateral angle the spoke makes going from the rim to the hub.  This is affected by the flange-to-center width, OC rims, PCD, ERD, and spoke cross. Geometricallly, this value is also affected by the spoke hole diameter, but only by a tiny amount. Even less.</td></tr>
			<tr><th class=SLC>Tension Ratio</th><td>The theoretical spoke tension ratio (Side 1):(Side 2).  Side 2 is defined as 100%. This value is based on the spoke ratio and bracing angles.  Note that a change in the bracing angle on either side will affect the ratio listed for Side 1.</td></tr>
			<tr><th class=SLC>Tension</th>
				<td>Enter a spoke tension value under Side 2 to see the cooresponding tension value for Side 1 spokes, based on the Tension Ratio.
				<p>The spoke tensions between Side 1 and Side 2 of a wheel are interdependent. 
					That is, you can't change the tension on one side without affecting the other.*
					<p>So, generally, one side (such as the drive side of a rear wheel) is set to an appropriate tension level, and the other side is what it is, based on hub & rim geometry.
					<p>*Actually, adjusting the tension of <i>any</i> spoke also affects the tension of <i>every other</i> spoke a little bit.
				</td>
			</tr>
			
			<tr><th class=SLC></th><th>Disaplay Options</th></tr>
			<tr>
				<th>Scale</th>
				<td>
					"auto"<br>
					The wheel, regardless of ERD or rim width, will fit, and fill, the display window.
					<p>"fixed"<br>
					Defines the size the "wheel window" represents, in mm. The actual size of the "wheel window" on screen remains the same.
					This allows "zooming in" (or out) of the wheel.
					<p>For example, to "zoom" in on the hub, set the Scale options to "fixed" and "100".
				</td>
			</tr>
			<tr><th class=SLC>Colors</th>
				<td>Colors can be specified using common 
				<a class=SLC href="https://www.w3schools.com/Colors/colors_names.asp" target="_blank">html/css color names</a> 
				(black, gray, red, blue, green, skyblue, etc.),
				or with any currently valid html/css color code format (hex, rgb, cymk, etc.).
				</td>
			</tr>
			<tr><th class=SLC></th><th>ETC</th></tr>
			<tr><th class=SLC>Saved Settings</th><td>
				<p>In general, all information generated and used by this program internally, such as wheel data and display options, is saved locally, to this device only, in your web browser's localStorage.
				<p>To clear all wheel data & display options stored by this web browser on this device, click the following button:<br>
				<button type=button id=SLC_DELETE_ALL_DATA class="SLC SLC_load_clear">DELETE ALL SAVED WHEEL AND DISPLAY SETTINGS</button>
				<p>Your browser's cache is not affected by this option, and may retain some information.
				<p>Additionally, any wheels saved via Export Data is naturally unaffected by this option.
			</td></tr>
			
			<tr><th class=SLC>Export Data</th><td>
				<button id=SLC_EXPORT class="SLC SLC_load_clear">Export Wheels & Display Settings</button>
			</td></tr>
			
			<tr><th class=SLC>Import Data</th><td>
				<p>Importing previously Exported data will override currently loaded display and wheel options. It may also override current wheels listed in the Wheel select list.  That is, if you restore a previous Export that only had wheels 1,2, &amp; 3, but currently have wheels 1,2,3, &amp; 4 in the list, wheel 4 will remain unchanged.
				<p><button id=SLC_IMPORT class="SLC SLC_load_clear">Import Wheels & Display Settings</button>
			</td></tr>

			<tr><th class=SLC>Version</th><td id=SLC_VERSION></td></tr>
			<tr><th class=SLC></th><td></td></tr>
		</table>
	</div><!--//end Notes button & table  =============-->

</div><!--//end SLC_CONTAINER ================================================-->
<br>







<script>(function(){
/******************************************************************************/
var D = document;
function E(id) { return document.getElementById(id); }

var _NS_ = "SLC_"; //"Namespace" prefix used for <element> id's & class names.

//Local Storage key names.
var LS_VALUES_PREFIX   = _NS_ + "WHEEL_";
var LS_CURRENT_WHEEL   = _NS_ + "CURRENT_WHEEL"; //1, 2, 3, etc...
var LS_DISPLAY_OPTIONS = _NS_ + 'display_options'; //Name of display settings saved to localStorage.

var MAX_WHEELS = 10; //##### MAKE USER OPTION??? #####

var SSI = " :: " //Saved Settings Indicator. Used in CURRENT_WHEEL <select> list <option>'s.

var BG_STANDARD = "rgb(175,198,205)";  //Used for bg color of SETTINGS when in Standard mode.
//#####var BG_STANDARD = "rgb(222,232,235)";  //Used for bg color of SETTINGS when in Standard mode.
//#####var BG_PHH      = "rgb(182,200,235)";  //Used for bg color of SETTINGS when in Paird Hole Hub mode.
var BG_TRIPLET  = "rgb(130,166,176)";  //	"		"		"		"		   Triplet mode.
var BG_CUSTOM   = "#FAB";              //Long time ago when we was #FAB...     Custom mode.

var PRIOR_FOCUS = ""; //Used to return focus to input that had error. Set onfocus() of the inputs.



//Various messeges
var MSGS = {};
MSGS.notice  = "<div id=SLC_MSG_HEADER>Notice!</div>";
MSGS.invalid = "Invalid input: ";
MSGS.max_fl  = "Maximum value for flange holes: ";
MSGS.nf1_2   = "Number of flange holes:<br>Side 1 must be less than or equal to Side 2.<br>If needed, increase Side 2 first.";
MSGS.nf2_1   = "Number of flange holes:<br>Side 2 must be greater than or equal to Side 1.<br>If needed, decrease Side 1 first.";




//id & class prefixes, etc.
var SPOKE_ID_PREFIX 	= _NS_ + "spoke_";
var HUB_HOLE_ID_PREFIX	= _NS_ + "f";	//Hub/flange hole id ex: SLC_f1_sh1
var HUB_HOLE_MESOFIX	= "_sh";	    //HUB_HOLE_ID_PREFIX + 1 + HUB_HOLE_MESOFIX + 1
var RIM_HOLE_ID_PREFIX	= _NS_ + "rsh"; //SLC_rsh1, SLC_rsh2, etc...
var RIM_HOLE_CLASS		= _NS_ + "rsh";
var SPOKE_GROUP_PREFIX	= _NS_ + "group"; //SLC_group1, ..., SLC_group4
var SPOKE_BASE_CLASS	= _NS_ + "spoke";
var HUB_HOLE_CLASS		= _NS_ + "hsh";
var AXIS_CLASS			= _NS_ + "axis";
var SPOKE_HOLES			= _NS_ + "spoke_holes";




//Assign all necessary element references here.
var $RESPONSIBILITY = E(_NS_ + 'responsibility');

var $CONTAINER		= E(_NS_ + 'CONTAINER');
var $SETTINGS		= E(_NS_ + 'settings');

var $CURRENT_WHEEL  = E(_NS_ + 'CURRENT_WHEEL'); //1, 2, 3, etc...
var $WHEEL_NAME     = E(_NS_ + 'WHEEL_NAME');

var $AUTO_COPY      = E(_NS_ + 'auto_copy');
var $RENAME_WHEEL   = E(_NS_ + 'rename_wheel');
var $LOAD_SAMPLES	= E(_NS_ + 'load_samples');
var $CLEAR_SETTINGS	= E(_NS_ + 'clear_settings');

var $WHEEL_TYPE		= E(_NS_ + 'WHEEL_TYPE');

var $ph_container = E(_NS_ + 'ph_container'); //<div> around PHHA
var PHH_OPTIONS   = _NS_ + 'phh_options'; //class
var $PH_HUB       = E(_NS_ + 'PH_HUB'); //Was using a checkbox...
var $HUB_AUTO_ANGLES = E(_NS_ + 'HUB_AUTO_ANGLES');
var $PHHA = [];
	$PHHA[1]      = E(_NS_ + 'PHHA1'); //Paired-Holes Angle Flange 1
	$PHHA[2]      = E(_NS_ + 'PHHA2'); //Paired-Holes Angle Flange 2
var $PHHD = [];
	$PHHD[1]      = E(_NS_ + 'PHHD1'); //Paired-Holes Distance Flange 1 (center to center)
	$PHHD[2]      = E(_NS_ + 'PHHD2'); //Paired-Holes Distance Flange 2 (center to center)

var $ERD  = E(_NS_ + 'ERD');	// Effective Rim Diameter
var $NR   = E(_NS_ + 'NR');	// Number of holes in the Rim
var $NF	 = [];
	$NF[1]= E(_NS_ + 'NF1');	// Number of holes in Flange 1
	$NF[2]= E(_NS_ + 'NF2');	//    "		   "		"	 2


	//not elements, but requires a few elements defined above...
var MAX = {};			 //At these values, it starts to take to long to run.
	MAX[$NR.id]    = 72; //MAX NR needs to be divisible by 3 AND by 4,  for Build_NR() to work for both standard & triplet modes.
	MAX[$NF[1].id] = 72;
	MAX[$NF[2].id] = 72;


var $PCD    = [];
	$PCD[1] = E(_NS_ + 'PCD1');	// Pitch Circle Diameter 1
	$PCD[2] = E(_NS_ + 'PCD2');	// 	 "	   "		"	 2
var $FTC    = [];
	$FTC[1] = E(_NS_ + 'FTC1');	// Flange-to-Center 1 distance
	$FTC[2] = E(_NS_ + 'FTC2');	// 	  "			"	2	 "
var $OSB    = [];
	$OSB[1] = E(_NS_ + 'OSB1');	// Offset Spoke Bed 1 (off center rim)
	$OSB[2] = E(_NS_ + 'OSB2');	// 	  "			"	2	 "		"
var $SX     = [];
	$SX[1]  = E(_NS_ + 'SX1');	// Spoke Crossing side 1
	$SX[2]  = E(_NS_ + 'SX2');	// Spoke Crossing side 2
var $SHD    = E(_NS_ + 'SHD');	// Spoke Hole Diameter. Affects spoke length calcs only.

var $LACE_OPT = E(_NS_ + 'LACE_OPT'); // Wheel Type/Lacing Option
	$LACE_OPT.options[0].value = -1; //Type 2. The option values (1 or -1) are used in the 
	$LACE_OPT.options[1].value =  1; //Type 1. spoke length calculations. DO NOT CHANGE 

var $SL   = [];					//Spoke Lengths
	$SL[1]= E(_NS_ + 'LENGTH1');	//Flange 1 Group 1 (ie: leading/trailing...)
	$SL[3]= E(_NS_ + 'LENGTH3');	//		 2		 3

	$SL[2]= E(_NS_ + 'LENGTH2');	//	  	 1		 2
	$SL[4]= E(_NS_ + 'LENGTH4');	//		 2		 4

var $SL_2_4 = E(_NS_ + "SL_2_4"); //<tr> with lengths for "even" numbered spokes. Usually the same and not displayed.

var $SHOW_HIDE_ADVANCED = E(_NS_ + 'show_hide_advanced'); //<button> to show/hide advanced build info
var $ADVANCED_INFO      = E(_NS_ + 'advanced_info'); //<div> around advanced info.
var $SEE_NOTES          = E(_NS_ + 'see_notes'); //

var $FW	 = E(_NS_ + 'FW');  //Flange Width, at spoke holes.
var $SDB = E(_NS_ + 'SDB'); //Spoke Diameter, at bend.

var $ELBOWS	= [];
	$ELBOWS[1] = E(_NS_ + 'ELBOWS1');
	$ELBOWS[2] = E(_NS_ + 'ELBOWS2');

var $SL_ADJ    = []; //Spoke Lengths adjusted for elbows in or out.
	$SL_ADJ[1] = E(_NS_ + 'SL_ADJ1');
	$SL_ADJ[2] = E(_NS_ + 'SL_ADJ2');

var $SPOKE_RATIO    = [];
	$SPOKE_RATIO[1] = E(_NS_ + 'spoke_ratio1');
	$SPOKE_RATIO[2] = E(_NS_ + 'spoke_ratio2');

var $BRACE_ANGLE    = [];
	$BRACE_ANGLE[1] = E(_NS_ + 'brace_angle1');
	$BRACE_ANGLE[2] = E(_NS_ + 'brace_angle2');

var $TENSION_RATIO    = [];
	$TENSION_RATIO[1] = E(_NS_ + 'tension_ratio1');
	$TENSION_RATIO[2] = E(_NS_ + 'tension_ratio2');

var $TENSION    = [];
	$TENSION[1] = E(_NS_ + 'TENSION1');
	$TENSION[2] = E(_NS_ + 'TENSION2');

var $DISPLAY_OPTIONS = E(_NS_ + 'display_options'); //<div> around display options to enable show/hide

var $OTHER_CALCS = E(_NS_ + 'other_calcs'); //<div> around A Few Other Calcs links

var $SHOW_HIDE_OTHER = E(_NS_ + 'show_hide_other'); //<button> to show/hide other calcs links.
var $SHOW_HIDE_NOTES = E(_NS_ + 'show_hide_notes'); //<button> to show/hide Notes.
var $SHOW_HIDE_DO    = E(_NS_ + 'show_hide_DO');    //<button> to show/hide display options.

var $SCALE_MODE  = E(_NS_ + 'SCALE_MODE');
var $SCALE_auto  = E(_NS_ + 'SCALE_auto');
var $SCALE_fixed = E(_NS_ + 'SCALE_fixed');

var $RESET_SCALE = E(_NS_ + 'reset_scale');
var $RESET_OPTIONS_SPOKES  = E(_NS_ + 'reset_options_spokes');   //<button> to reset display options.
var $RESET_OPTIONS_RIM_ETC = E(_NS_ + 'reset_options_rim_etc');  //<button> to reset display options.

var $SPOKE_COLOR    = [];
	$SPOKE_COLOR[1] = E(_NS_ + 'SPOKE_COLOR1');//Spoke group 1 color
	$SPOKE_COLOR[2] = E(_NS_ + 'SPOKE_COLOR2');//Spoke group 2 color
	$SPOKE_COLOR[3] = E(_NS_ + 'SPOKE_COLOR3');//Spoke group 3 color
	$SPOKE_COLOR[4] = E(_NS_ + 'SPOKE_COLOR4');//Spoke group 4 color

var $SPOKE_LINE_SIZE    = []; 
	$SPOKE_LINE_SIZE[1] = E(_NS_ + 'SPOKE_LINE_SIZE1');//Spoke group 1 line width
	$SPOKE_LINE_SIZE[2] = E(_NS_ + 'SPOKE_LINE_SIZE2');//			  2
	$SPOKE_LINE_SIZE[3] = E(_NS_ + 'SPOKE_LINE_SIZE3');//			  3
	$SPOKE_LINE_SIZE[4] = E(_NS_ + 'SPOKE_LINE_SIZE4');//			  4


var $SHOW_SIDE = [];
	$SHOW_SIDE[1] = E(_NS_ + 'SHOW_SIDE1');//Show side 1 spokes (groups 1 & 2)
	$SHOW_SIDE[2] = E(_NS_ + 'SHOW_SIDE2');//Show side 1 spokes (groups 1 & 2)

var $SPOKE_SHOW    = [];
	$SPOKE_SHOW[1] = E(_NS_ + 'SPOKE_SHOW1');// Show spoke group 1
	$SPOKE_SHOW[2] = E(_NS_ + 'SPOKE_SHOW2');// Show spoke group 2
	$SPOKE_SHOW[3] = E(_NS_ + 'SPOKE_SHOW3');// Show spoke group 3
	$SPOKE_SHOW[4] = E(_NS_ + 'SPOKE_SHOW4');// Show spoke group 4

var $RIM	 = E(_NS_ + 'rim'); //<circle>
var $FLANGE1 = E(_NS_ + 'flange1'); //<circle>
var $FLANGE2 = E(_NS_ + 'flange2'); //<circle>

var $RIM_COLOR = E(_NS_ + 'RIM_COLOR');
var $F1_COLOR  = E(_NS_ + 'F1_COLOR');
var $F2_COLOR  = E(_NS_ + 'F2_COLOR');

var $RIM_LINE_SIZE = E(_NS_ + 'RIM_LINE_SIZE');//Width of rim.
var $F1_LINE_SIZE  = E(_NS_ + 'F1_LINE_SIZE'); //Line width of flange cirlce.
var $F2_LINE_SIZE  = E(_NS_ + 'F2_LINE_SIZE'); //Line width of flange cirlce.

var $RIM_SHOW = E(_NS_ + 'RIM_SHOW');// Show Rim circle.
var $F1_SHOW  = E(_NS_ + 'F1_SHOW');	// Show Flange 1 circle.
var $F2_SHOW  = E(_NS_ + 'F2_SHOW');	// Show Flange 2 circle.

var $HOLE_SIZE	    = E(_NS_ + 'HOLE_SIZE');  //Displayed spoke hole size (all holes)
var $HOLE_COLOR     = E(_NS_ + 'HOLE_COLOR');     //Spoke hole color
var $HOLES_SHOW	    = E(_NS_ + 'HOLES_SHOW');     //Take a guess...

var $AXES_COLOR     = E(_NS_ + 'AXES_COLOR');
var $AXES_LINE_SIZE = E(_NS_ + 'AXES_LINE_SIZE');
var $AXES_SHOW  	= E(_NS_ + 'AXES_SHOW');

var $SPOKES		   = E(_NS_ + 'spokes');   //<g> containing all spokes.
var $RIM_HOLES	   = E(_NS_ + 'rim_holes');//<g> containing rim holes.
var $FLANGE1_HOLES = E(_NS_ + 'holes_f1'); //<g> containing flange 1 holes.
var $FLANGE2_HOLES = E(_NS_ + 'holes_f2'); //<g> containing flange 2 holes.

var $MSG_BOX 	 = E(_NS_ + 'msg_box');	 //Container div for msg div & [Close] btn.
var $CLOSE_MSG	 = E(_NS_ + 'close_msg'); //[Close] button for error message box.
var $MESSAGE_DIV = E(_NS_ + 'message');	 //div for actual error message.
var $ACCEPT_MSG  = E(_NS_ + 'ACCEPT_MSG'); //[I Accept] disclaimer button. id is also cookie name.


var $SVG_WHEEL = E(_NS_ + 'svg_wheel'); //Main <svg> element containing wheel & axes..
var $G_WHEEL   = E(_NS_ + 'wheel'); //<g> containing just the wheel elements: spokes, holes, rim, & flanges.

var $SVG_CONTAINER_DIV = E(_NS_ + 'The_SVG');

var $NOTES = E(_NS_ + 'notes'); //Notes <div>.
var $NOTES_ADVANCED_BUILD_INFO = E(_NS_ + 'advanced_notes');

var $X_axis = E(_NS_ + 'x-axis');
var $Y_axis = E(_NS_ + 'y-axis');

var $DELETE_ALL_DATA = E(_NS_ + 'DELETE_ALL_DATA');

var $SLC_VERSION      = E(_NS_ + 'VERSION');

var $EXPORT           = E(_NS_ + 'EXPORT'); //<button>
var $EXPORT_CONTAINER = E(_NS_ + 'EXPORT_container');
var $EXPORT_OUTPUT    = E(_NS_ + 'EXPORT_OUTPUT'); //<div> of data
var $COPY_TO_CLIPBOARD = E(_NS_ + 'copy_to_clipboard');//<button>
var $CLOSE_EXPORT      = E(_NS_ + 'close_export');     //<button>

var $IMPORT           = E(_NS_ + 'IMPORT');         //<button>
var $IMPORT_CONTAINER = E(_NS_ + 'IMPORT_container');
var $IMPORT_INPUT     = E(_NS_ + 'IMPORT_INPUT'); //<input textarea> of data
var $PERFORM_IMPORT   = E(_NS_ + 'perform_import'); //<button>
var $CLOSE_IMPORT     = E(_NS_ + 'close_import');   //<button>



//end assignment of element references.



/*************************************************./
//Consider all raw size & x/y values to be mm,
//to coorespond directly to rim, hub, & spoke measurements.


/*************************************************/
var DEFAULT_VALUES = {
	'WHEEL_NAME' : "New Wheel",
	'WHEEL_TYPE' : "standard", //standard, triplet, custom

	'PH_HUB': false,
	'HUB_AUTO_ANGLES': "even",
	'PHHA1': 30,
	'PHHA2': 30,
	'PHHD1': 10.0, // 9.964533
	'PHHD2': 13.1, //13.096244

	'ERD'  : 577,
	'NR'   : 24,
	'NF1'  : 12,
	'NF2'  : 12,
	'PCD1' : 38.5,
	'PCD2' : 50.6,
	'FTC1' : 37.7, //FtC & OSB affect spoke length calcs only (not display).
	'FTC2' : 17.1, //
	'OSB1' : "",   //
	'OSB2' : "",   //
	'SX1'  : 2,
	'SX2'  : 2,
	'SHD'  : 2.6,	//Affects spoke length calcs only (not displayed size).
	'LACE_OPT': 1,	//1 or -1
	'FW'   : 3,		//Flange Width, at spoke holes.
	'SDB'  : 2,		//Spoke Diameter, at bend.
	'ELBOWS1' : 0,	//0 = flange center, 1 = elbows out, -1 = elbows in
	'ELBOWS2' : 0,	//
	'TENSION2': 120
}


var DEFAULT_OPTIONS = {
	'show_hide_advanced':"none", //none or inline-block
	'show_hide_other': "none", 	 //  "			"
	'show_hide_notes': "none", 	 //  "			"
	'show_hide_DO'   : "none", 	 //  "			"
	'SPOKE_COLOR1': "#477", //Spoke group colors
	'SPOKE_COLOR2': "#477", //
	'SPOKE_COLOR3': "#355", //
	'SPOKE_COLOR4': "#355", //
	'SPOKE_LINE_SIZE1': 2,
	'SPOKE_LINE_SIZE2': 2,
	'SPOKE_LINE_SIZE3': 2,
	'SPOKE_LINE_SIZE4': 2,
	'SPOKE_SHOW1': true,
	'SPOKE_SHOW2': true,
	'SPOKE_SHOW3': true,
	'SPOKE_SHOW4': true,
	'RIM_SHOW'   : true,
	'F1_SHOW'    : true,
	'F2_SHOW'    : true,
	'RIM_LINE_SIZE' :30,
	'F1_LINE_SIZE'  :1,
	'F2_LINE_SIZE'  :1,
	'AXES_LINE_SIZE':1,
	'RIM_COLOR' : "#BBB",
	'F1_COLOR'  : "#AAA",
	'F2_COLOR'  : "#777",
	'HOLE_COLOR': "#000",
	'HOLE_SIZE'      : 2.6, //Hole diameter (if HOLE_LINE_SIZE = 0 (stroke-width)).
	'HOLES_SHOW': true,
	'AXES_COLOR': "#999",
	'AXES_SHOW' : true,
	'SCALE_MODE': 'fixed',
	'SCALE_fixed': 670  //viewbox size for "fixed" mode. To fit a common 700c wheel,
 };                     //it should be at least (ERD + (RIM_LINE_SIZE * 2)).
/*************************************************/




function Parse_Settings(string) { //*******************************************/
	//Currently, only used to parse returned saved settings from localStorage.
	//If the parse fails, return null, as localStorage does if a localStorage item doesn't exit.
	//ie: return null on any non object/failure/error.
	try {
		var parsed = JSON.parse(string);
		// Non-exception exceptions:
		// JSON.parse(false) and JSON.parse(1234) simply return false & 1234.
		// We'd prefer null, but JSON.parse(null) returns null, and typeof null === "object".
		// So check for those. And since null is falsey, this works:
		if (parsed && typeof parsed === "object") { return parsed; }
	}
	catch (e) {}
	return null;
}//end Parse_Settings() //*****************************************************/




function Normalize_Event(event) { //*******************************************/
	//Normalize the event & which/keycode/charcode...
	if (!event) {var event = window.event;} //for IE
	var key_code = event.which || event.keyCode || event.charCode;
	event.key_code = key_code;
	return event;
}//end Normalize_Event() //****************************************************/




function Pad10(number) { //****************************************************/
	if ((number * 1) < 10) { var pad = "&nbsp; "; } else { var pad = ""; }
	return pad + number;
}//end Pad10() //**************************************************************/




function Save_Settings(what, misc) { //****************************************/
	//Save properties of what, but only the properties that exist in defaults.

	if (what == "wheel") {
		var storage_id = LS_VALUES_PREFIX + $CURRENT_WHEEL.value;
		var defaults   =  DEFAULT_VALUES;
	}
	else if (what == "display") {
		var storage_id = LS_DISPLAY_OPTIONS;
		var defaults   = DEFAULT_OPTIONS;
	}
	else { //Should never happen, but it just did.  Because I'm not entirely perfect. So...
		var msg  = 'Save_Settings(what)<br>what = "';
			msg += what + '" is invalid<br>Called from:<br>';
			msg += Save_Settings.caller.name;
		Error_Notice('', msg);
		return false;
	}

	var $setting = "";
	var settings = {};

	for (var id in defaults) {
		$setting = E(_NS_ + id);
		
		//Ignore invalid id's (no cooresponding <element>). Shouldn't be any, but just in case...
		if (!$setting) { continue }
		
		if ($setting.type == "checkbox") { settings[id] = $setting.checked; }
		else 							 { settings[id] = $setting.value;   }		
	}

	//New wheel?
	var current_wheel = $CURRENT_WHEEL.value;
	var new_wheel     = (localStorage.getItem(LS_VALUES_PREFIX + current_wheel) == null);
	var imported      = (misc == "imported");
	var copy          = (misc == "copy");
	
	if ( ((what == "wheel") && new_wheel) || imported ) {
		if      (imported)        { ; }
		else if (copy)            { $WHEEL_NAME.value = "Copy of " + $WHEEL_NAME.value; }
		//New wheel created by changing a value other than WHEEL_NAME...
		else if (misc !== "name") { $WHEEL_NAME.value = DEFAULT_VALUES.WHEEL_NAME; }
		//else  { the user set a wheel name to start the wheel, so leave it. }
		
		var option = $CURRENT_WHEEL.options[current_wheel - 1]; //CURRENT_WHEEL counts from 1, options from 0.
		
		option.innerHTML = Pad10(current_wheel) + SSI + $WHEEL_NAME.value;
		settings.WHEEL_NAME = $WHEEL_NAME.value;
	}

	localStorage.setItem(storage_id, JSON.stringify(settings));
}//end Save_Settings() { //****************************************************/




function Load_Saved_Settings(what, imported) { //******************************/

	if (imported) { var settings = what; }
	else          { var settings = Parse_Settings(localStorage.getItem(what)); }

	if (settings == null) { return false; }

	for (var id in settings) {
		var $setting = E(_NS_ + id);
		
		//Ignore invalid id's (no cooresponding <element>). Shouldn't be any, but just in case...
		if (!$setting) { continue }
		var value = settings[id];
		
		if ($setting.type == "checkbox") { $setting.checked = value; }
		else						     { $setting.value   = value; }
	}

	if ($CURRENT_WHEEL.value && what == (LS_VALUES_PREFIX + $CURRENT_WHEEL.value)) {
		$WHEEL_NAME.current = $WHEEL_NAME.value;
	}

	return true;
}//end Load_Saved_Settings() { //**********************************************/




function Validate_Wheel_Settings(misc, save) { //******************************/
	//For now, just a very basic sanitation of loaded values.
	//Currently only checks <input type=text> values.
	//##### Need method to also validate <select>s & checkboxes? #####

	if (($WHEEL_TYPE.value != "custom") && ($WHEEL_TYPE.value != "triplet") && ($WHEEL_TYPE.value != "phh")) { $WHEEL_TYPE.value = "standard"; }
	if ($LACE_OPT.value != "-1") { $LACE_OPT.value = 1; }

	//For now, just make sure they're numbers (those that should be, at leaset).
	for (var name in DEFAULT_VALUES) {
		var $setting = E(_NS_ + name);
		if ( !$setting ) { continue }
		
		if ($setting.tagName == "INPUT" && $setting.type == "text" && isNaN($setting.value) && $setting.id != $WHEEL_NAME.id)
			{ $setting.value = ""; }
	}

	if (save) { Save_Settings("wheel", misc); } //in case any were invalid.
}//end Validate_Wheel_Settings() { //******************************************/




function Load_Samples() { //***************************************************/

	if ($ACCEPT_MSG.ENABLED && $ACCEPT_MSG.value != "true") { return; }

	Load_Saved_Settings(DEFAULT_VALUES, true);

	$WHEEL_NAME.value   = "Sample Wheel";
	$WHEEL_NAME.current = $WHEEL_NAME.value;
	var current_wheel = $CURRENT_WHEEL.value;
	var option = $CURRENT_WHEEL.options[current_wheel - 1]; //CURRENT_WHEEL counts from 1, options from 0.
	option.innerHTML = Pad10(current_wheel) + SSI + $WHEEL_NAME.value;

	Setup_Wheel_Type();

	Setup_Viewbox();

	Save_Settings("wheel", "name");

	Build_Wheel();
}//end Load_Samples() { //*****************************************************/




function Clear_Settings() { //*************************************************/

	$WHEEL_NAME.value   = '';
	$WHEEL_NAME.current = '';

	$WHEEL_TYPE.value = DEFAULT_VALUES['WHEEL_TYPE'];
	$PH_HUB.checked = false;
	$PHHA[1].value = '';
	$PHHA[2].value = '';
	$PHHD[1].value = '';
	$PHHD[2].value = '';

	$ERD   .value = '';
	$NR	   .value = '';
	$NF[1] .value = '';
	$NF[2] .value = '';
	$PCD[1].value = '';
	$PCD[2].value = '';
	$FTC[1].value = '';
	$FTC[2].value = '';
	$OSB[1].value = '';
	$OSB[2].value = '';
	$SX[1] .value = '';
	$SX[2] .value = '';
	$SHD   .value = '';

	$LACE_OPT.value = 1;
	$FW .value = DEFAULT_VALUES['FW'];
	$SDB.value = DEFAULT_VALUES['SDB'];
	$ELBOWS[1].value = 0;
	$ELBOWS[2].value = 0;
	$TENSION[2].value = ''; //[1] is a computed value, and is cleared in Clear_Wheel()
	
	Setup_Wheel_Type("init");

	Setup_Viewbox();

	Clear_Wheel(true);

	var current_wheel = $CURRENT_WHEEL.value;
	var option = $CURRENT_WHEEL.options[current_wheel - 1]; //current_wheel counts from 1, options from 0.
	option.innerHTML = Pad10(current_wheel);

	localStorage.removeItem(LS_VALUES_PREFIX + current_wheel);
	
}//end Clear_Settings() { //***************************************************/




function Load_DEFAULT_OPTIONS_Spokes() { //************************************/
	for (var group = 1; group <=4; group++) {
		$SPOKE_COLOR[group]    .value   = DEFAULT_OPTIONS['SPOKE_COLOR'     + group];
		$SPOKE_LINE_SIZE[group].value   = DEFAULT_OPTIONS['SPOKE_LINE_SIZE' + group];
		$SPOKE_SHOW[group]     .checked = DEFAULT_OPTIONS['SPOKE_SHOW'      + group];
	}
	
	$SHOW_SIDE[1].checked = true;
	$SHOW_SIDE[2].checked = true;

}//end Load_DEFAULT_OPTIONS_Spokes() { //**************************************/




function Load_DEFAULT_OPTIONS_Rim_etc() { //***********************************/
	$RIM_COLOR.value     = DEFAULT_OPTIONS['RIM_COLOR'];
	$F1_COLOR.value      = DEFAULT_OPTIONS['F1_COLOR'];
	$F2_COLOR.value      = DEFAULT_OPTIONS['F2_COLOR'];
	$RIM_LINE_SIZE.value = DEFAULT_OPTIONS['RIM_LINE_SIZE'];
	$F1_LINE_SIZE.value  = DEFAULT_OPTIONS['F1_LINE_SIZE'];
	$F2_LINE_SIZE.value  = DEFAULT_OPTIONS['F2_LINE_SIZE'];
	$RIM_SHOW.checked    = DEFAULT_OPTIONS['RIM_SHOW'];
	$F1_SHOW.checked     = DEFAULT_OPTIONS['F1_SHOW'];
	$F2_SHOW.checked     = DEFAULT_OPTIONS['F2_SHOW'];

	$AXES_COLOR.value     = DEFAULT_OPTIONS['AXES_COLOR'];
	$AXES_LINE_SIZE.value = DEFAULT_OPTIONS['AXES_LINE_SIZE'];
	$AXES_SHOW.checked    = DEFAULT_OPTIONS['AXES_SHOW'];
	
	$HOLE_COLOR.value     = DEFAULT_OPTIONS['HOLE_COLOR'];
	$HOLES_SHOW.checked   = DEFAULT_OPTIONS['HOLES_SHOW'];

	$HOLE_SIZE.value       = DEFAULT_OPTIONS['HOLE_SIZE'];
}//end Load_DEFAULT_OPTIONS_Rim_etc() { //*************************************/




function Load_DEFAULT_OPTIONS() { //*******************************************/

	Set_Scale_Mode(true);
	
	Load_DEFAULT_OPTIONS_Spokes();

	Load_DEFAULT_OPTIONS_Rim_etc()	

}//end Load_DEFAULT_OPTIONS() //***********************************************/




function Round(number,places) {
	if (isNaN(places)) { places = 0; }
	else               { places = Math.floor(places); }
	//Use exponetial notation to avoid the 1.005 issue... try it: alert(1.005*10)  or,  alert(Math.round(1.005*100)/100)
	return  Number( Math.round( number + 'e' + places ) + 'e-' + places );
}//end Round()




function Scroll_Blur(event){ //************************************************/
	//Permit "clearing" focus, and some keyboard navigation while in <input>'s.

	Normalize_Event(event);
	
	var ESC = 27, AU = 38, AD = 40, PU = 33, PD = 34;

	//ESC "cancels" current renaming of wheel & reverts back to current name.
	if ((event.target.id == $WHEEL_NAME.id) && (event.key_code == ESC)) { $WHEEL_NAME.value = $WHEEL_NAME.current; }

	//remove focus from input/select to allow keyboard arrows/pageup/pagedown/etc page scrolling.
	if (event.key_code == ESC) { D.activeElement.blur(); return; }

	if (event.target.tagName == "INPUT") {
		//Arrow down scrolls the page up, towards the bottom of the page, and vice-versa.
		if      (event.key_code == AU) { window.scrollBy(0, -38); }
		else if (event.key_code == AD) { window.scrollBy(0,  38); }
		else if (event.key_code == PU) { window.scrollBy(0,-400); }
		else if (event.key_code == PD) { window.scrollBy(0, 400); }
	}
}//end Scroll_Blur() //********************************************************/




function Build_Select_Wheel_List() { //****************************************/

	var wheel_index = localStorage.getItem(LS_CURRENT_WHEEL) * 1; //1, 2, 3, etc...

	if (isNaN(wheel_index)) { wheel_index = 1; }
	if (wheel_index < 1)    { wheel_index = 1; }
	if (wheel_index > MAX_WHEELS) { wheel_index = MAX_WHEELS; }

	$CURRENT_WHEEL.innerHTML = ""; //Clear any current <option>s

	var mark = ""; //Indicates options with saved settings. Either " :: ", or " :: User Supplied Wheel Name".
	var option_list = "";

	for (var wheel = 1; wheel <= MAX_WHEELS; wheel++) {
		
		var settings = Parse_Settings(localStorage.getItem(LS_VALUES_PREFIX + wheel));
		
		//If wheel settings exist, get "WHEEL_NAME" & show in <option> text.
		if (settings == null) { mark = "" }
		else {	
			//Make sure WHEEL_NAME is not missing.
			if ( !('WHEEL_NAME' in settings) ) {
				settings['WHEEL_NAME'] = '';
				localStorage.setItem(LS_VALUES_PREFIX + wheel, JSON.stringify(settings));
			}
			
			for (var id in settings) {
				var value = settings[id];
				if (id == "WHEEL_NAME") {
					mark = SSI + value;
					break;
				}
			}
		}
		
		option_list += "<option value='"+wheel+"'>" + Pad10(wheel) + mark + "</option>";
	}

	$CURRENT_WHEEL.innerHTML = option_list;
	$CURRENT_WHEEL.value       = wheel_index;
	$CURRENT_WHEEL.prior_value = wheel_index;
}//end Build_Select_Wheel_List() //********************************************/




function Advanced_Build_Notes_btn() { //***************************************/

	var $Notes = $SHOW_HIDE_NOTES; //[Notes] button at bottom of page
	
	//If notes are hidden, show them...
	if ($Notes.value == "none") { Show_Hide_Options($SHOW_HIDE_NOTES, $NOTES, "inline-block"); }
	
	$NOTES_ADVANCED_BUILD_INFO.scrollIntoView();
}//end Advanced_Build_Notes_btn() //*******************************************/




function Show_Hide_Options(button, target, mode) { //**************************/
	//Toggle button.value, and Show or Hide target,

	if (button.value == "none") { button.value     = mode;   } //inline-block, etc...
	else 						{ button.value     = "none"; }

	target.style["display"] = button.value;

	Scroll_Into_View(target, button.offsetHeight + 10);

	Save_Settings("display");
}//end Show_Hide_Options() //**************************************************/




function Bracing_Angle(f, adj) { //********************************************/
	//tan(bracing angle) = (FtC +/- OSB) / (rR - y1 - rSH)
	
	if (!adj) { adj = 0 } //Consider whether spokes laced elbows out or in. (+/- ~2.5mm)

	var rR = $ERD.value/2;			//radius of Rim
	var rF = $PCD[f].value/2;		//radius of Flange
	var ftc= $FTC[f].value*1 + adj;	//flange to center + elbows laced in or out...
	var osb= $OSB[f].value*1;		//offset spoke bed (off-center)
	var rSH= $SHD.value/2;			//radius of Spoke Hole (spoke hole diameter/2)
	var aR = 360/$NR.value*1;		//angle between holes in Rim
	var aF = 360/$NF[f].value*1;	//angle between holes in flange
	var lo = $LACE_OPT.value*1; 	//lacing option, 1 or -1. For standard lacings, doesn't matter.
	

	//"angle" to hole zero. For standard wheels = 0, but not for triplets.
	if (($NR.value % $NF[f].value) == 0) { var a0 = 0; } else { var a0  = aR - aF/2; }

	var af     = ($SX[f].value * aF) + a0 * lo; //angle to hole in flange  spoke.
	var af_rad = af/180 * Math.PI; 		 //af in radians
	var y1     = rF * Math.cos(af_rad);  // x1^2 + y1^2 = rF^2
	var tan_aB = (ftc + osb) / (rR - y1 - rSH);//tangent of Bracing angle
	var aB_rad = Math.atan(tan_aB);		 //Bracing angle (in radians)
	var aB    = aB_rad * 180 / Math.PI;	 //Bracing angle (in degrees)

	return aB;
}//end Bracing_Angle() { //****************************************************/




function Update_Advanced_Info(save) { //***************************************/

	$SPOKE_RATIO[1].value = '';
	$SPOKE_RATIO[2].value = '';

	if ($NF[1].value == 0) { var spoke_ratio = ""; }
	else 				   { var spoke_ratio = parseFloat($NF[2].value / $NF[1].value).toFixed(2); }

	if ($NR.value != 0 && $NF[1].value != 0) { $SPOKE_RATIO[1].value = 1; }
	$SPOKE_RATIO[2].value = spoke_ratio;

	//For determining brace angles when spokes laced Elbows In/Elbows out, vs flange Center (altertnating).
	//(Flange Width + Spoke Diameter at Bend)/2
	var brace_adj = $FW.value/2 + $SDB.value/2;

	var aB1 = Bracing_Angle(1, brace_adj * $ELBOWS[1].value);
	var aB2 = Bracing_Angle(2, brace_adj * $ELBOWS[2].value);

	if ((aB1 <= 0) || isNaN(aB1)) {
		var bracing_ratio = 0;
		$BRACE_ANGLE[1].value = "";
		$TENSION_RATIO[1].value = "";
	}
	else {
		var bracing_ratio = aB2/aB1;
		$BRACE_ANGLE[1].value = aB1.toFixed(2);
		$TENSION_RATIO[1].value = (bracing_ratio * spoke_ratio * 100).toFixed(1);
	}

	if ((aB2 <= 0) || isNaN(aB2)) {
		$BRACE_ANGLE[2].value = "";
		$TENSION_RATIO[2].value = "";
	}
	else {
		$BRACE_ANGLE[2].value = aB2.toFixed(2);
		$TENSION_RATIO[2].value = 100; //By definition
	}

	var sl_1   = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1', 4)
	var sl_1io = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1', 4, brace_adj * $ELBOWS[1].value)

	var sl_2   = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1', 4)
	var sl_2io = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1', 4, brace_adj * $ELBOWS[2].value)

	$SL_ADJ[1].value = Round((sl_1io - sl_1), 2);
	$SL_ADJ[2].value = Round((sl_2io - sl_2), 2);

	$TENSION[1].value = Round($TENSION[2].value * $TENSION_RATIO[1].value / 100);

	if (save) { Save_Settings("wheel"); }
}//end Update_Advanced_Info() { //*********************************************/




function Build_NR_Options(wheel_type, max, new_value) { //*********************/

	var skip = 4; //"standard"
	if (wheel_type == "triplet") { skip = 3 } else 
	if (wheel_type == "custom" ) { skip = 1 }
	
	
	var options = "";
	for (var x = max; x >= 0; x -= skip) {
		options += "<option value="+x+">"+x+"</option>\n"
	}

	$NR.innerHTML = options;
	$NR.value = new_value;
}//end Build_NR_Options(wheel_type) { //***************************************/




function Build_SX_Options(wheel_type, f, max, value) { //**********************/

	value = value*1;

	var options = ""

	if (wheel_type != "custom") { max = Math.floor(max/4); }

	for (var x = max; x >= 0; x--) { 
		options += "<option value="+x+">"+x+"</option>\n"
	}

	if (max == 0)    { value = 0       } else
	if (value > max) { value = max - 1 }

	$SX[f].innerHTML = options;
	$SX[f].value = value;
}//end Build_SX_Options() { //*************************************************/




/****************************************************************************../
	Geometery & trig used to calculate paired-hole angles & distances.
	------------------------------------------------------------------
	Prof. Sohcahtoa says sin(Î¸) = opposite side over hypotenuse.
	So, for our case, sin(Î¸/2) = (d/2) / (PCD/2),
	Where Î¸ is the angle formed by two lines originating at the center of the PCD,
	and exending thru the paired-holes.

        X  axial center of hub & PCD
       /Î¸\
      / | \
     /  |  \  hypotenuse = PCD/2
    /   |   \ 
   /    |    \
  O-----+-----O  Paired Holes  (Actual paired-holes are much closer together,)
  |     | d/2 |                (relatively speaking.                         )
  |<----d---->| 
/*******************************************************************************/




function Calc_PH_Distance(side) { //*******************************************/
	//Calculate the center-to-center distance between paired-holes.
	//Uses PCD and user provied Paired-Hole angle (Î¸) ($PHHA).
	var radians = $PHHA[1].value * Math.PI / 180;
	var distance = Math.sin(radians/2) * $PCD[side].value;
	$PHHD[side].value = Round(distance,2);
	return distance;
}//end Calc_PH_Distance() //***************************************************/




function Calc_PH_Angle_from_PH_Distance(side) { //*****************************/
	//Calculate the angle ($PHHA) between paired-holes.
	//Uses PCD and a user provided Paired-Hole distance ($PHHD).
	//sin(Î¸/2) = (d/2) / (PCD/2)
	//      Î¸  = 2 * asin(d/PCD)
	var radians = 2 * Math.asin($PHHD[side].value / $PCD[side].value);
	var degrees = radians * (180 / Math.PI);
	$PHHA[side].value = Round(degrees,2);
	return degrees;
}//end Calc_PH_Angle_from_PH_Distance(side) //*********************************/




function Calc_Spoke_Length(flange, spoke_id, round_to, elbows) { //************/
	//Calculate actual spoke length in 3-d space, including flange-to-center measurement..
	//elbows = +/- offset from flange centerline to spoke centerline (elbows out/in)

	if (!E(spoke_id)) { return '' }
	
	if (!round_to) { round_to = 1 } //decimal places.
	
	if (!elbows) { elbows = 0 }

	//Get spoke ends
	var x1 = E(spoke_id).getAttribute('x1');
	var y1 = E(spoke_id).getAttribute('y1');
	var x2 = E(spoke_id).getAttribute('x2');
	var y2 = E(spoke_id).getAttribute('y2');
	
	var dx = x2 - x1;
	var dy = y2 - y1;

	var ftc = $FTC[flange].value*1; //Final spoke length requires Flange to Center
	var osb = $OSB[flange].value*1; //and OSB...
	var w = ftc + osb + elbows;

	var S = Math.sqrt(w*w + dx*dx + dy*dy) - $SHD.value/2;

	return Round(S, round_to);
}//end Calc_Spoke_Length() //**************************************************/




function Calc_Spoke_Lengths(validate, changed, integer, allow_neg) { //********/
	//Calc spoke lengths for both sides. Used by onchange of OSB & SHD.

	if (validate) {
		if (!Validate_Input(changed, integer, allow_neg)) { return false }
		changed.prior_value = changed.value; //Also set in onfocus events and in Build_Wheel().
	}

	Update_Advanced_Info(validate); //if (validate == true) also saves settings

	//Odd spokes: 1, 3, 5, etc...
	$SL[1].value = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_1'); //SLC_spoke_(flange)_(hole)
	$SL[3].value = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_1');

	//Even spokes: 2, 4, 6, etc...
	$SL[2].value = Calc_Spoke_Length(1, SPOKE_ID_PREFIX + '1_2');
	$SL[4].value = Calc_Spoke_Length(2, SPOKE_ID_PREFIX + '2_2');

}//end Calc_Spoke_Lengths() //*************************************************/





function Spoke_Length_Calculator(f) { //***************************************/
	//Tradtional method for basic wheel lacings. Not currently used except for dev.
	//Not valid for paired hole, (some?) skip hole, and  maybe other configurations.

	var ftc = $FTC[f].value*1; //Final spoke length requires Flange to Center
	var osb = $OSB[f].value*1; //and OSB...
	var w = ftc + osb;

	var aR  = 360/$NR.value;    //angle between holes in Rim.
	var aF  = 360/$NF[f].value; //angle between holes in Flange.

	//"zero cross" adjustment angle for triplets. Fails for some skip-hole configs. Don't know why.
	//Valid if flange1 spokes + flange2 spokes == rim holes.
	if (($NR.value % $NF[f].value) == 0) { var a0 = 0 } else { var a0  = aR - aF/2; }

	var rR  = $ERD   .value/2;  //radius of Rim
	var rF  = $PCD[f].value/2;  //radius of Flange
	var aF1 = $SX[f].value*aF + $LACE_OPT.value*a0; //angle to spoke hole in flange from "vertical".
	var aF1_rad = aF1/180 * Math.PI; //aF1 in radians
	var cos_aF1 = Round(Math.cos( aF1_rad ), 4);

	var S = Math.sqrt(w*w + rR*rR + rF*rF - 2*rR*rF*cos_aF1) - $SHD.value/2;

	return Round(S, 1);
}//end Spoke_Length_Calculator() { //******************************************/




function Create_Spoke_Holes($hole_group, base_id, class1, class2, N, scale, shd, side, offset) { //***/
	//Create & position N spoke holes in <g id=group>, with radius of shd/2 (shd="spoke hole diameter")
	if (typeof offset == "undefined") { offset = 0 }

	var A = 360/N; //angle between holes

	var a = offset;	//angle to current hole from 0
	var cx, cy;		//coordinates for hole

	var odd = true;	//for alternating classes

	var holes = "";

	var phh      = $PH_HUB.checked;
	var standard = ($WHEEL_TYPE.value == "standard");
	var custom   = ($WHEEL_TYPE.value == "custom");
	var phha     = 0; //Paired-hole hub angle
	if (phh && (standard || custom)) {
		if ($hole_group != $RIM_HOLES) {
			var phha = (parseFloat($PHHA[side].value) - A);
		}
	}

	for (var sh = 1; sh <= N; sh++) {
		var full_id = base_id + sh;
		
		odd = !odd;	 //##### Not yet really utilized. (class1 always == class2)
		if (odd) { var class_X = class1; } else { var class_X = class2; }
		
		var classes = SPOKE_HOLES + " " + class_X;
		
		cx = Math.sin( (a/180) * Math.PI) * scale;
		cy = Math.cos( (a/180) * Math.PI) * scale;
		
		holes += '<circle id=' + full_id + ' class="' + classes + '" r="' + (shd/2) + '" cx="' + cx +'" cy="' + cy + '" />' + "\n";
		
		a += (A + phha); //Spoke hole 1 is first hole at or after 0 degrees/(6 o'clock), ccw.
		phha *= -1;      //For alternating spoke directions...
	}

	$hole_group.innerHTML = $hole_group.innerHTML + holes;

}//end Create_Spoke_Holes() //*************************************************/




function Add_Spoke(group, flange, flange_hole, rim_hole, color) { //***********/

	if (typeof color == "undefined") { color = "black" }

	var flange_hole_id = HUB_HOLE_ID_PREFIX + flange + HUB_HOLE_MESOFIX + flange_hole;
	var rim_hole_id	= RIM_HOLE_ID_PREFIX + rim_hole;

	var x1 = E(flange_hole_id).getAttribute('cx');
	var y1 = E(flange_hole_id).getAttribute('cy');
	var x2 = E(rim_hole_id).getAttribute('cx');
	var y2 = E(rim_hole_id).getAttribute('cy');

	var spoke_id = SPOKE_ID_PREFIX + flange + "_" + flange_hole;
	var classes = SPOKE_BASE_CLASS + ' ' + SPOKE_GROUP_PREFIX + group; //ex: 'SLC_spoke SLC_group1'
	var coords = ' x1="' + x1 +  '" y1="' + y1 +  '" x2="' + x2 +  '" y2="' + y2 +  '" ';
	var style = ' style="stroke:' + color + '"';

	var spoke = '<line id="' + spoke_id + '" class="' + classes+ '" ' + coords + style + '/>' + "\n";
	$SPOKES.innerHTML += spoke;

}//end Add_Spoke() //**********************************************************/




function Lacing_Modifier(f) { //*************************************************/
	/****************************************************../
	tl;dr: It's complicated...  :) 

	"Full" Explanation:
	In a triplet wheel, with a given spoke count & cross (just whether they're even/odd),
	there are two lace patterns possible: "Type 1" and "Type 2".  In wheels with standard 
	lace patterns (2x, 3x, etc), the two pattern types end up just being mirror images of 
	one another. 

	Well, those three options: even/odd spoke count, even/odd spoke cross, and lace type,
	presents us with a three body quatum paradoxical muonicly  gravitational relativistic 
	generational equatorial anti-matter plasmatic teseract.  And the effort to solve it 
	cost me many hours & much pounding of my head against a cinder block wall.
	Yes, many brain cells died to bring us this informtaiton...

	Anyway, for a consistent display of the wheel (spokes don't keep changing direction), and to determine
	the matching rim hole for a given flange hole, a modifier is needed,  either 1 or -1, depending on 
	the desired triplet type & other two conditions. But, it's not always the same. And sometimes it's 
	different, except when it's not...

	All 8 possible combinations (3 "bits": count, cross, type) and their resultant modifers are summerized 
	in the table below. 

	 NR SX T|          NR: Even or Odd Number of holes in the Rim
	 -------+--        SX: Even or Odd Spoke Cross
	 E  E  1|          T : Triplet Type (1 or 2)
	 O  E  1| M        M : Resultant Modifier (1 or -1)
	 E  O  2| 1
	 O  O  2|
	 -------+--     \ | /    | | |
	 E  O  1|        \|/     | | |   (The "middle spoke" is on the opposite flange.)
	 O  O  1| M       X      | | |  
	 E  E  2|-1      /|\     | | |  
	 O  E  2|       Type 1   Type 2 

	Now, in basic spoke calc math, it's much simpler, because all that matters is spoke cross - we
	don't care about the voodoo involved in determining matching spoke holes in space.  But here,
	holes matter. And space.  And time.  I think. I guess.  Maybe. I don't know.  But it works now!  :)

	Finally, in this program, this option is presented as "Lacing Option".  Also, it really only matters
	on the side with more spokes (ex: the 16 spoke side of an 8:16 triplet). 
	/******************************************************/


	var NRE = ($NR.value    % 2  == 0); // Even number of rim holes?
	var SXE = ($SX[f].value % 2  == 0); // Even Spoke cross?
	var T1  = ($LACE_OPT.value   == 1); // Triplet/Lacing Type 1?

	if ( (NRE && SXE && T1) || (!NRE && SXE && T1) || (NRE && !SXE && !T1) || (!NRE && !SXE && !T1) )
		 { return  1 } 
	else { return -1 }
}//end Lacing_Modifier() //******************************************************/




function Custom_Odd_NF(nf) { //************************************************/
	//Check if odd number of flange holes. Used while in "custom" mode.
	
	if ( (($WHEEL_TYPE.value == "custom") && (nf%2 != 0)) ) { return true; }
	return false;
}//end Custom_Odd_NF() { //****************************************************/




function Create_Spoke_Groups(g1, g2, nr, nf, sx, f, color ) { //***************/
	sx = Math.floor(sx);

	if (nf < 1) { return } //can't lace a spoke with no flange holes...

	var gn = g1; //Used to toggle between g1 & g2
	var d  = 1;  //Direction. ie: leading or trailing spokes.

	if (Custom_Odd_NF(nf) && f == 2 ) { d = -1 }


	var r_skip = nr/nf; //Normally 2, but can be 3 (flange 1), then 3/2 (flange 2) for triplets.

	//Flange 1 hole 1 aligns to rim hole 1.  Flange 2 hole 1 aligns to rim hole 2 (generally, if NF1 <= NF2)...
	if (f == 2) { var f_skip = r_skip/2 } else { var f_skip = 0 }

	for (var h_hole = 1; h_hole <= nf; h_hole += 1) {
		
		var r_hole = (h_hole-1 + sx*d*Lacing_Modifier(f)) * r_skip + 1 + f_skip
		
		r_hole = Round(r_hole) //Needed for triplets. I don't like it, but can't figure out another way...
		
		if (r_hole > nr) {r_hole -= nr;}
		if (r_hole <  1) {r_hole += nr;}
		
		//Make sure there's a hole in both rim & hub for the spoke
		if ((nr != 0) && (nf != 0)) { Add_Spoke(gn,  f,  h_hole,  r_hole ,  color[gn]); }
		
		if (gn == g2) { var gn = g1 } else { var gn = g2 }
		
		
		if (!Custom_Odd_NF(nf)) {
			d = -d; //toggle direction, aka leading/trailing spokes.
		}
		//Else, all spokes on side with odd spoke count laced same direction.
	}
}//end Create_Spoke_Groups() //************************************************/




function Make_Rim(save) { //***************************************************/
	//Adjust displayed rim radius so spoke ends only touch inner radius, not middle/actual radius.

	if ($ERD.value == 0) { return false; }
	var rim_radius = $ERD.value/2 + $RIM_LINE_SIZE.value/2 - .5;
	$RIM.setAttribute('r', rim_radius);
	$RIM.style['stroke']	= $RIM_COLOR.value;
	$RIM.style['stroke-width'] = $RIM_LINE_SIZE.value;
	
	if (save) { Save_Settings("display"); }
}//end Make_Rim() { //*********************************************************/




function Setup_Wheel(erd, nr, nf1, nf2, pcd1, pcd2, sx1, sx2, shd, spoke_colors) { /****/
	//shd, as used here, and in Create_Spoke_Holes(), only affects
	//the displayed spoke hole size, and not spoke length calcs.

	var AF1 = 360/nf1; //Angle between holes in Flange 1.
	var AF2 = 360/nf2; //Angle between holes in Flange 2.
	var offset_f1_f2 = AF2/2; //Offset angle between left & right hub flange holes. The radial side is "0".

	var phh      = $PH_HUB.checked;
	var standard = ($WHEEL_TYPE.value == "standard");
	var custom   = ($WHEEL_TYPE.value == "custom");
	if (phh && (standard || custom)) {
		var phha_offset1 = (AF1 - parseFloat($PHHA[1].value))/2;
		var phha_offset2 = (AF2 - parseFloat($PHHA[2].value))/2;
	}
	else { //triplets
		var phha_offset1 = 0;
		var phha_offset2 = 0;
	}

	var rotate = 0; //180 rotates wheel so that "spoke 1" is at 12 o'clock. Helped during dev. Now, not so much.

	//Draw basic rim & flange circles..
	var rim_radius = erd/2 + $RIM_LINE_SIZE.value/2 - .5;
	$RIM.setAttribute('r', rim_radius); //
	$FLANGE1.setAttribute('r', pcd1/2); //erd & pcd's are "D"iameters, but SVG <circle>'s require radii...
	$FLANGE2.setAttribute('r', pcd2/2); //

	var f1_prefix = HUB_HOLE_ID_PREFIX + "1" + HUB_HOLE_MESOFIX;
	var f2_prefix = HUB_HOLE_ID_PREFIX + "2" + HUB_HOLE_MESOFIX;
	Create_Spoke_Holes( $RIM_HOLES     , RIM_HOLE_ID_PREFIX , RIM_HOLE_CLASS, RIM_HOLE_CLASS, nr , erd/2 , shd, 0, 0);
	Create_Spoke_Holes( $FLANGE1_HOLES , f1_prefix, HUB_HOLE_CLASS, HUB_HOLE_CLASS, nf1, pcd1/2, shd, 1, phha_offset1);
	Create_Spoke_Holes( $FLANGE2_HOLES , f2_prefix, HUB_HOLE_CLASS, HUB_HOLE_CLASS, nf2, pcd2/2, shd, 2, (offset_f1_f2 + phha_offset2));

	//Drawing side 2 first puts side one spokes visually "on top".
	Create_Spoke_Groups(3, 4, nr, nf2, sx2, 2, spoke_colors); //Side 2
	Create_Spoke_Groups(1, 2, nr, nf1, sx1, 1, spoke_colors); //Side 1

	Set_Wheel_Styles_Spokes();
	Set_Wheel_Styles_Rim_etc()

	$G_WHEEL.setAttribute('transform', " rotate(" + rotate + ")");
}//end Setup_Wheel() /*********************************************************/




function Set_Wheel_Styles_Spokes() { //****************************************/
	for (var group = 1; group <= 4; group++) {
		Set_Style_by_Class( SPOKE_GROUP_PREFIX + group, "stroke-width", $SPOKE_LINE_SIZE[group].value);
		Set_Style_by_Class( SPOKE_GROUP_PREFIX + group, "stroke"      , $SPOKE_COLOR[group].value);
		Show_Hide_Class(SPOKE_GROUP_PREFIX + group, $SPOKE_SHOW[group].checked);
	}
}//end Set_Wheel_Styles_Spokes() { //******************************************/




function Set_Wheel_Styles_Rim_etc() { //***************************************/

	Make_Rim(); //Rim line size affects displayed rim radius.

	$FLANGE1.style['stroke'] = $F1_COLOR.value;
	$FLANGE2.style['stroke'] = $F2_COLOR.value;
	$FLANGE1.style['stroke-width'] = $F1_LINE_SIZE.value*1;
	$FLANGE2.style['stroke-width'] = $F2_LINE_SIZE.value*1;

	Set_Style_by_Class(SPOKE_HOLES, "fill", $HOLE_COLOR.value);

	Show_Hide_Class( SPOKE_HOLES, $HOLES_SHOW.checked);

	Set_Style_by_Class( AXIS_CLASS, 'stroke-width', $AXES_LINE_SIZE.value );
	Set_Style_by_Class( AXIS_CLASS, "stroke", $AXES_COLOR.value );
	Show_Hide_Class( AXIS_CLASS, $AXES_SHOW.checked );

	Show_Hide($RIM    , $RIM_SHOW.checked);
	Show_Hide($FLANGE1, $F1_SHOW.checked);
	Show_Hide($FLANGE2, $F2_SHOW.checked);
}//end Set_Wheel_Styles_Rim_etc() { //*****************************************/




function Clear_Wheel(all) { //*************************************************/
	//Clear built wheel, not wheel settings, in prep for a re-build with current/new settings.

	if (all){
		$RIM    .setAttribute('r', 0);
		$FLANGE1.setAttribute('r', 0);
		$FLANGE2.setAttribute('r', 0);
	}
	
	if (all || ($WHEEL_TYPE.value != "custom")) {
		$FLANGE1_HOLES.innerHTML = "";
		$FLANGE2_HOLES.innerHTML = "";
	}

	$RIM_HOLES.innerHTML = "";
	$SPOKES   .innerHTML = "";
	$SL[1].value = ''; //side 1, odd spokes
	$SL[2].value = ''; //side 1, even spokes
	$SL[3].value = ''; //side 2, odd spokes
	$SL[4].value = ''; //side 2, even spokes
	$SL_ADJ[1].value = ""; //Spoke lengths adjusted for elbows in/out.
	$SL_ADJ[2].value = ""; //
	$SPOKE_RATIO[1].value = '';
	$SPOKE_RATIO[2].value = '';
	$BRACE_ANGLE[1].value = '';
	$BRACE_ANGLE[2].value = '';
	$TENSION_RATIO[1].value = '';
	$TENSION_RATIO[2].value = '';
	$TENSION[1].value = ''; //[1] is a user setting, and is cleared in Clear_Settings().
}//end Clear_Wheel() //********************************************************/




function Build_Wheel(save) { //************************************************/

	if (save) { Save_Settings("wheel"); }

	Clear_Wheel(true);

	//If no rim and no flangees, can't build any spokes, as they'd be 0 length...
	if ($ERD.value == 0 && $PCD[1].value == 0 && $PCD[2].value == 0) { return false; }

	var Spoke_Colors = ["", $SPOKE_COLOR[1].value, $SPOKE_COLOR[2].value,  $SPOKE_COLOR[3].value, $SPOKE_COLOR[4].value ];

	//Setup_Wheel(ERD, NR, NF1, NF2, PCD1, PCD2, SX1, SX2, SHD, Spoke_Colors)
	Setup_Wheel( $ERD.value*1, $NR.value*1, $NF[1].value*1, $NF[2].value*1,
				 $PCD[1].value*1, $PCD[2].value*1, $SX[1].value*1, $SX[2].value*1,
				 $HOLE_SIZE.value*1, Spoke_Colors
				);

	Calc_Spoke_Lengths(); //and Update_Advanced_Info();

	//Are all spokes on each side the same length? (Only check first two.)
	if ( (($NF[1].value < 2) || ($SL[1].value == $SL[2].value)) && ($SL[3].value == $SL[4].value))
		 { $SL_2_4.style['display'] = "none";      } //Yes   Well, the first two are, at least.
	else { $SL_2_4.style['display'] = "table-row"; } //No

	//##### #########################
	//##### Log(Spoke_Length_Calculator(1) + " : " + Spoke_Length_Calculator(2), 1);//#####

}//end Build_Wheel() //********************************************************/




function Error_Notice($input, msg, init) {//*************************************/
	//$input: input element with invalid input.

	if ($input) { //Position $MSG_BOX just below $input.
		var coords = $input.getBoundingClientRect();
		$MSG_BOX.style['top']  = Round(coords.top)  + window.pageYOffset + "px";
		$MSG_BOX.style['left'] = Round(coords.left) + window.pageXOffset - 230 + "px";
	}

	if ((typeof msg) == 'undefined') { msg = "" }

	if (typeof $input == "object") {
		if (!init && ($input.tagName == "INPUT")) { msg = MSGS['invalid'] + ' "' + $input.value + '"<br>' + msg; }
		PRIOR_FOCUS = $input.id;
	}

	$MESSAGE_DIV.innerHTML = msg;
	$MSG_BOX.style['visibility'] = "visible"; 

	if (init == "init") {
		//Set a couple styles just for init. Reset in Close_Message().
		$MSG_BOX.style['text-align'] = "left";
		$MSG_BOX.style['top']  = (window.pageYOffset + 50) + "px";
		$MSG_BOX.style['left'] = (window.pageXOffset + 50) + "px";
		$CLOSE_MSG.style['visibility'] = "hidden";
		$ACCEPT_MSG.style['display']   = "";
		$ACCEPT_MSG.focus();
		$MSG_BOX.scrollIntoView();
	}
	else {
		$CLOSE_MSG.style['visibility'] = "";
		$ACCEPT_MSG.style['display'] = "none"; 
		//setTimeout needed when changing wheel "Type", if there's a msg. I don't know why.
		setTimeout(function() { $CLOSE_MSG.focus() },55);
	}
}//end Error_Notice() //*******************************************************/




function Close_Message() { //**************************************************/
	$MSG_BOX.style['visibility'] = "hidden";
	$MESSAGE_DIV.innerHTML = "";
	if (E(PRIOR_FOCUS).tagName == "INPUT") { E(PRIOR_FOCUS).select() }
	E(PRIOR_FOCUS).focus();
	$MSG_BOX.style['text-align'] = ""; //Restore values to style sheet from those 
	$MSG_BOX.style['top']        = ""; //used for the init msg/disclaimer.
	$MSG_BOX.style['left']       = "";
}//end Close_Message() { //****************************************************/




function Set_SX() { //*********************************************************/
	//Set practical default cross values for most flange hole counts, even impractical ones.
	//User can change SX manually if desired.

	if ($WHEEL_TYPE.value == "custom") { return; }

	if ($NF[2].value*1 <  4) { $SX[2].value = 0 } else
	if ($NF[2].value*1 < 10) { $SX[2].value = 1 } else
	if ($NF[2].value*1 < 16) { $SX[2].value = 2 } else
	if ($NF[2].value*1 < 20) { $SX[2].value = 3 } else
	if ($NF[2].value*1 < 26) { $SX[2].value = 4 } else
	if ($NF[2].value*1 < 36) { $SX[2].value = 5 } else
							 { $SX[2].value = 6 }
	
	if ($WHEEL_TYPE.value == "standard") {
		$SX[1].value = $SX[2].value;
		if ($PH_HUB) { Set_phh_Lace_Opt(); }
	}
	else if ($WHEEL_TYPE.value == "triplet")  { $SX[1].value = 0; }
}//end Set_SX() { //***********************************************************/




function Set_NF(nr_value) { //*************************************************/
	//Do not call while *in* "custom" mode.

	$NF[1].prior_value = $NF[1].value;
	$NF[2].prior_value = $NF[2].value;

	if ($WHEEL_TYPE.value == "standard" || $WHEEL_TYPE.value == "phh") {
		
		//Cooresponding NF's required for a given NR.
		$NF[1].value = nr_value/2;
		$NF[2].value = nr_value/2;
		
	} else
	if ($WHEEL_TYPE.value == "triplet") {
		
		//Cooresponding NF's required for a given NR.
		$NF[1].value = nr_value/3;
		$NF[2].value = $NF[1].value*2;
		
	}//end if ($WHEEL_TYPE.value...)


	if ($WHEEL_TYPE.value == "custom") { return; }
	
	//For Standard & Triplet modes
	$NF[1].disabled = true;
	$NF[2].disabled = true;

}//end Set_NF() { //***********************************************************/




function SX_Enable_Disable(f) { //*********************************************/
	//Generally, spoke cross must be 0 if NF is odd.

	if ($WHEEL_TYPE.value == "custom") { return }

	if ($NF[f].value%2 == 0)	{ //even hole count
		$SX[f].disabled = false;
	}
	else {					  //odd
		$SX[f].disabled = true;
		$SX[f].value = 0;
	}
}//end SX_Enable_Disable() { //************************************************/




function Validate_NR() { //****************************************************/
	//Acutal validation of NR is no longer needed (NR is now a <select>), but some other checks are.

	Set_NF($NR.value);

	Build_SX_Options($WHEEL_TYPE.value, 1, $NF[1].value, $SX[1].value);
	Build_SX_Options($WHEEL_TYPE.value, 2, $NF[2].value, $SX[2].value);

	Set_SX();

	//If NF is odd, cross can only be 0. (Except in "custom" mode.)
	SX_Enable_Disable(1);

	if (($WHEEL_TYPE.value == 'standard') && $PH_HUB.checked)
		 { $SX[2].disabled = true; }
	else { SX_Enable_Disable(2)  ; }

	if ($NR.value*1 > 0) { return true } //Build_Wheel() on return

	//Else if NR==0, clear the spokes, rim holes, & various spoke length results.
	$NR.prior_value = $NR.value;

	Clear_Wheel(); //all except the rim & flanges, and the flange holes if in custom mode.

	Save_Settings("wheel");

	return false; //No spokes, so can't Build_Wheel().

}//end Validate_NR() { //******************************************************/




function Validate_NF(f) { //***************************************************/
	var error = false;

	if (isNaN($NF[f].value)) { $NF[f].value = $NF[f].prior_value; return false; }

	if ($NF[f].value*1 > MAX[$NF[f].id]) {
		var msg = MSGS['max_fl'] + MAX[$NF[f].id] + ".<br>";
		error = true;
	}

	//##### Figure out how to make this not needed (how flange-rim holes are matched up).
	if ( $NF[1].value*1 > $NF[2].value*1) { //Things mess up...
		if (f==1) { var msg = MSGS['nf1_2']; }
		else 	  { var msg = MSGS['nf2_1']; }
		error = true;
	}

	if (error) {
		Error_Notice($NF[f], msg);
		$NF[f].value = $NF[f].prior_value;
		return false;
	}

	Build_SX_Options($WHEEL_TYPE.value, f, $NF[f].value, $SX[f].value);
	SX_Enable_Disable(f);

	$NF[f].prior_value = $NF[f].value;
	return true;
}//end Validate_NF() //********************************************************/




function Validate_PHHA(side) { //**************************************************/
	//Angles larger than 1/2 of the angles for evenly spaced holes just mirrors effects up to that point,
	//but crosses the spokes in paired holes. Which is bad.
	if (Validate_Input($PHHA[side])) {
		if ($WHEEL_TYPE.value != "custom") {
			var angle        = parseFloat($PHHA[side].value);
			var even_spaced  = 360 / parseFloat($NF[side].value);
			if (angle > even_spaced) { $PHHA[side].value = even_spaced; }
		}
		return true;
	}
	return false;
}//end Validate_PHHA() //******************************************************/




function Validate_Input($input, integer, allow_neg) { //************************/
	var error = false;

	$input.value = $input.value.trim();

	if ($input.value != "") {
		if (integer) { $input.value = parseInt($input.value); }
		else 		 { $input.value = parseFloat($input.value); }
	}

	if (isNaN(parseFloat($input.value)))    { error = true; } else 
	if (!allow_neg && ($input.value*1 < 0)) { error = true; } //Currently, only OC can be negative.

	if (error) {
		if (isNaN(parseFloat($input.prior_value))) { $input.prior_value = 0; }
		$input.value = $input.prior_value;
		return false;
	}

	$input.prior_value = $input.value;

	return true;
}//end Validate_Input() { //***************************************************/




function Setup_Viewbox() { //**************************************************/

	var view_box_size = DEFAULT_OPTIONS['SCALE_fixed'];

	var erd = $ERD.value*1;
	var rim = $RIM_LINE_SIZE.value*1;
	$SCALE_auto.value = (erd + rim * 2);

	if ($SCALE_MODE.value == 'fixed') { view_box_size = parseInt($SCALE_fixed.value); }
	else {
		if ($ERD.value == 0) { ; }
		else                 { view_box_size = $SCALE_auto.value; }
	}

	view_box_size = Round(view_box_size);
	
	
	//Setup viewbox...
	var view_W = view_box_size; //Width
	var view_H = view_box_size; //Height
	var V_offset = (-view_H/2); //Vertical Offset
	var H_offset = (-view_W/2); //Horizontal Offset

	$SVG_WHEEL.setAttribute('viewBox', H_offset + " " + V_offset + " " + view_W + " " + view_H);

	//Set xy axis...
	var max_XY = view_box_size/2;
	$X_axis.setAttribute('x1', -max_XY);
	$X_axis.setAttribute('y1', 0);
	$X_axis.setAttribute('x2',  max_XY);
	$X_axis.setAttribute('y2', 0);

	$Y_axis.setAttribute('x1', 0);
	$Y_axis.setAttribute('y1', -max_XY);
	$Y_axis.setAttribute('x2', 0);
	$Y_axis.setAttribute('y2',  max_XY);

	return view_box_size;
}//end Setup_Viewbox() { //****************************************************/




function Show_Hide_Class(classname, show, save, style) { //********************/
	//save should either be 'display', 'wheel', or falsey (usually null)
	var items = D.getElementsByClassName(classname);
	for (var s = 0; s < items.length; s++) { Show_Hide(items[s], show, false, style) }
	if (save) { Save_Settings(save); }
}//end Show_Hide_Class() //****************************************************/

	


function Show_Hide(what, show, save, style) { //*******************************/

	if (style == 'visibility') {
		if (show) { what.style.visibility = ""     }
		else 	  { what.style.visibility = "hidden" }
	}
	else {
		if (show) { what.style.display = ""     }
		else 	  { what.style.display = "none" }
	}

	if (save) { Save_Settings("display"); }
}//end Show_Hide() //**********************************************************/




function Scroll_Into_View(target, extra) { //**********************************/
	//Only scroll if target display is !=none, and 
	//if the top of the element is not visible in the window.

	if (target.style['display'] == "none") { return; }

	var rect = target.getBoundingClientRect();

	//window contents scroll down if off the top...
    if (rect.top < extra) { window.scrollBy(0, rect.top - extra); return; }


	var viewable_amount = window.innerHeight - rect.top;
	var min_top_visible = 150; //Scroll this much of element into view, if less than this amount.

	//window contents scroll up if off the bottom...
    if (viewable_amount < min_top_visible) { window.scrollBy(0, min_top_visible - viewable_amount); }

}//end Scroll_Into_View() { //*************************************************/




function Set_Style_by_Class(classname, style, value, save) { //****************/
	var objects = D.getElementsByClassName(classname);
	for (var s = 0; s < objects.length; s++) { objects[s].style[style] = value; }

	if (save) { Save_Settings("display"); }

}//end Set_Style_by_Class() //*************************************************/




function Set_Save_Style(element, style, value) { //****************************/
	element.style[style] = value;
	Save_Settings("display"); 
}//end Set_Save_Style() //*****************************************************/




function Set_Attribute_by_Class(classname, attribute, value) { //**************/
	var objects = D.getElementsByClassName( classname );
	for (var x = 0; x < objects.length; x++) { objects[x].setAttribute( attribute, value ); }
}//end Set_Attribute_by_Class() //*********************************************/




function Set_phh_Lace_Opt() { //***********************************************/
	//With phh, the spokes in paired holes must pull away from each other, or the flange could fail.
	//So, set LACE_OPT, based on spoke cross (1, 2, 3, etc...), so that spokes in paired holes do not cross each other.
	//For absurdly low spoke count wheels (<12), this may be unneccessary, but deal with that in custom mode.
	$SX[2].value = $SX[1].value; 
	var sx_even  = ($SX[1].value  % 2) == 0;
	if (sx_even) { $LACE_OPT.value = -1; }
	else         { $LACE_OPT.value = 1;  }
}//end Set_phh_Lace_Opt() //***************************************************/




function Setup_Wheel_Type(init) { //*******************************************/
	//Adjust/set NR, NF, & SX as needed for each type(mode) -  (standard/triplet/custom).
	//And now paired-hole options...

	var nr_new = $NR.value*1;

	var standard = ($WHEEL_TYPE.value == "standard");
	var triplet  = ($WHEEL_TYPE.value == "triplet");
	var custom   = ($WHEEL_TYPE.value == "custom");


	if (standard) {  //NR can only be dividible by 4.
		var nr_mod4 = nr_new % 4;
		if (nr_mod4 != 0) { nr_new += (4 - nr_mod4); } //"round up" if not div/4.
		
		Show_Hide_Class(PHH_OPTIONS, $PH_HUB.checked);
		$SETTINGS.style['background-color'] = BG_STANDARD;
	}




	if (triplet) { //NR must be divisible by 3
		var nr_mod3 = nr_new % 3;
		if (nr_mod3 != 0) { nr_new += (3 - nr_mod3); } //"round up" if not div/3.
		
		Show_Hide_Class(PHH_OPTIONS, false);
		$SETTINGS.style['background-color'] = BG_TRIPLET;
	}

	Build_NR_Options($WHEEL_TYPE.value, MAX[$NR.id], nr_new);

	if (standard || custom) { $ph_container.style.visibility = ""; }
	else                    { $ph_container.style.visibility = "hidden"; }


	$LACE_OPT.disabled = false;

	if (!custom) {
		Set_NF(nr_new); //must come before $PHHA & $SX are set.
		
		if ($PH_HUB.checked) { 
			Validate_PHHA(1); //In case we just changed from custom mode...
			$PHHA[2].value = $PHHA[1].value;
			$PHHA[2].disabled = true;
			$PHHD[2].disabled = true;
			if (!triplet) { $LACE_OPT.disabled = true; }
		}
		
		Build_SX_Options($WHEEL_TYPE.value, 1, $NF[1].value, $SX[1].value);
		Build_SX_Options($WHEEL_TYPE.value, 2, $NF[2].value, $SX[2].value);
		
		if (init != "init") {
	 		Set_SX();
			
			SX_Enable_Disable(1);
			SX_Enable_Disable(2);
		}
		
		if ($PH_HUB.checked && standard) { $SX[2].disabled = true; }
		
		Enable_Set_Hub_Auto_Angles();
		
		return true; //Build_Wheel() on return
	}


	//else custom...
	var f = 1;
	Build_SX_Options($WHEEL_TYPE.value, f, $NF[f].value, $SX[f].value);
	$NF[f].disabled = false;
	$SX[f].disabled = false;

	var f = 2;
	Build_SX_Options($WHEEL_TYPE.value, f, $NF[f].value, $SX[f].value);
	$NF[f].disabled = false;
	$SX[f].disabled = false;

	$PHHA[2].disabled = false;
	$PHHD[2].disabled = false;

	Enable_Set_Hub_Auto_Angles();
	
	Show_Hide_Class(PHH_OPTIONS, $PH_HUB.checked);
	$SETTINGS.style['background-color'] = BG_CUSTOM;
	
	return false; //No need to Build_Wheel(), as no wheel values have changed.

}//end Setup_Wheel_Type() { //*************************************************/




function Set_Scale_Mode(_default) { //*****************************************/
	if (_default) {
		$SCALE_MODE .value = DEFAULT_OPTIONS['SCALE_MODE'];
		$SCALE_fixed.value = DEFAULT_OPTIONS['SCALE_fixed'];
	}
	if ($SCALE_MODE.value == "auto") {
		$SCALE_fixed.disabled = true;
		$SCALE_auto.style['display'] = "";
		$SCALE_fixed.style['display'] = "none";
	}
	else /***                fixed*/ {
		$SCALE_fixed.disabled = false;
		$SCALE_auto .style['display'] = "none";
		$SCALE_fixed.style['display'] = "";
	}
}//end Set_Scale_Mode() //*****************************************************/




function Reset_Scale() { //****************************************************/
	Set_Scale_Mode(true);
	Setup_Viewbox();
	Save_Settings("display");
}//end Reset_Scale() //********************************************************/




function Reset_OPTIONS_SPOKES() { //*******************************************/
	Load_DEFAULT_OPTIONS_Spokes();
	Set_Wheel_Styles_Spokes();
	Save_Settings("display");
}//end Reset_OPTIONS_SPOKES() //***********************************************/




function Reset_OPTIONS_RIM_ETC() { //******************************************/
	Load_DEFAULT_OPTIONS_Rim_etc();
	Set_Wheel_Styles_Rim_etc();
	Set_Attribute_by_Class( RIM_HOLE_CLASS, 'r', $HOLE_SIZE.value/2);
	Set_Attribute_by_Class( HUB_HOLE_CLASS, 'r', $HOLE_SIZE.value/2);
	Save_Settings("display");
}//end Reset_OPTIONS_RIM_ETC() //**********************************************/




function Enable_Set_Hub_Auto_Angles() {
	var custom      = ($WHEEL_TYPE.value == "custom");
	var auto_angles = $HUB_AUTO_ANGLES.value;
	
	function Set_Auto_Angles(side) {
		if (auto_angles == 'even') {
			$PHHD[side].disabled = true;
			$PHHA[side].disabled = true;
			$PHHA[side].value = 360 / $NF[side].value;
		} else
		if (auto_angles == 'half') {
			$PHHD[side].disabled = true ;
			$PHHA[side].disabled = true ;
			$PHHA[side].value = 360 / $NF[side].value / 2;
		} else
		if (auto_angles == 'off' ) {
			$PHHA[side].disabled = false;
			$PHHD[side].disabled = false;
		} else {
			// Should never happen, but I'm human...
			var msg  = $HUB_AUTO_ANGLES.id + 'change event<br>"' + auto_angles + '" is invalid';
			Error_Notice('', msg);
			return false;
		}
	}//end Set_Auto_Angles()
	
	Set_Auto_Angles(1);
	if (custom) { Set_Auto_Angles(2); }
	else        { $PHHA[2].value = $PHHA[1].value; }
	
	Calc_PH_Distance(1);
	Calc_PH_Distance(2);
}//end Enable_Set_Hub_Auto_Angles()




function IMEX_enable_disable(enable, $imex_container) {
	//When (enable == true),  show import/export window, and "disable" & "dim out" The Wheel Maker.
	//  ie: disable inputs & <a>'s so that only import/export buttons (etc) take focus.
	//Undo all that when !enable.

	if (enable) {
		$CONTAINER.classList.add(_NS_ + "imex_mode");
		var display  = "block";
		var tabindex = "-1";
		var tf       = true ;
	}
	else {
		$CONTAINER.classList.remove(_NS_ + "imex_mode");
		var display  = "none";
		var tabindex = "";
		var tf       = false;
	}


	if (enable) { window.scroll(0,0); } //Must come afer $CONTAINER display is set (via added .classlist.add/remove).

	$imex_container.style.display = display;

	var anchors = document.getElementsByTagName('A');
	for (var a = 0; a < anchors.length; a++) { anchors[a].tabIndex = tabindex; }

	//Most <inputs> and <selects> (except for $CURRENT_WHEEL).
	for (var id in DEFAULT_VALUES)  { E(_NS_ + id).disabled = tf; }
	for (var id in DEFAULT_OPTIONS) { E(_NS_ + id).disabled = tf; }

	//The only <select> that's neither a wheel value nor a display option.
	$CURRENT_WHEEL.disabled = tf;

	//Can ya' guess what's next??
	var buttons = document.getElementsByTagName('BUTTON');
	for (var b = 0; b < buttons.length; b++) {
		//but skip these, 'cause we need these...
		if (buttons[b].id == $PERFORM_IMPORT.id    || 
			buttons[b].id == $CLOSE_IMPORT.id      ||
			buttons[b].id == $COPY_TO_CLIPBOARD.id ||
			buttons[b].id == $CLOSE_EXPORT.id)
		{ continue; }
		
		buttons[b].disabled = tf;
	}

	if (!enable) { $CURRENT_WHEEL.focus(); }
}//end IMEX_enable_disable()




function Check_if_Disclaimer_Accepted(target) { //*****************************/
	//Disclaimer - check cookies to see if already accepted.
	//Why? I don't know, it was really late, and seemed like a good idea at the time...
	
	$ACCEPT_MSG.value = "false"; //initialize [I Accept] button value.
	var COOKIES = D.cookie.split("; ");
	for (var x = 0; x < COOKIES.length; x++) {
		COOKIES[x] = COOKIES[x].split("=");
		if (COOKIES[x][0] == $ACCEPT_MSG.id) {
			if (COOKIES[x][1] == "true") { $ACCEPT_MSG.value = "true"; }
			break; //There can be only one...
		}
	}


	//Set inital focus or show disclaimer
	if (!$ACCEPT_MSG.ENABLED || $ACCEPT_MSG.value == "true") { target.focus(); }
	else {
		Error_Notice(target, MSGS['notice'] + $RESPONSIBILITY.innerHTML, 'init');
	}
}//end Check_if_Disclaimer_Accepted() //***************************************/




function Assign_Events() { //**************************************************/

	D.addEventListener("keydown", function(event){Scroll_Blur(event)} );


	//Save current value (as .prior_value) onfocus for <input type=text>s in case of error in new value.
	var settings = [$WHEEL_TYPE, $PHHA[1], $PHHA[2], $ERD, $NR, $NF[1], $NF[2], $PCD[1], $PCD[2], $FTC[1], $FTC[2], $OSB[1], $OSB[2], $SHD, $FW, $SDB, $TENSION[2], $SCALE_fixed, $SPOKE_LINE_SIZE[1], $SPOKE_LINE_SIZE[2], $SPOKE_LINE_SIZE[3], $SPOKE_LINE_SIZE[4], $RIM_LINE_SIZE, $F1_LINE_SIZE, $F2_LINE_SIZE, $AXES_LINE_SIZE, $HOLE_SIZE ];
	for (var x = 0; x < settings.length; x++) {
		settings[x].addEventListener("focus", function() {
			if ($ACCEPT_MSG.ENABLED && $ACCEPT_MSG.value != "true") { $ACCEPT_MSG.focus(); }
			this.prior_value = this.value; //also set in Build_Wheel() and in Calc_Spoke_Lengths().
		});
	}



	$CURRENT_WHEEL.addEventListener("change", function() {
		
		var prior_wheel = localStorage.getItem(LS_CURRENT_WHEEL) * 1; //1, 2, 3, etc...
		if (isNaN(prior_wheel)) { prior_wheel = 1; }
		if (prior_wheel < 1)    { prior_wheel = 1; }
		if (prior_wheel > MAX_WHEELS) { prior_wheel = MAX_WHEELS; }	
		this.prior_value = prior_wheel;
		
		localStorage.setItem(LS_CURRENT_WHEEL, this.value);
		
		var current_wheel_found = ((LS_VALUES_PREFIX + $CURRENT_WHEEL.value      ) in localStorage);
		var prior_wheel_found   = ((LS_VALUES_PREFIX + $CURRENT_WHEEL.prior_value) in localStorage);
		
		if(current_wheel_found) {
			//Temp <select> lists until any saved settings loaded. NR & SX will then be rebuilt in Setup_Wheel_Type().
			Build_NR_Options("custom", MAX[$NR.id], 0);
			Build_SX_Options("custom", 1, MAX[$NR.id], 0);
			Build_SX_Options("custom", 2, MAX[$NR.id], 0);
			Load_Saved_Settings(LS_VALUES_PREFIX + $CURRENT_WHEEL.value);
			Validate_Wheel_Settings('', true);
			Setup_Wheel_Type();
			Build_Wheel();
			Setup_Viewbox();
		} else if (($AUTO_COPY.checked) && prior_wheel_found) { //copy prior wheel to new wheel
			Save_Settings("wheel", 'copy');//saves current settings to new 
		} else {
			Clear_Settings()
		}
	});

	
	$CURRENT_WHEEL.addEventListener("keypress", function(event) {
		Normalize_Event(event);
		//Yes, both blur() & focus() are needed...
		if(event.key_code == 13) {
			D.activeElement.blur();
			$WHEEL_NAME.style['visibility'] = "visible";
			$WHEEL_NAME.focus();
		}
	});


	$WHEEL_NAME.addEventListener("keypress", function(event) {
		Normalize_Event(event);
		//Yes, both blur() & focus() are needed...
		if(event.key_code == 13) { D.activeElement.blur(); $CURRENT_WHEEL.focus(); }
	});


	$WHEEL_NAME.addEventListener("blur" , function(event) {
		$WHEEL_NAME.style['visibility'] = "hidden";
		$CURRENT_WHEEL.focus();
	});


	$WHEEL_NAME.addEventListener("change", function() {
		this.value   = this.value.trim();
		this.current = this.value;
		var current_wheel = $CURRENT_WHEEL.value;
		var option = $CURRENT_WHEEL.options[current_wheel - 1]; //CURRENT_WHEEL counts from 1, options from 0.
		option.innerHTML = Pad10(current_wheel) + SSI + $WHEEL_NAME.value;
		Save_Settings("wheel", 'name');
	});


	$RENAME_WHEEL.onclick = function() {
		$WHEEL_NAME.style['visibility'] = "visible";
		$WHEEL_NAME.focus();
	}

	
	$LOAD_SAMPLES  .addEventListener("click", function() { Load_Samples()   });
	$CLEAR_SETTINGS.addEventListener("click", function() { Clear_Settings() });

	$WHEEL_TYPE.addEventListener("change", function() {
		if (Setup_Wheel_Type()) { Build_Wheel() }
		Save_Settings("wheel");
	});


	var save = true; //Just for clarity below, as some functions have an option to save settings.

	$PH_HUB.addEventListener("click", function() {
		var standard = ($WHEEL_TYPE.value == "standard");
		var custom   = ($WHEEL_TYPE.value == "custom");
		
		if ($PH_HUB.checked) { Enable_Set_Hub_Auto_Angles(); }
		
		if ($PH_HUB.checked && standard) {
			Set_phh_Lace_Opt();
			$SX[2].disabled = true;
			$LACE_OPT.disabled = true;
			}
		else {
			$SX[2].disabled = false;
			$LACE_OPT.disabled = false;
		}
		Show_Hide_Class(PHH_OPTIONS, this.checked);
		Build_Wheel(save);
	});


	$HUB_AUTO_ANGLES.addEventListener("change", function() {
		var custom = ($WHEEL_TYPE.value == "custom");
		Enable_Set_Hub_Auto_Angles();
		Build_Wheel(true);
	});


	$PHHA[1].addEventListener("change", function() {
		if (Validate_PHHA(1)) {
			if ($WHEEL_TYPE.value != "custom") {
				$PHHA[2].value = $PHHA[1].value;	
				Calc_PH_Distance(2)
			}
			Build_Wheel(save);
		}
		Calc_PH_Distance(1);
	});

	$PHHA[2].addEventListener("change", function() {
		if (Validate_PHHA(2)) { Build_Wheel(save); }
		Calc_PH_Distance(2);
	});

	$PHHD[1].addEventListener("change", function() {
		if (Validate_Input(this)) {
			if ($WHEEL_TYPE.value != "custom") {
				$PHHD[2].value = $PHHD[1].value;	
				Calc_PH_Angle_from_PH_Distance(2)
			}
			Build_Wheel(save);
		}
		Calc_PH_Angle_from_PH_Distance(1)
	});

	$PHHD[2].addEventListener("change", function() {
		if (Validate_Input(this)) { Build_Wheel(save); }
		Calc_PH_Angle_from_PH_Distance(2);
	});

	$ERD.addEventListener("change", function() { if (Validate_Input(this)) { Build_Wheel(save); Setup_Viewbox(); } });

	$NR.addEventListener("change", function() {
		if (Validate_NR()) {
			var custom = ($WHEEL_TYPE.value == "custom");
			Enable_Set_Hub_Auto_Angles();
			Build_Wheel(true);
		}
	});

	$NF[1]   .addEventListener("change", function() {
		if (Validate_NF(1)) {
			if (!$PH_HUB.checked) {
				//If custom angles not enabled, set default
				$PHHA[1].value = 360 / parseFloat(this.value);
			}
			
			var custom = ($WHEEL_TYPE.value == "custom");
			Enable_Set_Hub_Auto_Angles();
			Build_Wheel(true);
		}
	});

	$NF[2]   .addEventListener("change", function() {
		//By default, $NF[2] is only available in custom mode...
		if (Validate_NF(2)) {
			if (!$PH_HUB.checked) {
				//If custom angles not enabled, set default
				$PHHA[2].value = 360 / parseFloat(this.value);
			}
			
			var custom = ($WHEEL_TYPE.value == "custom");
			Enable_Set_Hub_Auto_Angles();
			Build_Wheel(true);
		}
	});

	$PCD[1]  .addEventListener("change", function() { if (Validate_Input(this)) { Build_Wheel(save); } Calc_PH_Distance(1); });
	$PCD[2]  .addEventListener("change", function() { if (Validate_Input(this)) { Build_Wheel(save); } Calc_PH_Distance(2); });
	$FTC[1]  .addEventListener("change", function() { if (Validate_Input(this)) { Build_Wheel(save); } });
	$FTC[2]  .addEventListener("change", function() { if (Validate_Input(this)) { Build_Wheel(save); } });

	$SX[1]   .addEventListener("change", function() {
		if ($PH_HUB.checked && ($WHEEL_TYPE.value != "custom")) {
			Set_phh_Lace_Opt();
		}
		Build_Wheel(save);
	});

	$SX[2]   .addEventListener("change", function() { Build_Wheel(save); });
	$LACE_OPT.addEventListener("change", function() { Build_Wheel(save); });

	// Only need to recalc final spoke lengths. OSB & SHD are ignored in display calculations for <line> endpoints.
	var validate = true;
	$OSB[1]	  .addEventListener("change", function() { Calc_Spoke_Lengths(validate, this, 0, 1); }); //4th param, 1, allows neg numbers.
	$OSB[2]	  .addEventListener("change", function() { Calc_Spoke_Lengths(validate, this, 0, 1); });
	$SHD	  .addEventListener("change", function() { Calc_Spoke_Lengths(validate, this, 0, 0); });

	$FW 	   .addEventListener("change", function() { if (Validate_Input(this)) { Update_Advanced_Info(save); } });
	$SDB	   .addEventListener("change", function() { if (Validate_Input(this)) { Update_Advanced_Info(save); } });
	$ELBOWS[1] .addEventListener("change", function() { Update_Advanced_Info(save); });
	$ELBOWS[2] .addEventListener("change", function() { Update_Advanced_Info(save); });
	$TENSION[2].addEventListener("change", function() {
		if (!Validate_Input(this)) { return false; }
		$TENSION[1].value = Round(this.value * $TENSION_RATIO[1].value / 100);
		Save_Settings("wheel");
	});


	$SHOW_HIDE_ADVANCED.addEventListener("click", function() { Show_Hide_Options(this, $ADVANCED_INFO	, "inline-block"); });
	$SHOW_HIDE_DO      .addEventListener("click", function() { Show_Hide_Options(this, $DISPLAY_OPTIONS	, "inline-block"); });
	$SHOW_HIDE_NOTES   .addEventListener("click", function() { Show_Hide_Options(this, $NOTES			, "inline-block"); });
	$SHOW_HIDE_OTHER   .addEventListener("click", function() { Show_Hide_Options(this, $OTHER_CALCS		, "inline-block"); });
	$SEE_NOTES         .addEventListener("click", function() { Advanced_Build_Notes_btn();} );


	$SHOW_SIDE[1].addEventListener("click", function() {
		$SPOKE_SHOW[1].checked = this.checked;
		$SPOKE_SHOW[2].checked = this.checked;
		Show_Hide_Class( SPOKE_GROUP_PREFIX + 1, this.checked, 'display');
		Show_Hide_Class( SPOKE_GROUP_PREFIX + 2, this.checked, 'display');
	} );

	$SHOW_SIDE[2].addEventListener("click", function() {
		$SPOKE_SHOW[3].checked = this.checked;
		$SPOKE_SHOW[4].checked = this.checked;
		Show_Hide_Class( SPOKE_GROUP_PREFIX + 3, this.checked, 'display');
		Show_Hide_Class( SPOKE_GROUP_PREFIX + 4, this.checked, 'display');
	} );

	for (var group = 1; group <= 4; group++) {
		(function(g) {
			$SPOKE_COLOR[g]    .addEventListener("change", function() { Set_Style_by_Class( SPOKE_GROUP_PREFIX + g, "stroke", this.value, save); });
			$SPOKE_LINE_SIZE[g].addEventListener("change", function() {
				if (Validate_Input(this)) {
					Set_Style_by_Class( SPOKE_GROUP_PREFIX + g, "stroke-width", this.value, save);
				}
			});
			$SPOKE_SHOW[g]     .addEventListener("change", function() { 
				Show_Hide_Class( SPOKE_GROUP_PREFIX + g, this.checked, 'display');
				var side = Round(g/2); //side 1 or 2
				if (side == 1) { 
					$SHOW_SIDE[1].checked = false;
					if ($SPOKE_SHOW[1].checked || $SPOKE_SHOW[2].checked) { $SHOW_SIDE[1].checked = true }
				}
				else {
					$SHOW_SIDE[2].checked = false;
					if ($SPOKE_SHOW[3].checked || $SPOKE_SHOW[4].checked) { $SHOW_SIDE[2].checked = true }
				}
			});
		})(group);
	}

	$RIM_COLOR    .addEventListener("change", function() { Set_Save_Style($RIM,     'stroke', this.value); });
	$RIM_LINE_SIZE.addEventListener("change", function() { if (Validate_Input(this)) { Make_Rim(save); Setup_Viewbox(); } });
	$RIM_SHOW     .addEventListener("change", function() { Show_Hide($RIM    , this.checked, save) });

	$F1_COLOR     .addEventListener("change", function() { Set_Save_Style($FLANGE1, 'stroke', this.value); });
	$F1_LINE_SIZE .addEventListener("change", function() { if (Validate_Input(this)) { Set_Save_Style($FLANGE1, 'stroke-width', this.value); } });
	$F1_SHOW      .addEventListener("change", function() { Show_Hide($FLANGE1, this.checked, save) });

	$F2_COLOR     .addEventListener("change", function() { Set_Save_Style($FLANGE2, 'stroke', this.value); });
	$F2_LINE_SIZE .addEventListener("change", function() { if (Validate_Input(this)) { Set_Save_Style($FLANGE2, 'stroke-width', this.value); } });
	$F2_SHOW      .addEventListener("change", function() { Show_Hide($FLANGE2, this.checked, save) });

	$AXES_COLOR    .addEventListener("change", function() { Set_Style_by_Class( AXIS_CLASS, "stroke", this.value, save); });
	$AXES_LINE_SIZE.addEventListener("change", function() { if (Validate_Input(this)) { Set_Style_by_Class(AXIS_CLASS, 'stroke-width', this.value, save); } });
	$AXES_SHOW     .addEventListener("change", function() { Show_Hide_Class( AXIS_CLASS, this.checked, 'display'); });

	$HOLE_COLOR    .addEventListener("change", function() { Set_Style_by_Class(SPOKE_HOLES, "fill"      , this.value, save); });
	$HOLES_SHOW    .addEventListener("change", function() { Show_Hide_Class(SPOKE_HOLES, this.checked, 'display'); });
	
	$HOLE_SIZE.addEventListener("change", function() { 				//$HOLE_SIZE is diameter
	
		if (!Validate_Input(this)) { return false; }
	
		Set_Attribute_by_Class( RIM_HOLE_CLASS, 'r', this.value/2); //set *radius* of holes (this.value/2)
		Set_Attribute_by_Class( HUB_HOLE_CLASS, 'r', this.value/2);
		Save_Settings("display");
	});


	$SCALE_MODE.addEventListener("change", function() {
		Save_Settings("display");
		Set_Scale_Mode();
		Setup_Viewbox();
	});


	$SCALE_fixed.addEventListener("change", function() {
		if (!Validate_Input(this)) { return false; }
		Setup_Viewbox();
		Save_Settings("display");
		this.prior_value = this.value
	});


	$RESET_SCALE          .addEventListener("click", function() { Reset_Scale();           });
	$RESET_OPTIONS_SPOKES .addEventListener("click", function() { Reset_OPTIONS_SPOKES();  });
	$RESET_OPTIONS_RIM_ETC.addEventListener("click", function() { Reset_OPTIONS_RIM_ETC(); });


	$CLOSE_MSG.addEventListener("blur" , function() { Close_Message() });
	$CLOSE_MSG.addEventListener("click", function() { Close_Message() });


	$ACCEPT_MSG.addEventListener("blur", function(event) {
		if ($ACCEPT_MSG.value == "true") { return; }
		event.stopImmediatePropagation();
		setTimeout(function() { $MSG_BOX.scrollIntoView(); $ACCEPT_MSG.focus(); }, 10);
	});

	$ACCEPT_MSG.addEventListener("click", function() {
		$ACCEPT_MSG.value = "true";
		var expires = new Date(+new Date() + 2592000000); //in 30 days (in milliseconds) Should it be Longer? Shorter?
		var domain = window.location.hostname;
		D.cookie = $ACCEPT_MSG.id + "=true; expires=" + expires.toUTCString() + '; path=/; domain=.' + domain;
		Close_Message();
	});


	$DELETE_ALL_DATA.addEventListener('click', function() {
		//except browser cache, of course...
		
		var msg = "This will delete all wheel and display settings\n stored by this web browser on this device.\n\nAre you sure?"
		var DELETE_ALL = confirm(msg);
		if (!DELETE_ALL) { return; }
		
		for (var wheel = 1; wheel <= MAX_WHEELS; wheel++) {
			localStorage.removeItem(LS_VALUES_PREFIX + wheel);
		}
		
		Build_Select_Wheel_List();
		Clear_Settings();
		
		localStorage.removeItem(LS_CURRENT_WHEEL); //Must come after Build_Select_Wheel_List();
		
		Reset_Scale();
		Reset_OPTIONS_SPOKES();
		Reset_OPTIONS_RIM_ETC();
		
		localStorage.removeItem(LS_DISPLAY_OPTIONS);
		
		$SHOW_HIDE_NOTES   .value         = "none";
		$SHOW_HIDE_ADVANCED.value         = "none";
		$SHOW_HIDE_OTHER   .value         = "none";
		$SHOW_HIDE_DO      .value         = "none";
		$NOTES          .style["display"] = "none";
		$ADVANCED_INFO  .style["display"] = "none";
		$OTHER_CALCS	.style["display"] = "none";
		$DISPLAY_OPTIONS.style["display"] = "none";
		
		var domain = window.location.hostname;
		document.cookie = $ACCEPT_MSG.id + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; domain=.' + domain;
		$ACCEPT_MSG.value = false;
		
		if ($ACCEPT_MSG.ENABLED) { Error_Notice('', MSGS['notice'] + $RESPONSIBILITY.innerHTML, 'init'); }
		else                     { $ERD.focus(); }
		
		$CURRENT_WHEEL.value = 1;
	}); //end $DELETE_ALL_DATA on click



	$EXPORT.addEventListener("click", function() {
		var ALL_DATA = {}; //
		ALL_DATA.wheels = {};
		ALL_DATA.display_options = Parse_Settings(localStorage.getItem(LS_DISPLAY_OPTIONS));
		
		for (var wheel = 1; wheel <= MAX_WHEELS; wheel++ ) {
			var wheel_data = Parse_Settings(localStorage.getItem(LS_VALUES_PREFIX + wheel));
			if (wheel_data) { ALL_DATA.wheels[wheel] = wheel_data; }
		}
		
		$EXPORT_OUTPUT.innerHTML = JSON.stringify(ALL_DATA);
		
		IMEX_enable_disable(true, $EXPORT_CONTAINER);
		
		$COPY_TO_CLIPBOARD.focus();
	});


	$CLOSE_EXPORT.addEventListener("click", function() {
		$EXPORT_OUTPUT.innerHTML = "";
		IMEX_enable_disable(false, $EXPORT_CONTAINER);
	});


	$COPY_TO_CLIPBOARD.addEventListener("click", function() {
		window.getSelection().selectAllChildren( $EXPORT_OUTPUT );
		document.execCommand("copy");
	});


	$IMPORT.addEventListener("click", function() {
		IMEX_enable_disable(true, $IMPORT_CONTAINER);
		$IMPORT_INPUT.focus();
	});


	$CLOSE_IMPORT.addEventListener("click", function() {
		IMEX_enable_disable(false, $IMPORT_CONTAINER);
	});


	$PERFORM_IMPORT.addEventListener("click", function() {
		
		//##### Add some basic overall validation of imported_data...
		//{ "wheels":{"1":{...}, ...}, "display_options":{...} }
		
		var imported_data = JSON.parse($IMPORT_INPUT.value);
		
		Init_Display_NR_SX(imported_data.display_options, true);
		
		var saved_settings_found = false;
		for (var wheel in imported_data.wheels) {
			$CURRENT_WHEEL.value = wheel;
			saved_settings_found = Load_Saved_Settings(imported_data.wheels[wheel], true);
			$WHEEL_NAME.value   = $WHEEL_NAME.value.trim();
			$WHEEL_NAME.current = $WHEEL_NAME.value;
			Validate_Wheel_Settings('imported', true); //Also saves settings...
		}
		
		Setup_Wheel_Type("init");
		if (saved_settings_found) { Build_Wheel(); }
		
		IMEX_enable_disable(false, $IMPORT_CONTAINER);
	});
}//end Assign_Events() //******************************************************/




function Init_Display_NR_SX(display_options, imported) { //********************/

	if (imported) { Load_Saved_Settings(display_options, imported); }
	else          { Load_Saved_Settings(LS_DISPLAY_OPTIONS); }

	Set_Scale_Mode();

	var triplet = ($WHEEL_TYPE.value == "triplet");
	if (triplet) { Show_Hide_Class(PHH_OPTIONS, false); }
	else         { Show_Hide_Class(PHH_OPTIONS, $PH_HUB.checked); }

	$ADVANCED_INFO  .style["display"] = $SHOW_HIDE_ADVANCED.value;
	$OTHER_CALCS	.style["display"] = $SHOW_HIDE_OTHER.value;
	$DISPLAY_OPTIONS.style["display"] = $SHOW_HIDE_DO.value;
	$NOTES			.style["display"] = $SHOW_HIDE_NOTES.value;

	if (imported) { Save_Settings("display"); }
	else {
		//Reduce the visually jarring, if brief,  jumping around of page elements during page load.
		$CONTAINER.style['visibility'] = "visible";
		$CONTAINER.style.opacity = '1';
	}

	//Temp <select> lists until any saved settings loaded. NR & SX will then be rebuilt in Setup_Wheel_Type().
	Build_NR_Options("custom", MAX[$NR.id], 0);
	Build_SX_Options("custom", 1, MAX[$NR.id], 0);
	Build_SX_Options("custom", 2, MAX[$NR.id], 0);

	$SHOW_SIDE[1].checked = false;
	$SHOW_SIDE[2].checked = false;
	if ($SPOKE_SHOW[1].checked || $SPOKE_SHOW[2].checked) { $SHOW_SIDE[1].checked = true }
	if ($SPOKE_SHOW[3].checked || $SPOKE_SHOW[4].checked) { $SHOW_SIDE[2].checked = true }
}//end Init_Display_NR_SX() //*************************************************/




function Init() { //***********************************************************/

	Assign_Events();

	Load_DEFAULT_OPTIONS();

	Init_Display_NR_SX(LS_DISPLAY_OPTIONS);

	Build_Select_Wheel_List();

	var saved_settings_found = Load_Saved_Settings(LS_VALUES_PREFIX + $CURRENT_WHEEL.value);

	if (saved_settings_found) { Validate_Wheel_Settings(); }

	Setup_Wheel_Type("init");

	if (saved_settings_found) { Build_Wheel(); }

	$WHEEL_NAME.current = $WHEEL_NAME.value;

	//Needed here regardless in case initial wheel is not blank,
	//but the ERD & PCD's are all 0 (so nothing to Build).
	Setup_Viewbox();


	//##### Enable disclaimer msg on first load & resets?
	$ACCEPT_MSG.ENABLED = false; //##### true;
	//#####Check_if_Disclaimer_Accepted($ERD); //(option) is where to set focus if accepted.

	$SLC_VERSION.innerHTML = SLC_VERSION;
}//end Init() //***************************************************************/



window.addEventListener("load", function() { Init() } );

//##### Some times I like beforeunload, sometimes I don't...
//##### window.onbeforeunload =  function() { $CONTAINER.style.opacity = '0' }
//*****************************************************************************/
})();</script>
